

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>DSCI 573 - Feature and Model Selection &#8212; DSCI 573 Feature and Model Selection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_lectures/04_lecture-feat-importances-selection';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/mds-hex-sticker.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/mds-hex-sticker.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lectures/01_classification-metrics.html">Lecture 1: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/02_regression-metrics.html">Lecture 2: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/03_feature-engineering.html">Lecture 3: Feature engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/04_feat-importances-selection.html">Lecture 4: Feature importances and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/05_loss-functions-regularization_intro.html">Lecture 5: Loss functions, intro to regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/06_L2-L1-regularization.html">Lecture 6: L2- and L1-Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/07_ensembles.html">Lecture 7: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/08_model-transparency-conclusion.html">Lecture 8: Model transparency and conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/_lectures/04_lecture-feat-importances-selection.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>DSCI 573 - Feature and Model Selection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-4-feature-importances-and-feature-selection">Lecture 4: Feature importances and feature selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">1. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-correlations">Feature correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">2. Feature importances in linear models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-different-types-of-features">Interpreting coefficients of different types of features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">2. Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination">3 . Recursive feature elimination</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Recursive feature elimination</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(optional) Feature selection and OHE</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-choose-the-number-of-features-to-select">How to choose the number of features to select?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-get-feature-names-of-selected-features">How do we get feature names of selected features?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-for-classification">RFE for classification</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-method-e-g-forward-selection">2. Search and score method (e.g., forward selection)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-what-scoring-function-should-we-use">Search and <strong>score</strong>: What scoring function should we use?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-search-and-score-methods">Problems with search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-complexity-penalty">Model selection: complexity penalty</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scoring-using-complexity-penalties">Scoring using complexity penalties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#l0-norm-and-the-number-of-features-used"><span class="math notranslate nohighlight">\(L0\)</span> “norm”  and the number of features used</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scoring-using-l0-norm">Scoring using <span class="math notranslate nohighlight">\(L0\)</span> “norm”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-greedy-approach-for-search-and-score">Forward selection: greedy approach for search and score</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-example">Forward selection: Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-get-feature-names-of-selected-features">How to get feature names of selected features?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection">Forward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-feature-selection-optional">Problems with feature selection (optional)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-rough-guide-to-feature-selection-bonus-slide">A rough guide to feature selection (bonus slide)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#true-false-questions-feature-selection-class-discussion">True/False questions: Feature selection (Class discussion)</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="dsci-573-feature-and-model-selection">
<h1>DSCI 573 - Feature and Model Selection<a class="headerlink" href="#dsci-573-feature-and-model-selection" title="Permalink to this heading">#</a></h1>
<section id="lecture-4-feature-importances-and-feature-selection">
<h2>Lecture 4: Feature importances and feature selection<a class="headerlink" href="#lecture-4-feature-importances-and-feature-selection" title="Permalink to this heading">#</a></h2>
<p>UBC Master of Data Science program, 2019-20</p>
<p>Instructor: Varada Kolhatkar</p>
</section>
<section id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h2>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Interpret the coefficients of linear regression, including for scaled numeric variables.</p></li>
<li><p>Explain the general concept of feature selection.</p></li>
<li><p>Discuss and compare different feature selection methods at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s implementation of recursive feature elimination (<code class="docutils literal notranslate"><span class="pre">RFE</span></code>).</p></li>
<li><p>Implement the forward search algorithm.</p></li>
<li><p>Relate feature selection to the idea of complexity penalty.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span><span class="p">,</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">RidgeCV</span><span class="p">,</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">make_scorer</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h2>1. Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Video 1</p></li>
</ul>
<p>In this lecture, we’ll be using <a class="reference external" href="https://www.kaggle.com/c/home-data-for-ml-course/">Kaggle House Prices dataset</a>, the dataset we used in lecture 2. As usual, to run this notebook you’ll need to download the data. Unzip the data into a subdirectory called <code class="docutils literal notranslate"><span class="pre">data</span></code>. For this dataset, train and test have already been separated. We’ll be working with the train portion in this lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing-kaggle/train.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>303</td>
      <td>20</td>
      <td>RL</td>
      <td>118.0</td>
      <td>13704</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>2006</td>
      <td>WD</td>
      <td>Normal</td>
      <td>205000</td>
    </tr>
    <tr>
      <th>767</th>
      <td>768</td>
      <td>50</td>
      <td>RL</td>
      <td>75.0</td>
      <td>12508</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Shed</td>
      <td>1300</td>
      <td>7</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>160000</td>
    </tr>
    <tr>
      <th>429</th>
      <td>430</td>
      <td>20</td>
      <td>RL</td>
      <td>130.0</td>
      <td>11457</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>3</td>
      <td>2009</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>1140</td>
      <td>30</td>
      <td>RL</td>
      <td>98.0</td>
      <td>8731</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>144000</td>
    </tr>
    <tr>
      <th>558</th>
      <td>559</td>
      <td>60</td>
      <td>RL</td>
      <td>57.0</td>
      <td>21872</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR2</td>
      <td>HLS</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>8</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 81 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>The prediction task is predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> given features related to properties.</p></li>
<li><p>Note that the target is numeric, not categorical.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 81)
</pre></div>
</div>
</div>
</div>
<section id="let-s-separate-x-and-y">
<h3>Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code><a class="headerlink" href="#let-s-separate-x-and-y" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="let-s-identify-feature-types">
<h3>Let’s identify feature types<a class="headerlink" href="#let-s-identify-feature-types" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_features</span>    <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">,</span> <span class="s1">&#39;LotArea&#39;</span><span class="p">,</span> <span class="s1">&#39;OverallQual&#39;</span><span class="p">,</span> <span class="s1">&#39;OverallCond&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;YearBuilt&#39;</span><span class="p">,</span> <span class="s1">&#39;YearRemodAdd&#39;</span><span class="p">,</span> <span class="s1">&#39;MasVnrArea&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtFinSF1&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtFinSF2&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;BsmtUnfSF&#39;</span><span class="p">,</span> <span class="s1">&#39;TotalBsmtSF&#39;</span><span class="p">,</span> <span class="s1">&#39;1stFlrSF&#39;</span><span class="p">,</span> <span class="s1">&#39;2ndFlrSF&#39;</span><span class="p">,</span> <span class="s1">&#39;LowQualFinSF&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;GrLivArea&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtFullBath&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtHalfBath&#39;</span><span class="p">,</span> <span class="s1">&#39;FullBath&#39;</span><span class="p">,</span> <span class="s1">&#39;HalfBath&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;TotRmsAbvGrd&#39;</span><span class="p">,</span> <span class="s1">&#39;Fireplaces&#39;</span><span class="p">,</span> <span class="s1">&#39;GarageYrBlt&#39;</span><span class="p">,</span> <span class="s1">&#39;GarageCars&#39;</span><span class="p">,</span> <span class="s1">&#39;GarageArea&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;WoodDeckSF&#39;</span><span class="p">,</span> <span class="s1">&#39;OpenPorchSF&#39;</span><span class="p">,</span> <span class="s1">&#39;EnclosedPorch&#39;</span><span class="p">,</span> <span class="s1">&#39;3SsnPorch&#39;</span><span class="p">,</span> <span class="s1">&#39;ScreenPorch&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;PoolArea&#39;</span><span class="p">,</span> <span class="s1">&#39;MiscVal&#39;</span><span class="p">,</span> <span class="s1">&#39;YrSold&#39;</span><span class="p">]</span>
<span class="n">ordinal_features_reg</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ExterQual&#39;</span><span class="p">,</span> <span class="s1">&#39;ExterCond&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtQual&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtCond&#39;</span><span class="p">,</span> <span class="s1">&#39;HeatingQC&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;KitchenQual&#39;</span><span class="p">,</span> <span class="s1">&#39;FireplaceQu&#39;</span><span class="p">,</span> <span class="s1">&#39;GarageQual&#39;</span><span class="p">,</span> <span class="s1">&#39;GarageCond&#39;</span><span class="p">,</span> <span class="s1">&#39;PoolQC&#39;</span><span class="p">]</span>
<span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Po&#39;</span><span class="p">,</span> <span class="s1">&#39;Fa&#39;</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">,</span> <span class="s1">&#39;Ds&#39;</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">]</span> <span class="c1"># if N/A it will just impute something, per below</span>

<span class="n">ordinal_features_oth</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BsmtExposure&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtFinType1&#39;</span><span class="p">,</span> <span class="s1">&#39;BsmtFinType2&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Functional&#39;</span><span class="p">,</span>  <span class="s1">&#39;Fence&#39;</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)</span> 
                            <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">),</span> 
                                    <span class="n">StandardScaler</span><span class="p">())</span>
<span class="n">ordinal_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">),</span> 
                                    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">ordering</span><span class="p">]</span>
                                                   <span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)))</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
                                        <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer</span><span class="p">,</span> <span class="n">ordinal_features_reg</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>    
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;drop&#39;: &#39;drop&#39;,
 &#39;pipeline-1&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;median&#39;)),
                 (&#39;standardscaler&#39;, StandardScaler())]),
 &#39;pipeline-2&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ds&#39;,
                                              &#39;Ex&#39;]]))]),
 &#39;pipeline-3&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;,
                  SimpleImputer(fill_value=&#39;missing&#39;, strategy=&#39;constant&#39;)),
                 (&#39;onehotencoder&#39;,
                  OneHotEncoder(handle_unknown=&#39;ignore&#39;, sparse=False))])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;pipeline-3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;onehotencoder&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">))</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">ordinal_features_reg</span> <span class="o">+</span> <span class="n">ohe_columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span><span class="p">)</span>
<span class="n">X_train_enc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinSF2</th>
      <th>BsmtUnfSF</th>
      <th>...</th>
      <th>Functional_Min2</th>
      <th>Functional_Mod</th>
      <th>Functional_Typ</th>
      <th>BsmtFinType2_ALQ</th>
      <th>BsmtFinType2_BLQ</th>
      <th>BsmtFinType2_GLQ</th>
      <th>BsmtFinType2_LwQ</th>
      <th>BsmtFinType2_Rec</th>
      <th>BsmtFinType2_Unf</th>
      <th>BsmtFinType2_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>2.312501</td>
      <td>0.381428</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.840492</td>
      <td>0.269972</td>
      <td>-0.961498</td>
      <td>-0.287191</td>
      <td>2.197106</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>767</th>
      <td>0.260890</td>
      <td>0.248457</td>
      <td>-0.054669</td>
      <td>1.285467</td>
      <td>-1.026793</td>
      <td>0.016525</td>
      <td>-0.573129</td>
      <td>0.476092</td>
      <td>-0.287191</td>
      <td>-0.553138</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>429</th>
      <td>2.885044</td>
      <td>0.131607</td>
      <td>-0.054669</td>
      <td>-0.512408</td>
      <td>0.563314</td>
      <td>0.161931</td>
      <td>-0.573129</td>
      <td>1.227559</td>
      <td>-0.287191</td>
      <td>-0.408626</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>1.358264</td>
      <td>-0.171468</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.689338</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>0.443419</td>
      <td>-0.287191</td>
      <td>-0.672812</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>558</th>
      <td>-0.597924</td>
      <td>1.289541</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.828332</td>
      <td>0.598149</td>
      <td>-0.573129</td>
      <td>0.354114</td>
      <td>-0.287191</td>
      <td>-1.000222</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1041</th>
      <td>-0.025381</td>
      <td>-0.127107</td>
      <td>-0.054669</td>
      <td>2.184405</td>
      <td>-0.165485</td>
      <td>0.743555</td>
      <td>0.843281</td>
      <td>-0.090231</td>
      <td>0.103315</td>
      <td>-0.523784</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>-0.025381</td>
      <td>-0.149788</td>
      <td>-1.491366</td>
      <td>-2.310284</td>
      <td>-0.496757</td>
      <td>-1.389065</td>
      <td>-0.573129</td>
      <td>-0.961498</td>
      <td>-0.287191</td>
      <td>0.234904</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>-0.025381</td>
      <td>1.168244</td>
      <td>0.663680</td>
      <td>1.285467</td>
      <td>-0.099230</td>
      <td>0.888961</td>
      <td>-0.573129</td>
      <td>-0.314582</td>
      <td>0.127721</td>
      <td>1.433902</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>0.022331</td>
      <td>-0.203265</td>
      <td>-0.773017</td>
      <td>1.285467</td>
      <td>0.033279</td>
      <td>1.082835</td>
      <td>-0.573129</td>
      <td>0.467379</td>
      <td>-0.287191</td>
      <td>-1.029576</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>-0.454788</td>
      <td>-0.475099</td>
      <td>-0.054669</td>
      <td>0.386530</td>
      <td>-0.993666</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>-0.144686</td>
      <td>-0.287191</td>
      <td>-0.469592</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1314 rows × 297 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 297)
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-correlations">
<h3>Feature correlations<a class="headerlink" href="#feature-correlations" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s look at the correlations between various features with other features and the target in our encoded data (first row/column).</p></li>
<li><p>In simple terms here is how you can interpret correlations between two variables <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes up when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are positively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes down when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are negatively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> is unchanged when <span class="math notranslate nohighlight">\(X\)</span> changes, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are uncorrelated.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7db73b6ccdb0e7e2e2916bd9301a0ec86f9a13d341d0bfe4cdd7793c9ab4a8fa.png" src="../_images/7db73b6ccdb0e7e2e2916bd9301a0ec86f9a13d341d0bfe4cdd7793c9ab4a8fa.png" />
</div>
</div>
<ul class="simple">
<li><p>We can immediately see that <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is highly correlated with <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code>.</p></li>
<li><p>This is an early hint that <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code> is a useful feature in predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code>.</p></li>
<li><p>However, this approach is <strong>extremely simplistic</strong>.</p>
<ul>
<li><p>It only looks at each feature in isolation.</p></li>
<li><p>It only looks at linear associations:</p>
<ul>
<li><p>What if <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is high when <code class="docutils literal notranslate"><span class="pre">BsmtFullBath</span></code> is 2 or 3, but low when it’s 0, 1, or 4? They might seem uncorrelated.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0434c20b8ab91b47a56fdca4b730bf7116f87ae3a51326bde6fbb6addcf7ea93.png" src="../_images/0434c20b8ab91b47a56fdca4b730bf7116f87ae3a51326bde6fbb6addcf7ea93.png" />
</div>
</div>
<ul class="simple">
<li><p>Looking at this diagram also tells us the relationship between features.</p>
<ul>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> are highly correlated.</p></li>
<li><p>Do we need both of them?</p></li>
<li><p>If our model says <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is very important and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> is very unimportant, do we trust those values?</p></li>
<li><p>Maybe <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> only “becomes important” if <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is removed.</p></li>
<li><p>Sometimes the opposite happens: a feature only becomes important if another feature is <em>added</em>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="feature-importances-in-linear-models">
<h2>2. Feature importances in linear models<a class="headerlink" href="#feature-importances-in-linear-models" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Video 2</p></li>
</ul>
<ul class="simple">
<li><p>Like logistic regression, with linear regression we can look at the <em>coefficients</em> for each feature.</p></li>
<li><p>Overall idea: predicted price = intercept + <span class="math notranslate nohighlight">\(\sum_i\)</span> coefficient i <span class="math notranslate nohighlight">\(\times\)</span> feature i.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">])</span>
<span class="n">lr_coefs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotFrontage</th>
      <td>-2070.117618</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>5234.852532</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>10685.771264</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>5002.438849</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>3812.046289</td>
    </tr>
    <tr>
      <th>YearRemodAdd</th>
      <td>-121.940270</td>
    </tr>
    <tr>
      <th>MasVnrArea</th>
      <td>4774.591668</td>
    </tr>
    <tr>
      <th>BsmtFinSF1</th>
      <td>2860.636977</td>
    </tr>
    <tr>
      <th>BsmtFinSF2</th>
      <td>764.908753</td>
    </tr>
    <tr>
      <th>BsmtUnfSF</th>
      <td>-1396.722499</td>
    </tr>
    <tr>
      <th>TotalBsmtSF</th>
      <td>1852.047552</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>7104.375149</td>
    </tr>
    <tr>
      <th>2ndFlrSF</th>
      <td>11633.931528</td>
    </tr>
    <tr>
      <th>LowQualFinSF</th>
      <td>-1309.921478</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>14722.156611</td>
    </tr>
    <tr>
      <th>BsmtFullBath</th>
      <td>2254.045911</td>
    </tr>
    <tr>
      <th>BsmtHalfBath</th>
      <td>318.493662</td>
    </tr>
    <tr>
      <th>FullBath</th>
      <td>3099.043139</td>
    </tr>
    <tr>
      <th>HalfBath</th>
      <td>1745.365416</td>
    </tr>
    <tr>
      <th>TotRmsAbvGrd</th>
      <td>4346.826761</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="interpreting-coefficients-of-different-types-of-features">
<h3>Interpreting coefficients of different types of features.<a class="headerlink" href="#interpreting-coefficients-of-different-types-of-features" title="Permalink to this heading">#</a></h3>
</section>
<section id="ordinal-features">
<h3>Ordinal features<a class="headerlink" href="#ordinal-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The ordinal features are easiest to interpret.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ExterQual&#39;, &#39;ExterCond&#39;, &#39;BsmtQual&#39;, &#39;BsmtCond&#39;, &#39;HeatingQC&#39;, &#39;KitchenQual&#39;, &#39;FireplaceQu&#39;, &#39;GarageQual&#39;, &#39;GarageCond&#39;, &#39;PoolQC&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">,</span> <span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4308.238573360218
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>“Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by \$3845”.</p>
<ul>
<li><p>Wow, that’s a lot!</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span><span class="p">[</span><span class="s1">&#39;ExterQual&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>147    Gd
Name: ExterQual, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Let’s perturb the example and change <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ex&#39;</span> <span class="c1"># Change Gd to Ex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9505</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span><span class="p">[</span><span class="s1">&#39;ExterQual&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>147    Ex
Name: ExterQual, dtype: object
</pre></div>
</div>
</div>
</div>
<p>How does the prediction change after changing <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> from <code class="docutils literal notranslate"><span class="pre">Gd</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prediction on the original example: &#39;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Prediction on the perturbed example: &#39;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After changing ExterQual from Gd to Ex increased the prediction by: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction on the original example:  [219796.4328617]
Prediction on the perturbed example:  [228412.91000842]
After changing ExterQual from Gd to Ex increased the prediction by:  [8616.47714672]
</pre></div>
</div>
</div>
</div>
<p>That’s exactly the learned coefficient for <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">,</span> <span class="s1">&#39;Coefficient&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4308.238573360218
</pre></div>
</div>
</div>
</div>
<p>So our interpretation is correct!</p>
<ul class="simple">
<li><p>Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by \$3845.</p></li>
</ul>
</section>
<section id="categorical-features">
<h3>Categorical features<a class="headerlink" href="#categorical-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What about the categorical features?</p></li>
<li><p>We have created a number of columns for each category with OHE and each category gets it’s own coefficient.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Exterior1st&#39;, &#39;GarageType&#39;, &#39;BldgType&#39;, &#39;MSSubClass&#39;, &#39;Heating&#39;, &#39;RoofMatl&#39;, &#39;Utilities&#39;, &#39;MoSold&#39;, &#39;Condition2&#39;, &#39;MSZoning&#39;, &#39;MasVnrType&#39;, &#39;KitchenAbvGr&#39;, &#39;Condition1&#39;, &#39;HouseStyle&#39;, &#39;GarageFinish&#39;, &#39;BedroomAbvGr&#39;, &#39;Electrical&#39;, &#39;Neighborhood&#39;, &#39;SaleCondition&#39;, &#39;Alley&#39;, &#39;LotConfig&#39;, &#39;Fence&#39;, &#39;BsmtFinType1&#39;, &#39;Foundation&#39;, &#39;PavedDrive&#39;, &#39;LandSlope&#39;, &#39;RoofStyle&#39;, &#39;MiscFeature&#39;, &#39;LandContour&#39;, &#39;SaleType&#39;, &#39;Exterior2nd&#39;, &#39;CentralAir&#39;, &#39;LotShape&#39;, &#39;BsmtExposure&#39;, &#39;Street&#39;, &#39;Functional&#39;, &#39;BsmtFinType2&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">=</span> <span class="n">lr_coefs</span><span class="p">[</span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">)]</span>
<span class="n">lr_coefs_landslope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>146.951190</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>7541.298231</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-7688.249421</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>We can talk about switching from one of these categories to another by picking a “reference” category:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">-</span> <span class="n">lr_coefs_landslope</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;LandSlope_Gtl&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>7394.347040</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-7835.200611</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Mod</span></code> the prediction price goes up by <span class="math notranslate nohighlight">\(\sim\$7013\)</span></p></li>
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Sev</span></code> the prediction price goes down by <span class="math notranslate nohighlight">\(\sim\$8016\)</span></p></li>
</ul>
<p>Note that this might not make sense in the real world but this is what our model decided to learn given this small amount of data.</p>
<p>Be a bit careful here: (optional)</p>
<ul class="simple">
<li><p>If you did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code> (we didn’t) then you already have a reference class, and all the values are with respect to that one.</p></li>
<li><p>The interpretation depends on whether we did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, hence the hassle.</p></li>
</ul>
</section>
<section id="interpreting-coefficients-of-numeric-features">
<h3>Interpreting coefficients of numeric features<a class="headerlink" href="#interpreting-coefficients-of-numeric-features" title="Permalink to this heading">#</a></h3>
<p>Let’s look at coefficients of <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> and <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PoolArea</th>
      <td>2762.637722</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>-2070.117618</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Intuition:</p>
<ul class="simple">
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> by 1 scaled unit <strong>increases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$3372\)</span>.</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> by 1 scaled unit <strong>decreases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$1703\)</span>.</p></li>
</ul>
<p>Does that sound reasonable?</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code>, yes.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>, that’s surprising. Something positive would have made more sense?</p></li>
<li><p>Do we believe these interpretations??</p>
<ul>
<li><p>Do we believe this is how the predictions are being computed? Yes.</p></li>
<li><p>Do we believe that this is how the world works? No.</p></li>
</ul>
</li>
</ul>
<p>It’s not the case here but maybe the problem is that <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> and <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> are very correlated. <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> has a larger positive coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="p">[</span><span class="n">numeric_features</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6b8518ec08501fe204620fc9b3255e538ce7a7bc5dc93a713de22b32718b3fcf.png" src="../_images/6b8518ec08501fe204620fc9b3255e538ce7a7bc5dc93a713de22b32718b3fcf.png" />
</div>
</div>
<p>BTW, let’s make sure the predictions behave as expected:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9505</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Let’s perturb the example and add 1 to the <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># add 1 to the LotArea</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9506</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Prediction on the original example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([219796.4328617])
</pre></div>
</div>
</div>
</div>
<p>Prediction on the perturbed example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([219797.01486953])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s the difference between prediction?</p></li>
<li><p>Does the difference make sense given the coefficient of the feature?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.58200783])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotArea</th>
      <td>5234.852532</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Why did the prediction only go up by \<span class="math notranslate nohighlight">\(0.57 instead of \\\)</span>5134?</p></li>
<li><p>This is an issue of units. <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> is in sqft, but the coefficient is not <span class="math notranslate nohighlight">\(\$5134/\text{sqft}\)</span> <strong>because we scaled the features</strong>.</p></li>
</ul>
</section>
<section id="example-showing-how-can-we-interpret-coefficients-of-scaled-features">
<h3>Example showing how can we interpret coefficients of scaled features.<a class="headerlink" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The scaler subtracted the mean and divided by the standard deviation.</p></li>
<li><p>The division actually changed the scale!</p></li>
<li><p>For the unit conversion, we don’t care about the subtraction, but only the scaling.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s1">&#39;pipeline-1&#39;</span><span class="p">][</span><span class="s1">&#39;standardscaler&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">var_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2.09591390e+01, 8.99447103e+03, 1.39208177e+00, 1.11242416e+00,
       3.01866337e+01, 2.06318985e+01, 1.77914527e+02, 4.59101890e+02,
       1.63890010e+02, 4.42869860e+02, 4.42817167e+02, 3.92172897e+02,
       4.35820743e+02, 4.69800920e+01, 5.29468070e+02, 5.18276015e-01,
       2.33809970e-01, 5.49298599e-01, 5.02279069e-01, 1.62604030e+00,
       6.34398801e-01, 2.40531598e+01, 7.40269201e-01, 2.10560601e+02,
       1.25388753e+02, 6.57325181e+01, 6.07432962e+01, 3.03088902e+01,
       5.38336322e+01, 4.23249944e+01, 5.22084645e+02, 1.33231649e+00])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_scales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">var_</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">numeric_features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Scale&quot;</span><span class="p">])</span>
<span class="n">lr_scales</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotFrontage</th>
      <td>20.959139</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>8994.471032</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>1.392082</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>1.112424</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>30.186634</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You could also use <code class="docutils literal notranslate"><span class="pre">inverse_transform</span></code> to get this information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)))</span> <span class="o">-</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)))</span>
<span class="n">lr_scales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">numeric_features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Scale&quot;</span><span class="p">])</span>
<span class="n">lr_scales</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotFrontage</th>
      <td>20.959139</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>8994.471032</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>1.392082</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>1.112424</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>30.186634</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>It seems like <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> was divided by 8994.471032 sqft.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotArea</th>
      <td>5234.852532</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The coefficient tells us that if we increase the <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one unit the price would go up by $5134.</p></li>
<li><p>One scaled unit represents 8994 sq feet.</p></li>
</ul>
<ul class="simple">
<li><p>So if I increase original <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one square foot then the predicted price would go up by this amount:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">5134.590415</span><span class="o">/</span><span class="mf">8994.471032</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.570860742864417
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>This makes much more sense. Now we get the number we got before.</p></li>
<li><p>That said don’t read too much into these coefficients without statistical training.</p></li>
</ul>
</section>
<section id="interim-summary">
<h3>Interim summary<a class="headerlink" href="#interim-summary" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Correlation among features might make coefficients completely uninterpretable.</p></li>
<li><p>Fairly straightforward to interpret coefficients of ordinal features.</p></li>
<li><p>In categorical features, it’s often helpful to consider one category as a reference point and think about relative importance.</p></li>
<li><p>For numeric features, relative importance is meaningful after scaling.</p></li>
<li><p>You have to be careful about the scale of the feature when interpreting the coefficients.</p></li>
</ul>
<p>We will talk about features importances beyond linear models later in the course.</p>
</section>
</section>
<section id="feature-selection-introduction-and-motivation">
<h2>2. Feature selection: Introduction and motivation<a class="headerlink" href="#feature-selection-introduction-and-motivation" title="Permalink to this heading">#</a></h2>
<section id="what-is-feature-selection">
<h3>What is feature selection?<a class="headerlink" href="#what-is-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Find the features	(columns) <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting	<span class="math notranslate nohighlight">\(y\)</span>, and remove the features that aren’t.</p></li>
<li><p>Given <span class="math notranslate nohighlight">\(X = \begin{bmatrix}x_1 &amp; x_2 &amp; \dots &amp; x_n\\  \\  \\  \end{bmatrix}\)</span> and <span class="math notranslate nohighlight">\(y = \begin{bmatrix}\\  \\  \\  \end{bmatrix}\)</span>, find the columns <span class="math notranslate nohighlight">\(1 \leq j \leq n\)</span> in <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Id&#39;, &#39;MSSubClass&#39;, &#39;MSZoning&#39;, &#39;LotFrontage&#39;, &#39;LotArea&#39;, &#39;Street&#39;,
       &#39;Alley&#39;, &#39;LotShape&#39;, &#39;LandContour&#39;, &#39;Utilities&#39;, &#39;LotConfig&#39;,
       &#39;LandSlope&#39;, &#39;Neighborhood&#39;, &#39;Condition1&#39;, &#39;Condition2&#39;, &#39;BldgType&#39;,
       &#39;HouseStyle&#39;, &#39;OverallQual&#39;, &#39;OverallCond&#39;, &#39;YearBuilt&#39;, &#39;YearRemodAdd&#39;,
       &#39;RoofStyle&#39;, &#39;RoofMatl&#39;, &#39;Exterior1st&#39;, &#39;Exterior2nd&#39;, &#39;MasVnrType&#39;,
       &#39;MasVnrArea&#39;, &#39;ExterQual&#39;, &#39;ExterCond&#39;, &#39;Foundation&#39;, &#39;BsmtQual&#39;,
       &#39;BsmtCond&#39;, &#39;BsmtExposure&#39;, &#39;BsmtFinType1&#39;, &#39;BsmtFinSF1&#39;,
       &#39;BsmtFinType2&#39;, &#39;BsmtFinSF2&#39;, &#39;BsmtUnfSF&#39;, &#39;TotalBsmtSF&#39;, &#39;Heating&#39;,
       &#39;HeatingQC&#39;, &#39;CentralAir&#39;, &#39;Electrical&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;,
       &#39;LowQualFinSF&#39;, &#39;GrLivArea&#39;, &#39;BsmtFullBath&#39;, &#39;BsmtHalfBath&#39;, &#39;FullBath&#39;,
       &#39;HalfBath&#39;, &#39;BedroomAbvGr&#39;, &#39;KitchenAbvGr&#39;, &#39;KitchenQual&#39;,
       &#39;TotRmsAbvGrd&#39;, &#39;Functional&#39;, &#39;Fireplaces&#39;, &#39;FireplaceQu&#39;, &#39;GarageType&#39;,
       &#39;GarageYrBlt&#39;, &#39;GarageFinish&#39;, &#39;GarageCars&#39;, &#39;GarageArea&#39;, &#39;GarageQual&#39;,
       &#39;GarageCond&#39;, &#39;PavedDrive&#39;, &#39;WoodDeckSF&#39;, &#39;OpenPorchSF&#39;,
       &#39;EnclosedPorch&#39;, &#39;3SsnPorch&#39;, &#39;ScreenPorch&#39;, &#39;PoolArea&#39;, &#39;PoolQC&#39;,
       &#39;Fence&#39;, &#39;MiscFeature&#39;, &#39;MiscVal&#39;, &#39;MoSold&#39;, &#39;YrSold&#39;, &#39;SaleType&#39;,
       &#39;SaleCondition&#39;, &#39;SalePrice&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Which of these features are useful?</p>
</section>
<section id="why-feature-selection">
<h3>Why feature selection?<a class="headerlink" href="#why-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Interpretability: Models are more interpretable with fewer features. If you get the same performance with 10 features instead of 500 features, why not use the model with smaller number of features?</p></li>
<li><p>Computation: Models fit/predict faster with fewer columns.</p></li>
<li><p>Data collection: What type of new data should I collect? It may be cheaper to collect fewer columns.</p></li>
<li><p>Fundamental tradeoff: Can I reduce overfitting by removing useless features?</p></li>
</ul>
<p>Feature selection can often result in better performing (less overfit), easier to understand, and faster model.</p>
</section>
<section id="how-do-we-carry-out-feature-selection">
<h3>How do we carry out feature selection?<a class="headerlink" href="#how-do-we-carry-out-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>You could use domain knowledge to discard features.</p></li>
<li><p>Very related to looking at feature importances.</p></li>
</ul>
<p>We are going to look into three methods:</p>
<ol class="arabic simple">
<li><p>This lecture</p>
<ul class="simple">
<li><p>Recursive feature elimination</p></li>
<li><p>Forward selection</p></li>
</ul>
</li>
<li><p>Coming up: we’ll talk about one more useful approach (Lasso).</p></li>
</ol>
</section>
</section>
<section id="recursive-feature-elimination">
<h2>3 . Recursive feature elimination<a class="headerlink" href="#recursive-feature-elimination" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Let’s use feature importances to eliminate unimportant features.</p></li>
<li><p>Basic idea</p>
<ul>
<li><p>fit model</p></li>
<li><p>find least important feature</p></li>
<li><p>remove</p></li>
<li><p>iterate.</p></li>
</ul>
</li>
</ul>
<section id="id1">
<h3>Recursive feature elimination<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Decide <span class="math notranslate nohighlight">\(k\)</span>, the number of features to select.</p></li>
<li><p>Assign importances to features, e.g. by fitting a model and looking at <code class="docutils literal notranslate"><span class="pre">coef_</span></code> or <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code>.</p></li>
<li><p>Remove the least important feature.</p></li>
<li><p>Repeat steps 2-3 until only <span class="math notranslate nohighlight">\(k\)</span> features are remaining.</p></li>
</ol>
<p>Note that this is <strong>not</strong> the same as just removing all the less important features in one shot!</p>
<p>In scikit-learn, we’ll do this using <code class="docutils literal notranslate"><span class="pre">RFE</span></code>.
Before trying <code class="docutils literal notranslate"><span class="pre">RFE</span></code>, let’s look at cross-validation results with all features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>BsmtFinSF2</th>
      <th>BsmtUnfSF</th>
      <th>...</th>
      <th>Functional_Min2</th>
      <th>Functional_Mod</th>
      <th>Functional_Typ</th>
      <th>BsmtFinType2_ALQ</th>
      <th>BsmtFinType2_BLQ</th>
      <th>BsmtFinType2_GLQ</th>
      <th>BsmtFinType2_LwQ</th>
      <th>BsmtFinType2_Rec</th>
      <th>BsmtFinType2_Unf</th>
      <th>BsmtFinType2_missing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>2.312501</td>
      <td>0.381428</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.840492</td>
      <td>0.269972</td>
      <td>-0.961498</td>
      <td>-0.287191</td>
      <td>2.197106</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>767</th>
      <td>0.260890</td>
      <td>0.248457</td>
      <td>-0.054669</td>
      <td>1.285467</td>
      <td>-1.026793</td>
      <td>0.016525</td>
      <td>-0.573129</td>
      <td>0.476092</td>
      <td>-0.287191</td>
      <td>-0.553138</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>429</th>
      <td>2.885044</td>
      <td>0.131607</td>
      <td>-0.054669</td>
      <td>-0.512408</td>
      <td>0.563314</td>
      <td>0.161931</td>
      <td>-0.573129</td>
      <td>1.227559</td>
      <td>-0.287191</td>
      <td>-0.408626</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>1.358264</td>
      <td>-0.171468</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.689338</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>0.443419</td>
      <td>-0.287191</td>
      <td>-0.672812</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>558</th>
      <td>-0.597924</td>
      <td>1.289541</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.828332</td>
      <td>0.598149</td>
      <td>-0.573129</td>
      <td>0.354114</td>
      <td>-0.287191</td>
      <td>-1.000222</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>761</th>
      <td>-0.454788</td>
      <td>-0.373814</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.556829</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>-0.079341</td>
      <td>-0.287191</td>
      <td>0.388448</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1046</th>
      <td>0.738009</td>
      <td>0.642922</td>
      <td>2.100377</td>
      <td>-0.512408</td>
      <td>1.126478</td>
      <td>1.034366</td>
      <td>0.595971</td>
      <td>-0.438738</td>
      <td>-0.287191</td>
      <td>2.673544</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1265</th>
      <td>-1.647585</td>
      <td>-0.726920</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.927714</td>
      <td>0.695086</td>
      <td>0.652178</td>
      <td>0.018677</td>
      <td>-0.287191</td>
      <td>-0.738294</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1187</th>
      <td>0.928857</td>
      <td>0.243232</td>
      <td>1.382028</td>
      <td>-0.512408</td>
      <td>0.762078</td>
      <td>0.501211</td>
      <td>-0.573129</td>
      <td>2.209912</td>
      <td>-0.287191</td>
      <td>-0.903128</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>783</th>
      <td>-0.025381</td>
      <td>-0.130331</td>
      <td>-0.773017</td>
      <td>0.386530</td>
      <td>0.232042</td>
      <td>-0.322755</td>
      <td>0.011421</td>
      <td>1.427950</td>
      <td>-0.287191</td>
      <td>-1.282472</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 297 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;RidgeCV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RidgeCV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.109436</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.003238</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.797017</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.902361</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_enc</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">coef_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>29347.131724</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>26855.091566</td>
    </tr>
    <tr>
      <th>Neighborhood_NoRidge</th>
      <td>26380.545613</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>24663.193767</td>
    </tr>
    <tr>
      <th>PoolQC</th>
      <td>23562.475795</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>23357.438234</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>21634.503296</td>
    </tr>
    <tr>
      <th>Neighborhood_Edwards</th>
      <td>15042.578578</td>
    </tr>
    <tr>
      <th>BsmtExposure_Gd</th>
      <td>14757.810723</td>
    </tr>
    <tr>
      <th>LotShape_IR3</th>
      <td>13286.391824</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">RFE</span></code> and score the model.</p>
<ul class="simple">
<li><p>Let’s set number of features to 30.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RFE</span></code> will select the top 30 features, one at a time, based on the absolute value of <code class="docutils literal notranslate"><span class="pre">model.coef_</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFE</span><span class="p">,</span> <span class="n">RFECV</span>

<span class="n">rfe</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;RFE with 30 feats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">rfe</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RidgeCV</th>
      <th>RFE with 30 feats</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.109436</td>
      <td>0.525119</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.003238</td>
      <td>0.003164</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.797017</td>
      <td>0.739485</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.902361</td>
      <td>0.848590</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s look at selected features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_enc</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">selected_columns</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">rfe</span><span class="o">.</span><span class="n">support_</span><span class="p">]</span>
<span class="n">selected_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;OverallQual&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;, &#39;PoolQC&#39;, &#39;Exterior1st_AsphShn&#39;,
       &#39;Exterior1st_ImStucc&#39;, &#39;MSSubClass_160&#39;, &#39;Heating_OthW&#39;,
       &#39;RoofMatl_ClyTile&#39;, &#39;RoofMatl_CompShg&#39;, &#39;RoofMatl_Roll&#39;,
       &#39;RoofMatl_WdShngl&#39;, &#39;Condition2_PosN&#39;, &#39;MSZoning_C (all)&#39;,
       &#39;MSZoning_FV&#39;, &#39;KitchenAbvGr_1&#39;, &#39;KitchenAbvGr_3&#39;, &#39;BedroomAbvGr_0&#39;,
       &#39;Neighborhood_Crawfor&#39;, &#39;Neighborhood_NoRidge&#39;, &#39;Neighborhood_NridgHt&#39;,
       &#39;Neighborhood_StoneBr&#39;, &#39;SaleCondition_Family&#39;, &#39;RoofStyle_Flat&#39;,
       &#39;LandContour_Bnk&#39;, &#39;SaleType_Con&#39;, &#39;SaleType_New&#39;,
       &#39;Exterior2nd_ImStucc&#39;, &#39;BsmtExposure_Gd&#39;, &#39;Functional_Typ&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Contrast with the top 30 by the ORIGINAL importances (absolute value coefficients):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;RoofMatl_ClyTile&#39;, &#39;Neighborhood_StoneBr&#39;, &#39;Neighborhood_NoRidge&#39;,
       &#39;Neighborhood_NridgHt&#39;, &#39;PoolQC&#39;, &#39;Condition2_PosN&#39;, &#39;RoofMatl_WdShngl&#39;,
       &#39;Neighborhood_Edwards&#39;, &#39;BsmtExposure_Gd&#39;, &#39;LotShape_IR3&#39;, &#39;GrLivArea&#39;,
       &#39;OverallQual&#39;, &#39;Neighborhood_Gilbert&#39;, &#39;Neighborhood_Mitchel&#39;,
       &#39;Exterior2nd_ImStucc&#39;, &#39;Neighborhood_Timber&#39;, &#39;BldgType_1Fam&#39;,
       &#39;BedroomAbvGr_5&#39;, &#39;Exterior1st_BrkFace&#39;, &#39;Neighborhood_Crawfor&#39;,
       &#39;2ndFlrSF&#39;, &#39;Condition1_Norm&#39;, &#39;MSZoning_C (all)&#39;, &#39;HouseStyle_1Story&#39;,
       &#39;BldgType_Twnhs&#39;, &#39;GarageCars&#39;, &#39;Exterior2nd_Stucco&#39;, &#39;BsmtQual&#39;,
       &#39;LandContour_Bnk&#39;, &#39;Functional_Typ&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">selected_columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">coef_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;1stFlrSF&#39;,
 &#39;BedroomAbvGr_0&#39;,
 &#39;Exterior1st_AsphShn&#39;,
 &#39;Exterior1st_ImStucc&#39;,
 &#39;Heating_OthW&#39;,
 &#39;KitchenAbvGr_1&#39;,
 &#39;KitchenAbvGr_3&#39;,
 &#39;MSSubClass_160&#39;,
 &#39;MSZoning_FV&#39;,
 &#39;RoofMatl_CompShg&#39;,
 &#39;RoofMatl_Roll&#39;,
 &#39;RoofStyle_Flat&#39;,
 &#39;SaleCondition_Family&#39;,
 &#39;SaleType_Con&#39;,
 &#39;SaleType_New&#39;}
</pre></div>
</div>
</div>
</div>
<p>How many features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Ranking based on feature importances.</p></li>
<li><p>Selected features are assigned rank 1.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe</span><span class="o">.</span><span class="n">ranking_</span> <span class="c1"># may be different than the ranked feature importances!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([175,  95,   1,  70,  77, 260, 121, 209, 233,  45,  47,   1,   1,
       217,  34, 183, 252, 182, 187, 114, 166, 235,  35, 268, 212, 262,
       249, 200, 190, 171, 253, 234, 127, 179,   6, 267, 248,  23, 255,
       136, 266,   1, 157,   1, 189,  12, 174,  13, 142,   1, 156, 226,
       181, 176, 264, 196, 225, 131, 221, 122, 145, 138, 245,  36, 162,
       107, 165,  64,  71,  99,  98, 250, 164,  80, 102, 101, 151,  53,
       213, 184,   3,   1,   5, 108, 178,  84,  63, 238,   1,  69,   1,
         1,  19,  41,   1,  46,  20,   1,  15,  10, 241, 116, 216, 230,
       152, 240, 153,  90, 224,  52, 239, 195,   2,  49,  33,   8,   1,
        93,  44,  22,   1,   1, 126, 125, 202, 120, 119, 180, 215, 214,
         1, 139,   1, 161, 160,  26,  57, 211,   7,  25, 199,  56, 141,
        43,  28,   4,  87, 103, 256, 172, 220, 148, 149, 150,   1, 112,
       243,  85, 115,  29, 113, 123, 134, 133,  17, 135, 132, 194, 219,
       227,  31, 242,  78,  74,   1,  16,  73,  62,  14,  60,  67,  21,
        68,   1,   1,  18, 124,  72,  76, 147,   1,  75, 198, 206,  54,
       205,   1,  97, 111, 237, 201, 236, 192,  11,  55,  48, 193, 109,
       197, 140,  79, 207, 257, 222,  88, 154, 261, 169, 188, 247, 104,
       105, 204, 185,  39, 263, 203, 177, 258,  61,  65,   1,  82,  92,
        91, 168,  94,  83, 100, 259, 210,  51,   1,  42,  66, 144,  30,
       117,   1,  37, 110,  96,   1, 137,  86, 246, 254, 229, 232, 163,
       130, 155,   1, 218,  32, 265,  24,  27, 159, 158,  89, 191, 231,
       129,  40,   9, 128, 251,   1,  59,  58, 143,  38,  50, 173,  81,
       223, 167, 186,   1, 146, 106, 208, 170, 244, 228, 118])
</pre></div>
</div>
</div>
</div>
<p>What about categorical features?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_columns</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">rfe</span><span class="o">.</span><span class="n">support_</span><span class="p">]</span>
<span class="n">selected_columns</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;OverallQual&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;, &#39;PoolQC&#39;,
       &#39;Exterior1st_AsphShn&#39;, &#39;Exterior1st_ImStucc&#39;, &#39;MSSubClass_160&#39;,
       &#39;Heating_OthW&#39;, &#39;RoofMatl_ClyTile&#39;, &#39;RoofMatl_CompShg&#39;,
       &#39;RoofMatl_Roll&#39;, &#39;RoofMatl_WdShngl&#39;, &#39;Condition2_PosN&#39;,
       &#39;MSZoning_C (all)&#39;, &#39;MSZoning_FV&#39;, &#39;KitchenAbvGr_1&#39;,
       &#39;KitchenAbvGr_3&#39;, &#39;BedroomAbvGr_0&#39;, &#39;Neighborhood_Crawfor&#39;,
       &#39;Neighborhood_NoRidge&#39;, &#39;Neighborhood_NridgHt&#39;,
       &#39;Neighborhood_StoneBr&#39;, &#39;SaleCondition_Family&#39;, &#39;RoofStyle_Flat&#39;,
       &#39;LandContour_Bnk&#39;, &#39;SaleType_Con&#39;, &#39;SaleType_New&#39;,
       &#39;Exterior2nd_ImStucc&#39;, &#39;BsmtExposure_Gd&#39;, &#39;Functional_Typ&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">removed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">selected_columns</span><span class="p">]</span>
<span class="n">removed_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotFrontage&#39;,
 &#39;LotArea&#39;,
 &#39;OverallCond&#39;,
 &#39;YearBuilt&#39;,
 &#39;YearRemodAdd&#39;,
 &#39;MasVnrArea&#39;,
 &#39;BsmtFinSF1&#39;,
 &#39;BsmtFinSF2&#39;,
 &#39;BsmtUnfSF&#39;,
 &#39;TotalBsmtSF&#39;,
 &#39;LowQualFinSF&#39;,
 &#39;GrLivArea&#39;,
 &#39;BsmtFullBath&#39;,
 &#39;BsmtHalfBath&#39;,
 &#39;FullBath&#39;,
 &#39;HalfBath&#39;,
 &#39;TotRmsAbvGrd&#39;,
 &#39;Fireplaces&#39;,
 &#39;GarageYrBlt&#39;,
 &#39;GarageCars&#39;,
 &#39;GarageArea&#39;,
 &#39;WoodDeckSF&#39;,
 &#39;OpenPorchSF&#39;,
 &#39;EnclosedPorch&#39;,
 &#39;3SsnPorch&#39;,
 &#39;ScreenPorch&#39;,
 &#39;PoolArea&#39;,
 &#39;MiscVal&#39;,
 &#39;YrSold&#39;,
 &#39;ExterQual&#39;,
 &#39;ExterCond&#39;,
 &#39;BsmtQual&#39;,
 &#39;BsmtCond&#39;,
 &#39;HeatingQC&#39;,
 &#39;KitchenQual&#39;,
 &#39;FireplaceQu&#39;,
 &#39;GarageQual&#39;,
 &#39;GarageCond&#39;,
 &#39;Exterior1st_AsbShng&#39;,
 &#39;Exterior1st_BrkComm&#39;,
 &#39;Exterior1st_BrkFace&#39;,
 &#39;Exterior1st_CBlock&#39;,
 &#39;Exterior1st_CemntBd&#39;,
 &#39;Exterior1st_HdBoard&#39;,
 &#39;Exterior1st_MetalSd&#39;,
 &#39;Exterior1st_Plywood&#39;,
 &#39;Exterior1st_Stone&#39;,
 &#39;Exterior1st_Stucco&#39;,
 &#39;Exterior1st_VinylSd&#39;,
 &#39;Exterior1st_Wd Sdng&#39;,
 &#39;Exterior1st_WdShing&#39;,
 &#39;GarageType_2Types&#39;,
 &#39;GarageType_Attchd&#39;,
 &#39;GarageType_Basment&#39;,
 &#39;GarageType_BuiltIn&#39;,
 &#39;GarageType_CarPort&#39;,
 &#39;GarageType_Detchd&#39;,
 &#39;GarageType_missing&#39;,
 &#39;BldgType_1Fam&#39;,
 &#39;BldgType_2fmCon&#39;,
 &#39;BldgType_Duplex&#39;,
 &#39;BldgType_Twnhs&#39;,
 &#39;BldgType_TwnhsE&#39;,
 &#39;MSSubClass_20&#39;,
 &#39;MSSubClass_30&#39;,
 &#39;MSSubClass_40&#39;,
 &#39;MSSubClass_45&#39;,
 &#39;MSSubClass_50&#39;,
 &#39;MSSubClass_60&#39;,
 &#39;MSSubClass_70&#39;,
 &#39;MSSubClass_75&#39;,
 &#39;MSSubClass_80&#39;,
 &#39;MSSubClass_85&#39;,
 &#39;MSSubClass_90&#39;,
 &#39;MSSubClass_120&#39;,
 &#39;MSSubClass_180&#39;,
 &#39;MSSubClass_190&#39;,
 &#39;Heating_Floor&#39;,
 &#39;Heating_GasA&#39;,
 &#39;Heating_GasW&#39;,
 &#39;Heating_Grav&#39;,
 &#39;Heating_Wall&#39;,
 &#39;RoofMatl_Membran&#39;,
 &#39;RoofMatl_Metal&#39;,
 &#39;RoofMatl_Tar&amp;Grv&#39;,
 &#39;RoofMatl_WdShake&#39;,
 &#39;Utilities_AllPub&#39;,
 &#39;Utilities_NoSeWa&#39;,
 &#39;MoSold_1&#39;,
 &#39;MoSold_2&#39;,
 &#39;MoSold_3&#39;,
 &#39;MoSold_4&#39;,
 &#39;MoSold_5&#39;,
 &#39;MoSold_6&#39;,
 &#39;MoSold_7&#39;,
 &#39;MoSold_8&#39;,
 &#39;MoSold_9&#39;,
 &#39;MoSold_10&#39;,
 &#39;MoSold_11&#39;,
 &#39;MoSold_12&#39;,
 &#39;Condition2_Artery&#39;,
 &#39;Condition2_Feedr&#39;,
 &#39;Condition2_Norm&#39;,
 &#39;Condition2_PosA&#39;,
 &#39;Condition2_RRAe&#39;,
 &#39;Condition2_RRAn&#39;,
 &#39;Condition2_RRNn&#39;,
 &#39;MSZoning_RH&#39;,
 &#39;MSZoning_RL&#39;,
 &#39;MSZoning_RM&#39;,
 &#39;MasVnrType_BrkCmn&#39;,
 &#39;MasVnrType_BrkFace&#39;,
 &#39;MasVnrType_None&#39;,
 &#39;MasVnrType_Stone&#39;,
 &#39;MasVnrType_missing&#39;,
 &#39;KitchenAbvGr_2&#39;,
 &#39;Condition1_Artery&#39;,
 &#39;Condition1_Feedr&#39;,
 &#39;Condition1_Norm&#39;,
 &#39;Condition1_PosA&#39;,
 &#39;Condition1_PosN&#39;,
 &#39;Condition1_RRAe&#39;,
 &#39;Condition1_RRAn&#39;,
 &#39;Condition1_RRNe&#39;,
 &#39;Condition1_RRNn&#39;,
 &#39;HouseStyle_1.5Fin&#39;,
 &#39;HouseStyle_1.5Unf&#39;,
 &#39;HouseStyle_1Story&#39;,
 &#39;HouseStyle_2.5Fin&#39;,
 &#39;HouseStyle_2.5Unf&#39;,
 &#39;HouseStyle_2Story&#39;,
 &#39;HouseStyle_SFoyer&#39;,
 &#39;HouseStyle_SLvl&#39;,
 &#39;GarageFinish_Fin&#39;,
 &#39;GarageFinish_RFn&#39;,
 &#39;GarageFinish_Unf&#39;,
 &#39;GarageFinish_missing&#39;,
 &#39;BedroomAbvGr_1&#39;,
 &#39;BedroomAbvGr_2&#39;,
 &#39;BedroomAbvGr_3&#39;,
 &#39;BedroomAbvGr_4&#39;,
 &#39;BedroomAbvGr_5&#39;,
 &#39;BedroomAbvGr_6&#39;,
 &#39;BedroomAbvGr_8&#39;,
 &#39;Electrical_FuseA&#39;,
 &#39;Electrical_FuseF&#39;,
 &#39;Electrical_FuseP&#39;,
 &#39;Electrical_Mix&#39;,
 &#39;Electrical_SBrkr&#39;,
 &#39;Electrical_missing&#39;,
 &#39;Neighborhood_Blmngtn&#39;,
 &#39;Neighborhood_Blueste&#39;,
 &#39;Neighborhood_BrDale&#39;,
 &#39;Neighborhood_BrkSide&#39;,
 &#39;Neighborhood_ClearCr&#39;,
 &#39;Neighborhood_CollgCr&#39;,
 &#39;Neighborhood_Edwards&#39;,
 &#39;Neighborhood_Gilbert&#39;,
 &#39;Neighborhood_IDOTRR&#39;,
 &#39;Neighborhood_MeadowV&#39;,
 &#39;Neighborhood_Mitchel&#39;,
 &#39;Neighborhood_NAmes&#39;,
 &#39;Neighborhood_NPkVill&#39;,
 &#39;Neighborhood_NWAmes&#39;,
 &#39;Neighborhood_OldTown&#39;,
 &#39;Neighborhood_SWISU&#39;,
 &#39;Neighborhood_Sawyer&#39;,
 &#39;Neighborhood_SawyerW&#39;,
 &#39;Neighborhood_Somerst&#39;,
 &#39;Neighborhood_Timber&#39;,
 &#39;Neighborhood_Veenker&#39;,
 &#39;SaleCondition_Abnorml&#39;,
 &#39;SaleCondition_AdjLand&#39;,
 &#39;SaleCondition_Alloca&#39;,
 &#39;SaleCondition_Normal&#39;,
 &#39;SaleCondition_Partial&#39;,
 &#39;Alley_Grvl&#39;,
 &#39;Alley_Pave&#39;,
 &#39;Alley_missing&#39;,
 &#39;LotConfig_Corner&#39;,
 &#39;LotConfig_CulDSac&#39;,
 &#39;LotConfig_FR2&#39;,
 &#39;LotConfig_FR3&#39;,
 &#39;LotConfig_Inside&#39;,
 &#39;Fence_GdPrv&#39;,
 &#39;Fence_GdWo&#39;,
 &#39;Fence_MnPrv&#39;,
 &#39;Fence_MnWw&#39;,
 &#39;Fence_missing&#39;,
 &#39;BsmtFinType1_ALQ&#39;,
 &#39;BsmtFinType1_BLQ&#39;,
 &#39;BsmtFinType1_GLQ&#39;,
 &#39;BsmtFinType1_LwQ&#39;,
 &#39;BsmtFinType1_Rec&#39;,
 &#39;BsmtFinType1_Unf&#39;,
 &#39;BsmtFinType1_missing&#39;,
 &#39;Foundation_BrkTil&#39;,
 &#39;Foundation_CBlock&#39;,
 &#39;Foundation_PConc&#39;,
 &#39;Foundation_Slab&#39;,
 &#39;Foundation_Stone&#39;,
 &#39;Foundation_Wood&#39;,
 &#39;PavedDrive_N&#39;,
 &#39;PavedDrive_P&#39;,
 &#39;PavedDrive_Y&#39;,
 &#39;LandSlope_Gtl&#39;,
 &#39;LandSlope_Mod&#39;,
 &#39;LandSlope_Sev&#39;,
 &#39;RoofStyle_Gable&#39;,
 &#39;RoofStyle_Gambrel&#39;,
 &#39;RoofStyle_Hip&#39;,
 &#39;RoofStyle_Mansard&#39;,
 &#39;RoofStyle_Shed&#39;,
 &#39;MiscFeature_Gar2&#39;,
 &#39;MiscFeature_Othr&#39;,
 &#39;MiscFeature_Shed&#39;,
 &#39;MiscFeature_TenC&#39;,
 &#39;MiscFeature_missing&#39;,
 &#39;LandContour_HLS&#39;,
 &#39;LandContour_Low&#39;,
 &#39;LandContour_Lvl&#39;,
 &#39;SaleType_COD&#39;,
 &#39;SaleType_CWD&#39;,
 &#39;SaleType_ConLD&#39;,
 &#39;SaleType_ConLI&#39;,
 &#39;SaleType_ConLw&#39;,
 &#39;SaleType_Oth&#39;,
 &#39;SaleType_WD&#39;,
 &#39;Exterior2nd_AsbShng&#39;,
 &#39;Exterior2nd_AsphShn&#39;,
 &#39;Exterior2nd_Brk Cmn&#39;,
 &#39;Exterior2nd_BrkFace&#39;,
 &#39;Exterior2nd_CBlock&#39;,
 &#39;Exterior2nd_CmentBd&#39;,
 &#39;Exterior2nd_HdBoard&#39;,
 &#39;Exterior2nd_MetalSd&#39;,
 &#39;Exterior2nd_Other&#39;,
 &#39;Exterior2nd_Plywood&#39;,
 &#39;Exterior2nd_Stone&#39;,
 &#39;Exterior2nd_Stucco&#39;,
 &#39;Exterior2nd_VinylSd&#39;,
 &#39;Exterior2nd_Wd Sdng&#39;,
 &#39;Exterior2nd_Wd Shng&#39;,
 &#39;CentralAir_N&#39;,
 &#39;CentralAir_Y&#39;,
 &#39;LotShape_IR1&#39;,
 &#39;LotShape_IR2&#39;,
 &#39;LotShape_IR3&#39;,
 &#39;LotShape_Reg&#39;,
 &#39;BsmtExposure_Av&#39;,
 &#39;BsmtExposure_Mn&#39;,
 &#39;BsmtExposure_No&#39;,
 &#39;BsmtExposure_missing&#39;,
 &#39;Street_Grvl&#39;,
 &#39;Street_Pave&#39;,
 &#39;Functional_Maj1&#39;,
 &#39;Functional_Maj2&#39;,
 &#39;Functional_Min1&#39;,
 &#39;Functional_Min2&#39;,
 &#39;Functional_Mod&#39;,
 &#39;BsmtFinType2_ALQ&#39;,
 &#39;BsmtFinType2_BLQ&#39;,
 &#39;BsmtFinType2_GLQ&#39;,
 &#39;BsmtFinType2_LwQ&#39;,
 &#39;BsmtFinType2_Rec&#39;,
 &#39;BsmtFinType2_Unf&#39;,
 &#39;BsmtFinType2_missing&#39;]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Does it make sense that we removed <code class="docutils literal notranslate"><span class="pre">BldgType_Duplex</span></code> but kept <code class="docutils literal notranslate"><span class="pre">BldgType_1Fam</span></code>?</p>
<ul>
<li><p>This is a matter of opinion, I guess.</p></li>
</ul>
</li>
<li><p>There are more sophisticated ways of selecting categorical features.</p></li>
<li><p>This seems to be unresolved in sklearn: https://github.com/scikit-learn/scikit-learn/issues/8480</p></li>
</ul>
<section id="optional-feature-selection-and-ohe">
<h4>(optional) Feature selection and OHE<a class="headerlink" href="#optional-feature-selection-and-ohe" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>If you are using OHE with <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, and then feature selection, the choice to drop the first is no longer arbitrary.</p>
<ul>
<li><p>Say you have categories A,B,C,D</p></li>
<li><p>you drop=’first’</p></li>
<li><p>so then you have B,C,D and 0,0,0 means A.</p></li>
<li><p>Then you feature select out D</p></li>
<li><p>Now you have B,C</p></li>
<li><p>but now 0,0 means A or D.</p></li>
<li><p>So now the feature removed by feature selection becomes mixed up with the “arbitrary” feature A.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="how-to-choose-the-number-of-features-to-select">
<h3>How to choose the number of features to select?<a class="headerlink" href="#how-to-choose-the-number-of-features-to-select" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose you don’t know the number of relevant features in advance,</p></li>
<li><p>You can find them using cross validation with <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_selection.RFECV.html#sklearn.feature_selection.RFECV">RFECV</a></p>
<ul>
<li><p>You would definitely not want to use training error! (Why?)</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe_cv</span> <span class="o">=</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rfe_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_enc</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of selected features: </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rfe_cv</span><span class="o">.</span><span class="n">n_features_</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of selected features: 80/297
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>It stopped once it got to 80 features.</p></li>
<li><p>Dropping down to 79 would lower the cross-validation score.</p>
<ul>
<li><p>This is similar to using cross-validation to tune a hyperparameter.</p></li>
<li><p>Indeed, the number of selected features <em>is</em> a hyperparameter.</p></li>
</ul>
</li>
</ul>
<p>We are violating the Golden Rule a bit here. Can we incorporate this in a pipeline?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeCV</span>

<span class="n">pipe_rfe_ridgecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">RidgeCV</span><span class="p">())</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;pipe RFECV + RidgeCV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe_rfe_ridgecv</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RidgeCV</th>
      <th>RFE with 30 feats</th>
      <th>pipe RFECV + RidgeCV</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit_time</th>
      <td>0.109436</td>
      <td>0.525119</td>
      <td>6.718892</td>
    </tr>
    <tr>
      <th>score_time</th>
      <td>0.003238</td>
      <td>0.003164</td>
      <td>0.011943</td>
    </tr>
    <tr>
      <th>test_score</th>
      <td>0.797017</td>
      <td>0.739485</td>
      <td>0.787224</td>
    </tr>
    <tr>
      <th>train_score</th>
      <td>0.902361</td>
      <td>0.848590</td>
      <td>0.898362</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rfe_ridgecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pipe_rfe_ridgecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The number of features selected by RFE: &quot;</span><span class="p">,</span>
    <span class="n">pipe_rfe_ridgecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[False False  True False False False False False False  True  True  True
  True False  True False False False False False False False  True False
 False False False False False False False False False False  True False
 False  True False False False  True False  True False  True False  True
 False  True False False False False False False False False False False
 False False False  True False False False False False False False False
 False False False False False False False False  True  True  True False
 False False False False  True False  True  True  True  True  True  True
  True  True  True  True False False False False False False False False
 False False False False  True  True  True  True  True False  True  True
  True  True False False False False False False False False  True False
  True False False  True False False  True  True False False False  True
  True  True False False False False False False False False  True False
 False False False  True False False False False  True False False False
 False False  True False False False  True  True False False  True False
 False  True False  True  True  True False False False False  True False
 False False False False  True False False False False False False  True
 False  True False False False False False False False False False False
 False False False False False False False False  True False False False
 False False False  True False False False False False False False False
 False  True  True  True False False  True False  True  True False False
  True False False False False False False False False False  True False
  True False  True  True False False False False False False  True  True
 False False  True False False False  True  True False False False False
 False  True False False False False False False False]
The number of features selected by RFE:  80
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-do-we-get-feature-names-of-selected-features">
<h3>How do we get feature names of selected features?<a class="headerlink" href="#how-do-we-get-feature-names-of-selected-features" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span>
<span class="n">support</span> <span class="o">=</span> <span class="n">pipe_rfe_ridgecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">RFE_selected_feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)[</span><span class="n">support</span><span class="p">]</span>
<span class="n">RFE_selected_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;OverallQual&#39;, &#39;BsmtUnfSF&#39;, &#39;TotalBsmtSF&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;,
       &#39;GrLivArea&#39;, &#39;GarageCars&#39;, &#39;BsmtQual&#39;, &#39;KitchenQual&#39;, &#39;PoolQC&#39;,
       &#39;Exterior1st_AsphShn&#39;, &#39;Exterior1st_BrkFace&#39;,
       &#39;Exterior1st_CemntBd&#39;, &#39;Exterior1st_ImStucc&#39;, &#39;GarageType_missing&#39;,
       &#39;MSSubClass_120&#39;, &#39;MSSubClass_160&#39;, &#39;MSSubClass_180&#39;,
       &#39;Heating_OthW&#39;, &#39;RoofMatl_ClyTile&#39;, &#39;RoofMatl_CompShg&#39;,
       &#39;RoofMatl_Membran&#39;, &#39;RoofMatl_Metal&#39;, &#39;RoofMatl_Roll&#39;,
       &#39;RoofMatl_Tar&amp;Grv&#39;, &#39;RoofMatl_WdShake&#39;, &#39;RoofMatl_WdShngl&#39;,
       &#39;Utilities_AllPub&#39;, &#39;Utilities_NoSeWa&#39;, &#39;Condition2_Artery&#39;,
       &#39;Condition2_Feedr&#39;, &#39;Condition2_Norm&#39;, &#39;Condition2_PosA&#39;,
       &#39;Condition2_PosN&#39;, &#39;Condition2_RRAn&#39;, &#39;Condition2_RRNn&#39;,
       &#39;MSZoning_C (all)&#39;, &#39;MSZoning_FV&#39;, &#39;KitchenAbvGr_1&#39;,
       &#39;KitchenAbvGr_3&#39;, &#39;Condition1_Norm&#39;, &#39;Condition1_RRAe&#39;,
       &#39;Condition1_RRAn&#39;, &#39;HouseStyle_1.5Unf&#39;, &#39;HouseStyle_1Story&#39;,
       &#39;HouseStyle_2.5Fin&#39;, &#39;BedroomAbvGr_0&#39;, &#39;BedroomAbvGr_5&#39;,
       &#39;Electrical_FuseP&#39;, &#39;Neighborhood_BrDale&#39;, &#39;Neighborhood_Crawfor&#39;,
       &#39;Neighborhood_Edwards&#39;, &#39;Neighborhood_MeadowV&#39;,
       &#39;Neighborhood_NPkVill&#39;, &#39;Neighborhood_NoRidge&#39;,
       &#39;Neighborhood_NridgHt&#39;, &#39;Neighborhood_OldTown&#39;,
       &#39;Neighborhood_StoneBr&#39;, &#39;SaleCondition_Family&#39;,
       &#39;LotConfig_CulDSac&#39;, &#39;LotConfig_FR3&#39;, &#39;Foundation_Wood&#39;,
       &#39;RoofStyle_Flat&#39;, &#39;MiscFeature_missing&#39;, &#39;LandContour_Bnk&#39;,
       &#39;LandContour_HLS&#39;, &#39;SaleType_COD&#39;, &#39;SaleType_Con&#39;,
       &#39;SaleType_ConLD&#39;, &#39;SaleType_New&#39;, &#39;Exterior2nd_ImStucc&#39;,
       &#39;Exterior2nd_Other&#39;, &#39;Exterior2nd_Stone&#39;, &#39;Exterior2nd_Stucco&#39;,
       &#39;LotShape_IR2&#39;, &#39;LotShape_IR3&#39;, &#39;BsmtExposure_Gd&#39;, &#39;Street_Grvl&#39;,
       &#39;Street_Pave&#39;, &#39;Functional_Typ&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="rfe-for-classification">
<h3>RFE for classification<a class="headerlink" href="#rfe-for-classification" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s try RFE on the spotify dataset</span>
<span class="c1"># You can get the dataset from here: https://www.kaggle.com/geomack/spotifyclassification/</span>
<span class="n">spotify_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/spotify.csv&quot;</span><span class="p">)</span>
<span class="n">spotify_df</span><span class="o">.</span><span class="n">columns</span>

<span class="n">numcols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;acousticness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;danceability&quot;</span><span class="p">,</span>
    <span class="s2">&quot;duration_ms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;energy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instrumentalness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="p">,</span>
    <span class="s2">&quot;liveness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;loudness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mode&quot;</span><span class="p">,</span>
    <span class="s2">&quot;speechiness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tempo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time_signature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;valence&quot;</span><span class="p">,</span>
    <span class="s2">&quot;target&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">catcols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;song_title&quot;</span><span class="p">,</span> <span class="s2">&quot;artist&quot;</span><span class="p">,</span> <span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">]</span>

<span class="n">spotify_df</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">catcols</span><span class="p">)</span>
<span class="n">spotify_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;acousticness&#39;, &#39;danceability&#39;, &#39;duration_ms&#39;, &#39;energy&#39;,
       &#39;instrumentalness&#39;, &#39;key&#39;, &#39;liveness&#39;, &#39;loudness&#39;, &#39;mode&#39;,
       &#39;speechiness&#39;, &#39;tempo&#39;, &#39;time_signature&#39;, &#39;valence&#39;, &#39;target&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create train/test splits</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">spotify_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="n">X_train_spo</span><span class="p">,</span> <span class="n">X_test_spo</span><span class="p">,</span> <span class="n">y_train_spo</span><span class="p">,</span> <span class="n">y_test_spo</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">111</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s2">&quot;liblinear&quot;</span><span class="p">)</span>
<span class="n">pipe_rfe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">lr</span><span class="p">),</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X_train_spo</span><span class="p">,</span> <span class="n">y_train_spo</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.008807
score_time     0.001743
test_score     0.663387
train_score    0.671884
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe_rfe</span><span class="p">,</span> <span class="n">X_train_spo</span><span class="p">,</span> <span class="n">y_train_spo</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.118094
score_time     0.001776
test_score     0.657804
train_score    0.674675
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="search-and-score-method-e-g-forward-selection">
<h2>2. Search and score method (e.g., forward selection)<a class="headerlink" href="#search-and-score-method-e-g-forward-selection" title="Permalink to this heading">#</a></h2>
<section id="general-idea-of-search-and-score-methods">
<h3>General idea of search and score methods<a class="headerlink" href="#general-idea-of-search-and-score-methods" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Define a <strong>scoring function</strong> <span class="math notranslate nohighlight">\(f(S)\)</span> that measures the quality of the set of features <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p>Now <strong>search</strong> for the set of features <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
<li><p>Example: Suppose you have three features: <span class="math notranslate nohighlight">\(A, B, C\)</span></p>
<ul>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S= \{B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{B,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B,C\}\)</span></p></li>
</ul>
</li>
<li><p>Return <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
<li><p>How many distinct combinations we have to try out?</p></li>
</ul>
</section>
<section id="search-and-score-what-scoring-function-should-we-use">
<h3>Search and <strong>score</strong>: What scoring function should we use?<a class="headerlink" href="#search-and-score-what-scoring-function-should-we-use" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How do we measure the quality of the set of features <span class="math notranslate nohighlight">\(S\)</span>?</p></li>
<li><p>Pick a metric.</p></li>
<li><p>Find the set of features that gives you the best cross-validation scores with that metric.</p></li>
<li><p>Picking features set based on the training error would be a bad idea.</p></li>
</ul>
</section>
<section id="problems-with-search-and-score-methods">
<h3>Problems with search and score methods<a class="headerlink" href="#problems-with-search-and-score-methods" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>If there are <span class="math notranslate nohighlight">\(d\)</span> features, there are <span class="math notranslate nohighlight">\(2^d\)</span> combinations to search.</p>
<ul>
<li><p>For example, if <span class="math notranslate nohighlight">\(d=100\)</span>, we have <span class="math notranslate nohighlight">\(1.26 \times 10^{30}\)</span> combinations to search</p></li>
</ul>
</li>
<li><p>Large search space.</p></li>
<li><p>Optimization bias is high: we are optimizing over <span class="math notranslate nohighlight">\(2^d\)</span> models!</p></li>
<li><p>Irrelevant variables sometimes help by chance. Prone to overfitting.</p></li>
</ul>
<p>How do we deal with these problems?</p>
<ul class="simple">
<li><p>How can we deal with the large search space?</p>
<ul>
<li><p>Instead of exhaustively searching for this space, we go with greedy approaches. No guarantee to find optimal feature set.</p></li>
</ul>
</li>
<li><p>How can we pick a model that’s less likely to overfit?</p>
<ul>
<li><p>Adding complexity penalty</p></li>
</ul>
</li>
</ul>
</section>
<section id="model-selection-complexity-penalty">
<h3>Model selection: complexity penalty<a class="headerlink" href="#model-selection-complexity-penalty" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In search and score methods, to reduce overfitting, we can use complexity penalties, i.e., we can penalize complex models.</p></li>
<li><p>So far we have been doing model selection using cross validation.</p></li>
<li><p>Another way to select a model is based on complexity</p>
<ul>
<li><p>penalize complex models</p></li>
<li><p>complexity in terms of the number of degrees of freedom or parameters in the model</p></li>
</ul>
</li>
</ul>
<div class="math notranslate nohighlight">
\[ score(p) = \frac{1}{2}\lVert{Z_pv -y}\rVert^2 + \lambda k\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p \rightarrow\)</span>  degree of polynomial in polynomial transformations</p></li>
<li><p><span class="math notranslate nohighlight">\(k \rightarrow \text{estimated parameters/degrees of freedom}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda \rightarrow \text{penalization factor}\)</span></p></li>
</ul>
<p>Pick the model with lowest score.</p>
</section>
<section id="scoring-using-complexity-penalties">
<h3>Scoring using complexity penalties<a class="headerlink" href="#scoring-using-complexity-penalties" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>You can think of features with non-zero weights as selected features.</p></li>
<li><p>Find <span class="math notranslate nohighlight">\(S\)</span> and <span class="math notranslate nohighlight">\(W_s\)</span> minimizing the squared error + the number of selected features</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ score(S) = \frac{1}{2}\sum_i^n(w_s^TX_{iS} -y_i)^2 + size(S)\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_{iS}\)</span> is features <span class="math notranslate nohighlight">\(S\)</span> of example <span class="math notranslate nohighlight">\(X_i\)</span>.</p></li>
<li><p>Example: Suppose <span class="math notranslate nohighlight">\(S_1 = \{x_1, x_2, x_4\}\)</span> <span class="math notranslate nohighlight">\(S_2 = \{x_1, x_2, x_4, x_5\}\)</span> have similar validation errors, it prefers <span class="math notranslate nohighlight">\(S_1\)</span>.</p></li>
<li><p>Instead of <span class="math notranslate nohighlight">\(size(S)\)</span>, we usually write <span class="math notranslate nohighlight">\(L0\)</span> “norm”</p></li>
</ul>
</section>
<section id="l0-norm-and-the-number-of-features-used">
<h3><span class="math notranslate nohighlight">\(L0\)</span> “norm”  and the number of features used<a class="headerlink" href="#l0-norm-and-the-number-of-features-used" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In linear models, setting <span class="math notranslate nohighlight">\(w_j = 0\)</span> is the same as removing the feature.</p></li>
<li><p>Example: $<span class="math notranslate nohighlight">\(\hat{y_i} = w_1x_1 + w_2x_2 + w_3x_3 + w_4x_4\)</span>$</p></li>
<li><p><span class="math notranslate nohighlight">\(L0\)</span> “norm” is the number of non-zero values.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(w = \begin{bmatrix}0.8 \\ 0.0 \\ 0.03 \\0.1\end{bmatrix}\)</span>, <span class="math notranslate nohighlight">\(\lVert w\rVert_0 = 3\)</span> and if <span class="math notranslate nohighlight">\(w = \begin{bmatrix}0.0 \\ 0.0 \\ 0.22 \\0.0\end{bmatrix}\)</span>, <span class="math notranslate nohighlight">\(\lVert w\rVert_0 = 1\)</span></p></li>
</ul>
</section>
<section id="scoring-using-l0-norm">
<h3>Scoring using <span class="math notranslate nohighlight">\(L0\)</span> “norm”<a class="headerlink" href="#scoring-using-l0-norm" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Most common “scores” have the form.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ score(S) = \frac{1}{2}\lVert{Xw -y}\rVert^2 + \lambda \lVert w\rVert_0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\lambda \rightarrow \text{penalization factor (strength of penalty) }\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \lVert w\rVert_0 \rightarrow\)</span> Number of non-zero elements in <span class="math notranslate nohighlight">\(w\)</span> (i.e., number of features used)</p></li>
<li><p>To increase the degrees of freedom by one, need to decrease the error by <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
<li><p>Prefer smaller degrees of freedom if errors are similar.</p></li>
<li><p>Can’t optimize because the function is discontinuous in <span class="math notranslate nohighlight">\(\lVert w\rVert_0\)</span></p>
<ul>
<li><p>Search over possible models</p></li>
</ul>
</li>
</ul>
</section>
<section id="forward-selection-greedy-approach-for-search-and-score">
<h3>Forward selection: greedy approach for search and score<a class="headerlink" href="#forward-selection-greedy-approach-for-search-and-score" title="Permalink to this heading">#</a></h3>
<p>Given <span class="math notranslate nohighlight">\(X = \{x_1, x_2, \dots, x_n\}\)</span> and <span class="math notranslate nohighlight">\(y\)</span></p>
<ol class="arabic simple">
<li><p>Start with an empty set of features <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Initialize the score (e.g., score = <span class="math notranslate nohighlight">\(\infty\)</span>, if score is validation error)</p></li>
<li><p>For each possible feature <span class="math notranslate nohighlight">\(x_j, 1\leq j \leq n\)</span></p>
<ul class="simple">
<li><p>Compute the scores of features in <span class="math notranslate nohighlight">\(S\)</span> combined with <span class="math notranslate nohighlight">\(x_j\)</span></p></li>
</ul>
</li>
<li><p>If no <span class="math notranslate nohighlight">\(x_j\)</span> improves the score, stop.</p></li>
<li><p>Otherwise add feature <span class="math notranslate nohighlight">\(x_j\)</span> to <span class="math notranslate nohighlight">\(S\)</span> which improves the score the most, update the score, and go back to step 2.</p></li>
</ol>
</section>
<section id="forward-selection-example">
<h3>Forward selection: Example<a class="headerlink" href="#forward-selection-example" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Not implemented in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>! (There is an optional question in lab 2 which asks you to implement it.)</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/forward_selection.png"><img alt="../_images/forward_selection.png" src="../_images/forward_selection.png" style="width: 1000px; height: 1000px;" /></a>
<p>Forward selection is not implemented in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>. But it is in a package <code class="docutils literal notranslate"><span class="pre">mlxtend</span></code>, which is compatible with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> pipelines.</p>
<p>You can install <code class="docutils literal notranslate"><span class="pre">mlxtend</span></code> in our environment as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">mlxtend</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlxtend.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sfs</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_forward_ridgecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> 
    <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_features</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">RidgeCV</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe_forward_ridgecv</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       32.374404
score_time      0.011726
test_score      0.791236
train_score     0.872936
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="how-to-get-feature-names-of-selected-features">
<h3>How to get feature names of selected features?<a class="headerlink" href="#how-to-get-feature-names-of-selected-features" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_forward_ridgecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span>
<span class="n">fs_selected_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pipe_forward_ridgecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;sequentialfeatureselector&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">k_feature_idx_</span><span class="p">]</span>
<span class="n">fs_selected_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotArea&#39;,
 &#39;OverallQual&#39;,
 &#39;OverallCond&#39;,
 &#39;YearBuilt&#39;,
 &#39;GrLivArea&#39;,
 &#39;GarageCars&#39;,
 &#39;BsmtQual&#39;,
 &#39;KitchenQual&#39;,
 &#39;Exterior1st_BrkFace&#39;,
 &#39;BldgType_1Fam&#39;,
 &#39;MSSubClass_20&#39;,
 &#39;Condition1_Norm&#39;,
 &#39;GarageFinish_Fin&#39;,
 &#39;Neighborhood_Crawfor&#39;,
 &#39;Neighborhood_NoRidge&#39;,
 &#39;Neighborhood_NridgHt&#39;,
 &#39;Neighborhood_Somerst&#39;,
 &#39;Neighborhood_StoneBr&#39;,
 &#39;BsmtFinType1_Unf&#39;,
 &#39;BsmtExposure_Gd&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="forward-selection">
<h3>Forward selection<a class="headerlink" href="#forward-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Not guaranteed to find the best feature set but reduces many problems</p>
<ul>
<li><p>Cheaper (considers only <span class="math notranslate nohighlight">\(O(d^2)\)</span> models compared to <span class="math notranslate nohighlight">\(O(2^d)\)</span> models)</p></li>
<li><p>Overfits less (less optimization bias)</p></li>
</ul>
</li>
</ul>
</section>
<section id="other-ways-to-search">
<h3>Other ways to search<a class="headerlink" href="#other-ways-to-search" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Backward selection</p></li>
<li><p>Stochastic local search</p>
<ul>
<li><p>Inject randomness so that we can explore new parts of the search space</p></li>
<li><p>Simulated annealing</p></li>
<li><p>Genetic algorithms</p></li>
</ul>
</li>
</ul>
</section>
<section id="warnings-about-feature-selection">
<h3>Warnings about feature selection<a class="headerlink" href="#warnings-about-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A feature’s relevance is only defined in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>If features can be predicted from other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span> for the data you have.</p></li>
</ul>
</li>
</ul>
<section id="problems-with-feature-selection-optional">
<h4>Problems with feature selection (optional)<a class="headerlink" href="#problems-with-feature-selection-optional" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>The term ‘relevance’ is not clearly defined.</p></li>
<li><p>What all things can go wrong with feature selection?</p></li>
</ul>
</section>
<section id="example-is-relevance-clearly-defined">
<h4>Example: Is “Relevance” clearly defined?<a class="headerlink" href="#example-is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Consider a supervised classification task of predicting whether someone has particular genetic variation (SNP)
<a class="reference internal" href="../_images/sex_mom_dad.png"><img alt="../_images/sex_mom_dad.png" src="../_images/sex_mom_dad.png" style="width: 600px; height: 600px;" /></a></p></li>
<li><p>True model: You almost have the same value as your biological mom.</p></li>
</ul>
</section>
<section id="is-relevance-clearly-defined">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>True model: You almost have the same value for SNP as your biological mom.</p>
<ul>
<li><p>(SNP = biological mom) with very high probability</p></li>
<li><p>(SNP != biological mom) with very low probability</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/SNP.png"><img alt="../_images/SNP.png" src="../_images/SNP.png" style="width: 200px; height: 200px;" /></a>
</section>
<section id="id2">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if “mom” feature is repeated?</p></li>
<li><p>Should we pick both? Should we pick one of them because it predicts the other?</p></li>
<li><p>Dependence, collinearity for linear models</p>
<ul>
<li><p>If a feature can be predicted from the other, don’t know which one to pick.</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_mom_mom2_dad.png"><img alt="../_images/sex_mom_mom2_dad.png" src="../_images/sex_mom_mom2_dad.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id3">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we add (maternal) “grandma” feature?</p></li>
<li><p>Is it relevant?</p>
<ul>
<li><p>We can predict SNP accurately using this feature</p></li>
</ul>
</li>
<li><p>Conditional independence</p>
<ul>
<li><p>But grandma is irrelevant given biological mom feature</p></li>
<li><p>Relevant features may become irrelevant given other features</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_mom_dad_grandma.png"><img alt="../_images/sex_mom_dad_grandma.png" src="../_images/sex_mom_dad_grandma.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id4">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we do not know biological mom feature and we just have grandma feature</p></li>
<li><p>It becomes relevant now.</p>
<ul>
<li><p>Without mom feature this is the best we can do.</p></li>
</ul>
</li>
<li><p>General problem (“taco Tuesday” problem)</p>
<ul>
<li><p>Features can become relevant due to missing information</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_dad_grandma.png"><img alt="../_images/sex_dad_grandma.png" src="../_images/sex_dad_grandma.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id5">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Are there any relevant features now?</p></li>
<li><p>They may have some common maternal ancestor.</p></li>
<li><p>What if mom likes dad because they share SNP?</p></li>
<li><p>General problem (Confounding)</p>
<ul>
<li><p>Hidden features can make irrelevant features relevant.</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_dad.png"><img alt="../_images/sex_dad.png" src="../_images/sex_dad.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id6">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Now what if we have “sibling” feature?</p></li>
<li><p>The feature is relevant in predicting SNP but not the cause of SNP.</p></li>
<li><p>General problem (non causality)</p>
<ul>
<li><p>the relevant feature may not be causal</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_dad_sibling.png"><img alt="../_images/sex_dad_sibling.png" src="../_images/sex_dad_sibling.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id7">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if you are given “baby” feature?</p></li>
<li><p>Now the sex feature becomes relevant.</p>
<ul>
<li><p>“baby” feature is relevant when sex == F</p></li>
</ul>
</li>
<li><p>General problem (context specific relevance)</p>
<ul>
<li><p>adding a feature can make an irrelevant feature relevant</p></li>
</ul>
</li>
</ul>
<a class="reference internal image-reference" href="../_images/sex_dad_baby.png"><img alt="../_images/sex_dad_baby.png" src="../_images/sex_dad_baby.png" style="width: 600px; height: 600px;" /></a>
</section>
<section id="id8">
<h4>Warnings about feature selection<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>A feature is only relevant in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>Confounding factors can make irrelevant features the most relevant.</p></li>
<li><p>If features can be predicted from other other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Is feature selection completely hopeless?</p>
<ul>
<li><p>It is messy but we still need to do it. So we try to do our best!</p></li>
</ul>
</li>
</ul>
</section>
<section id="general-advice-on-finding-relevant-features">
<h4>General advice on finding relevant features<a class="headerlink" href="#general-advice-on-finding-relevant-features" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Try the association approach</p></li>
<li><p>Try forward selection with different values of <span class="math notranslate nohighlight">\(\lambda\)</span></p></li>
<li><p>Try other feature selection methods (e.g., <code class="docutils literal notranslate"><span class="pre">RFE</span></code>, simulated annealing, genetic algorithms)</p></li>
<li><p>Talk to domain experts; they probably have an idea why certain features are relevant.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Recursive feature elimination (RFE)</p>
<ul>
<li><p>Fit parameters of a linear model.</p></li>
<li><p>Prune features with small weights.</p></li>
<li><p>Repeat till we reach the number of required features.</p></li>
</ul>
</li>
<li><p>Most common approach for feature selection is <strong>search</strong> and <strong>score</strong>.</p></li>
<li><p>It’s hard to define “score” and it’s hard to “search”.</p></li>
<li><p>Most common “scores” have the form of <span class="math notranslate nohighlight">\(\lVert L_0\rVert\)</span> “norm”</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ score(S) = \frac{1}{2}\lVert{Xw -y}\rVert^2 + \lambda \lVert w\rVert_0\]</div>
<ul class="simple">
<li><p>For “search”, we use greedy methods such as forward search.</p></li>
<li><p>Methods work well on toy data but could be frustrating on real data.</p>
<ul>
<li><p>different methods may return very different results</p></li>
</ul>
</li>
</ul>
</section>
<section id="a-rough-guide-to-feature-selection-bonus-slide">
<h4>A rough guide to feature selection (bonus slide)<a class="headerlink" href="#a-rough-guide-to-feature-selection-bonus-slide" title="Permalink to this heading">#</a></h4>
<a class="reference internal image-reference" href="../_images/feature_selection_guidelines.png"><img alt="../_images/feature_selection_guidelines.png" src="../_images/feature_selection_guidelines.png" style="width: 1000px; height: 1000px;" /></a>
<p>Source: Mark Schmidt’s slides from last year</p>
</section>
<section id="relevant-resources">
<h4>Relevant resources<a class="headerlink" href="#relevant-resources" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Genome-wide_association_study">Genome-wide association study</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/feature_selection.html">sklearn feature selection</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=ioXKxulmwVQ">PyData: A Practical Guide to Dimensionality Reduction Techniques</a></p></li>
</ul>
</section>
</section>
<section id="true-false-questions-feature-selection-class-discussion">
<h3>True/False questions: Feature selection (Class discussion)<a class="headerlink" href="#true-false-questions-feature-selection-class-discussion" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Simple association-based feature selection approaches do not take into account the interaction between features.<br></p></li>
<li><p>You can carry out feature selection using linear models by pruning the features which have very small weights (i.e., coefficients less than a threshold).<br></p></li>
<li><p>Forward search is guaranteed to find the best feature set.<br></p></li>
<li><p>A scoring function in score and search methods can be written as follows. $<span class="math notranslate nohighlight">\( score(S) = \frac{1}{2}\lVert{Xw -y}\rVert^2 + \lambda \lVert w\rVert_0\)</span><span class="math notranslate nohighlight">\(
Here smaller \)</span>\lVert w\rVert_0$ means we discard most of the features.</p></li>
<li><p>In the above equation, larger <span class="math notranslate nohighlight">\(\lambda\)</span> means aggressive feature pruning.</p></li>
<li><p>The order of features removed given by <code class="docutils literal notranslate"><span class="pre">rfe.ranking_</span></code> is the same as the order of original feature importances given by a regression model.<br />
<br><br><br><br><br><br><br><br><br></p></li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-571-py"
        },
        kernelOptions: {
            name: "conda-env-571-py",
            path: "./_lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-571-py'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-4-feature-importances-and-feature-selection">Lecture 4: Feature importances and feature selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">1. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-correlations">Feature correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">2. Feature importances in linear models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-different-types-of-features">Interpreting coefficients of different types of features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">2. Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination">3 . Recursive feature elimination</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Recursive feature elimination</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(optional) Feature selection and OHE</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-choose-the-number-of-features-to-select">How to choose the number of features to select?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-get-feature-names-of-selected-features">How do we get feature names of selected features?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-for-classification">RFE for classification</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-method-e-g-forward-selection">2. Search and score method (e.g., forward selection)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-what-scoring-function-should-we-use">Search and <strong>score</strong>: What scoring function should we use?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-search-and-score-methods">Problems with search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection-complexity-penalty">Model selection: complexity penalty</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scoring-using-complexity-penalties">Scoring using complexity penalties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#l0-norm-and-the-number-of-features-used"><span class="math notranslate nohighlight">\(L0\)</span> “norm”  and the number of features used</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scoring-using-l0-norm">Scoring using <span class="math notranslate nohighlight">\(L0\)</span> “norm”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-greedy-approach-for-search-and-score">Forward selection: greedy approach for search and score</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection-example">Forward selection: Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-get-feature-names-of-selected-features">How to get feature names of selected features?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection">Forward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-feature-selection-optional">Problems with feature selection (optional)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-rough-guide-to-feature-selection-bonus-slide">A rough guide to feature selection (bonus slide)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#true-false-questions-feature-selection-class-discussion">True/False questions: Feature selection (Class discussion)</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar and Joel Östblom
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>