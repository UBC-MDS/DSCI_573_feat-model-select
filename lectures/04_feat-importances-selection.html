

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 4: Feature importances and feature selection &#8212; DSCI 573 Feature and Model Selection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/04_feat-importances-selection';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 5: Loss functions, intro to regularization" href="05_loss-functions-regularization_intro.html" />
    <link rel="prev" title="Lecture 3: Feature engineering" href="03_feature-engineering.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/mds-hex-sticker.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/mds-hex-sticker.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_classification-metrics.html">Lecture 1: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_regression-metrics.html">Lecture 2: Regression metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_feature-engineering.html">Lecture 3: Feature engineering</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 4: Feature importances and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_loss-functions-regularization_intro.html">Lecture 5: Loss functions, intro to regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_L2-L1-regularization.html">Lecture 6: L2- and L1-Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_ensembles.html">Lecture 7: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_model-transparency-conclusion.html">Lecture 8: Model transparency and conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/04_feat-importances-selection.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 4: Feature importances and feature selection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-los">Imports and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplefeature-correlations">SimpleFeature correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">Feature importances in linear models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-using-feature-importances">Feature selection using feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-based-feature-selection">Model-based feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination-rfe">Recursive feature elimination (RFE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-algorithm">RFE algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-and-categorical-features">Feature selection and categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(Optional) Feature selection and OHE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-with-cross-validation-rfecv">RFE with cross-validation (RFECV)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-feature-importances"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-methods">Search and score methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-or-backward-selection">Forward or backward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-4-1">iClicker Exercise 4.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coming-up">Coming up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-problems-with-feature-selection">(Optional) Problems with feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/573_banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-4-feature-importances-and-feature-selection">
<h1>Lecture 4: Feature importances and feature selection<a class="headerlink" href="#lecture-4-feature-importances-and-feature-selection" title="Permalink to this heading">#</a></h1>
<p>UBC Master of Data Science program, 2022-23</p>
<p>Instructor: Varada Kolhatkar</p>
<section id="imports-and-los">
<h2>Imports and LOs<a class="headerlink" href="#imports-and-los" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">cross_val_score</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h3>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Explain the limitations of simple correlation-based approaches to identify feature importances.</p></li>
<li><p>Interpret the coefficients of linear regression, including for scaled numeric features.</p></li>
<li><p>Explain the purpose of feature selection.</p></li>
<li><p>Discuss and compare different feature selection methods at a high level.</p></li>
<li><p>Explain and use model-based feature selection.</p></li>
<li><p>Explain recursive feature elimination at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s implementation of recursive feature elimination (<code class="docutils literal notranslate"><span class="pre">RFE</span></code>).</p></li>
<li><p>Explain how RFECV (cross-validated recursive feature elimination) works.</p></li>
<li><p>Explain forward and backward feature selection at a high level.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s implementation of forward and backward selection.</p></li>
</ul>
<p>I’m using <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> in this lecture for easy heatmap plotting, which is not in the course environment. You can install it as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="mi">573</span>
<span class="o">&gt;</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">seaborn</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h2>
<p>In the first part of this lecture, we’ll be using <a class="reference external" href="https://www.kaggle.com/c/home-data-for-ml-course/">Kaggle House Prices dataset</a>, the dataset we used in lecture 10. As usual, to run this notebook you’ll need to download the data. Unzip the data into a subdirectory called <code class="docutils literal notranslate"><span class="pre">data</span></code>. For this dataset, train and test have already been separated. We’ll be working with the train portion in this lecture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing-kaggle/train.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>303</td>
      <td>20</td>
      <td>RL</td>
      <td>118.0</td>
      <td>13704</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>2006</td>
      <td>WD</td>
      <td>Normal</td>
      <td>205000</td>
    </tr>
    <tr>
      <th>767</th>
      <td>768</td>
      <td>50</td>
      <td>RL</td>
      <td>75.0</td>
      <td>12508</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Shed</td>
      <td>1300</td>
      <td>7</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>160000</td>
    </tr>
    <tr>
      <th>429</th>
      <td>430</td>
      <td>20</td>
      <td>RL</td>
      <td>130.0</td>
      <td>11457</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>3</td>
      <td>2009</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>1140</td>
      <td>30</td>
      <td>RL</td>
      <td>98.0</td>
      <td>8731</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>144000</td>
    </tr>
    <tr>
      <th>558</th>
      <td>559</td>
      <td>60</td>
      <td>RL</td>
      <td>57.0</td>
      <td>21872</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR2</td>
      <td>HLS</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>8</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>175000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 81 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>The prediction task is predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> given features related to properties.</p></li>
<li><p>Note that the target is numeric, not categorical.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 81)
</pre></div>
</div>
</div>
</div>
<section id="let-s-separate-x-and-y">
<h3>Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code><a class="headerlink" href="#let-s-separate-x-and-y" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;SalePrice&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="let-s-identify-feature-types">
<h3>Let’s identify feature types<a class="headerlink" href="#let-s-identify-feature-types" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotFrontage&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LotArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OverallCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YearRemodAdd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MasVnrArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1stFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LowQualFinSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GrLivArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FullBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HalfBath&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fireplaces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WoodDeckSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3SsnPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ScreenPorch&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MiscVal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;YrSold&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_reg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ExterQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ExterCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HeatingQC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KitchenQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageQual&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GarageCond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PoolQC&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Po&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Gd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Ex&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># if N/A it will just impute something, per below</span>
<span class="n">ordering_ordinal_reg</span> <span class="o">=</span> <span class="p">[</span><span class="n">ordering</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
<span class="n">ordering_ordinal_reg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
 [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordinal_features_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Functional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fence&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">ordering_ordinal_oth</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Mn&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">,</span> <span class="s2">&quot;Gd&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;Unf&quot;</span><span class="p">,</span> <span class="s2">&quot;LwQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Rec&quot;</span><span class="p">,</span> <span class="s2">&quot;BLQ&quot;</span><span class="p">,</span> <span class="s2">&quot;ALQ&quot;</span><span class="p">,</span> <span class="s2">&quot;GLQ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Sal&quot;</span><span class="p">,</span> <span class="s2">&quot;Sev&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj2&quot;</span><span class="p">,</span> <span class="s2">&quot;Maj1&quot;</span><span class="p">,</span> <span class="s2">&quot;Mod&quot;</span><span class="p">,</span> <span class="s2">&quot;Min2&quot;</span><span class="p">,</span> <span class="s2">&quot;Min1&quot;</span><span class="p">,</span> <span class="s2">&quot;Typ&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;MnWw&quot;</span><span class="p">,</span> <span class="s2">&quot;GdWo&quot;</span><span class="p">,</span> <span class="s2">&quot;MnPrv&quot;</span><span class="p">,</span> <span class="s2">&quot;GdPrv&quot;</span><span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">numeric_features</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ordinal_features_oth</span><span class="p">)</span>
    <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">drop_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">categorical_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotConfig&#39;,
 &#39;Alley&#39;,
 &#39;MiscFeature&#39;,
 &#39;LotShape&#39;,
 &#39;RoofStyle&#39;,
 &#39;Electrical&#39;,
 &#39;Foundation&#39;,
 &#39;RoofMatl&#39;,
 &#39;Exterior2nd&#39;,
 &#39;Exterior1st&#39;,
 &#39;LandContour&#39;,
 &#39;Utilities&#39;,
 &#39;MasVnrType&#39;,
 &#39;SaleCondition&#39;,
 &#39;CentralAir&#39;,
 &#39;MoSold&#39;,
 &#39;Condition2&#39;,
 &#39;BldgType&#39;,
 &#39;GarageType&#39;,
 &#39;GarageFinish&#39;,
 &#39;LandSlope&#39;,
 &#39;HouseStyle&#39;,
 &#39;MSZoning&#39;,
 &#39;Condition1&#39;,
 &#39;Neighborhood&#39;,
 &#39;MSSubClass&#39;,
 &#39;PavedDrive&#39;,
 &#39;Street&#39;,
 &#39;Heating&#39;,
 &#39;SaleType&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="n">ordinal_transformer_reg</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_reg</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ordinal_transformer_oth</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span>
    <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">ordering_ordinal_oth</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_reg</span><span class="p">,</span> <span class="n">ordinal_features_reg</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ordinal_transformer_oth</span><span class="p">,</span> <span class="n">ordinal_features_oth</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;drop&#39;: &#39;drop&#39;,
 &#39;pipeline-1&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;median&#39;)),
                 (&#39;standardscaler&#39;, StandardScaler())]),
 &#39;pipeline-2&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;],
                                             [&#39;Po&#39;, &#39;Fa&#39;, &#39;TA&#39;, &#39;Gd&#39;, &#39;Ex&#39;]]))]),
 &#39;pipeline-3&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;, SimpleImputer(strategy=&#39;most_frequent&#39;)),
                 (&#39;ordinalencoder&#39;,
                  OrdinalEncoder(categories=[[&#39;NA&#39;, &#39;No&#39;, &#39;Mn&#39;, &#39;Av&#39;, &#39;Gd&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;NA&#39;, &#39;Unf&#39;, &#39;LwQ&#39;, &#39;Rec&#39;, &#39;BLQ&#39;,
                                              &#39;ALQ&#39;, &#39;GLQ&#39;],
                                             [&#39;Sal&#39;, &#39;Sev&#39;, &#39;Maj2&#39;, &#39;Maj1&#39;,
                                              &#39;Mod&#39;, &#39;Min2&#39;, &#39;Min1&#39;, &#39;Typ&#39;],
                                             [&#39;NA&#39;, &#39;MnWw&#39;, &#39;GdWo&#39;, &#39;MnPrv&#39;,
                                              &#39;GdPrv&#39;]]))]),
 &#39;pipeline-4&#39;: Pipeline(steps=[(&#39;simpleimputer&#39;,
                  SimpleImputer(fill_value=&#39;missing&#39;, strategy=&#39;constant&#39;)),
                 (&#39;onehotencoder&#39;,
                  OneHotEncoder(handle_unknown=&#39;ignore&#39;, sparse=False))])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-4&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehotencoder&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">ordinal_features_reg</span> <span class="o">+</span> <span class="n">ordinal_features_oth</span> <span class="o">+</span> <span class="n">ohe_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
<span class="n">X_train_enc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Heating_Wall</th>
      <th>SaleType_COD</th>
      <th>SaleType_CWD</th>
      <th>SaleType_Con</th>
      <th>SaleType_ConLD</th>
      <th>SaleType_ConLI</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>302</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.312501</td>
      <td>0.381428</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.840492</td>
      <td>0.269972</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>767</th>
      <td>1.372763</td>
      <td>-0.222647</td>
      <td>0.260890</td>
      <td>0.248457</td>
      <td>-0.054669</td>
      <td>1.285467</td>
      <td>-1.026793</td>
      <td>0.016525</td>
      <td>-0.573129</td>
      <td>0.476092</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>429</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>2.885044</td>
      <td>0.131607</td>
      <td>-0.054669</td>
      <td>-0.512408</td>
      <td>0.563314</td>
      <td>0.161931</td>
      <td>-0.573129</td>
      <td>1.227559</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1139</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>1.358264</td>
      <td>-0.171468</td>
      <td>-0.773017</td>
      <td>-0.512408</td>
      <td>-1.689338</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>0.443419</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>558</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.597924</td>
      <td>1.289541</td>
      <td>0.663680</td>
      <td>-0.512408</td>
      <td>0.828332</td>
      <td>0.598149</td>
      <td>-0.573129</td>
      <td>0.354114</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1041</th>
      <td>1.372763</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.127107</td>
      <td>-0.054669</td>
      <td>2.184405</td>
      <td>-0.165485</td>
      <td>0.743555</td>
      <td>0.843281</td>
      <td>-0.090231</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.149788</td>
      <td>-1.491366</td>
      <td>-2.310284</td>
      <td>-0.496757</td>
      <td>-1.389065</td>
      <td>-0.573129</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>1.168244</td>
      <td>0.663680</td>
      <td>1.285467</td>
      <td>-0.099230</td>
      <td>0.888961</td>
      <td>-0.573129</td>
      <td>-0.314582</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1406</th>
      <td>-1.063173</td>
      <td>-0.222647</td>
      <td>0.022331</td>
      <td>-0.203265</td>
      <td>-0.773017</td>
      <td>1.285467</td>
      <td>0.033279</td>
      <td>1.082835</td>
      <td>-0.573129</td>
      <td>0.467379</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.454788</td>
      <td>-0.475099</td>
      <td>-0.054669</td>
      <td>0.386530</td>
      <td>-0.993666</td>
      <td>-1.679877</td>
      <td>-0.573129</td>
      <td>-0.144686</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>1314 rows × 263 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_enc</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1314, 263)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.037688</td>
      <td>0.006314</td>
      <td>0.834450</td>
      <td>0.916827</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.033185</td>
      <td>0.006056</td>
      <td>0.810031</td>
      <td>0.919218</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.018007</td>
      <td>0.004891</td>
      <td>0.831653</td>
      <td>0.912397</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.020183</td>
      <td>0.004715</td>
      <td>0.843537</td>
      <td>0.914043</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.017457</td>
      <td>0.004584</td>
      <td>0.548802</td>
      <td>0.920476</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="feature-importances">
<h2>Feature importances<a class="headerlink" href="#feature-importances" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>How does the output depend upon the input?</p></li>
<li><p>How do the predictions change as a function of a particular feature?</p></li>
<li><p>If the model is bad interpretability does not make sense.</p></li>
</ul>
<section id="simplefeature-correlations">
<h3>SimpleFeature correlations<a class="headerlink" href="#simplefeature-correlations" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let’s look at the correlations between various features with other features and the target in our encoded data (first row/column).</p></li>
<li><p>In simple terms here is how you can interpret correlations between two variables <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes up when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are positively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> goes down when <span class="math notranslate nohighlight">\(X\)</span> goes up, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are negatively correlated.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(Y\)</span> is unchanged when <span class="math notranslate nohighlight">\(X\)</span> changes, we say <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are uncorrelated.</p></li>
</ul>
</li>
</ul>
<p>Let’s examine the correlations among different columns, including the target column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1fc3bc3cb57fc9d801a8fb3ad2bee1d82fc785a6e3bc3dadf666886eb9448a7f.png" src="../_images/1fc3bc3cb57fc9d801a8fb3ad2bee1d82fc785a6e3bc3dadf666886eb9448a7f.png" />
</div>
</div>
<ul class="simple">
<li><p>We can immediately see that <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is highly correlated with <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code>.</p></li>
<li><p>This is an early hint that <code class="docutils literal notranslate"><span class="pre">OverallQual</span></code> is a useful feature in predicting <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code>.</p></li>
<li><p>However, this approach is <strong>extremely simplistic</strong>.</p>
<ul>
<li><p>It only looks at each feature in isolation.</p></li>
<li><p>It only looks at linear associations:</p>
<ul>
<li><p>What if <code class="docutils literal notranslate"><span class="pre">SalePrice</span></code> is high when <code class="docutils literal notranslate"><span class="pre">BsmtFullBath</span></code> is 2 or 3, but low when it’s 0, 1, or 4? They might seem uncorrelated.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_enc</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cbd338ffcd59a4835c102abc0ab44221ba4b31477058a22a38289c4aa6f76ec9.png" src="../_images/cbd338ffcd59a4835c102abc0ab44221ba4b31477058a22a38289c4aa6f76ec9.png" />
</div>
</div>
<ul class="simple">
<li><p>Looking at this diagram also tells us the relationship between features.</p>
<ul>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> are highly correlated.</p></li>
<li><p>Do we need both of them?</p></li>
<li><p>If our model says <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is very important and <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> is very unimportant, do we trust those values?</p></li>
<li><p>Maybe <code class="docutils literal notranslate"><span class="pre">TotalBsmtSF</span></code> only “becomes important” if <code class="docutils literal notranslate"><span class="pre">1stFlrSF</span></code> is removed.</p></li>
<li><p>Sometimes the opposite happens: a feature only becomes important if another feature is <em>added</em>.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="feature-importances-in-linear-models">
<h3>Feature importances in linear models<a class="headerlink" href="#feature-importances-in-linear-models" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>With linear regression we can look at the <em>coefficients</em> for each feature.</p></li>
<li><p>Overall idea: predicted price = intercept + <span class="math notranslate nohighlight">\(\sum_i\)</span> coefficient i <span class="math notranslate nohighlight">\(\times\)</span> feature i.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">lr_coefs</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BedroomAbvGr</th>
      <td>-3723.741570</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>-4580.204576</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>-1578.664421</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>5109.356718</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>12487.561839</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>4855.535334</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>4226.684842</td>
    </tr>
    <tr>
      <th>YearRemodAdd</th>
      <td>324.664715</td>
    </tr>
    <tr>
      <th>MasVnrArea</th>
      <td>5251.325210</td>
    </tr>
    <tr>
      <th>BsmtFinSF1</th>
      <td>3667.172851</td>
    </tr>
    <tr>
      <th>BsmtFinSF2</th>
      <td>583.114880</td>
    </tr>
    <tr>
      <th>BsmtUnfSF</th>
      <td>-1266.614671</td>
    </tr>
    <tr>
      <th>TotalBsmtSF</th>
      <td>2751.084018</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>6736.788904</td>
    </tr>
    <tr>
      <th>2ndFlrSF</th>
      <td>13409.901084</td>
    </tr>
    <tr>
      <th>LowQualFinSF</th>
      <td>-448.424132</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>15988.182407</td>
    </tr>
    <tr>
      <th>BsmtFullBath</th>
      <td>2299.227266</td>
    </tr>
    <tr>
      <th>BsmtHalfBath</th>
      <td>500.169112</td>
    </tr>
    <tr>
      <th>FullBath</th>
      <td>2831.811467</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s try to interpret coefficients for different types of features.</p>
</section>
<section id="ordinal-features">
<h3>Ordinal features<a class="headerlink" href="#ordinal-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The ordinal features are easiest to interpret.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ordinal_features_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ExterQual&#39;, &#39;ExterCond&#39;, &#39;BsmtQual&#39;, &#39;BsmtCond&#39;, &#39;HeatingQC&#39;, &#39;KitchenQual&#39;, &#39;FireplaceQu&#39;, &#39;GarageQual&#39;, &#39;GarageCond&#39;, &#39;PoolQC&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient    4195.671512
Name: ExterQual, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by <span class="math notranslate nohighlight">\(\sim\$4195\)</span>.</p>
<ul>
<li><p>Wow, that’s a lot!</p></li>
<li><p>Remember this is just what the model has learned. It doesn’t tell us how the world works.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span><span class="p">[[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ExterQual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Gd</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s perturb the example and change <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ex&quot;</span>  <span class="c1"># Change Gd to Ex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span><span class="p">[[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ExterQual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Ex</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How does the prediction change after changing <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code> from <code class="docutils literal notranslate"><span class="pre">Gd</span></code> to <code class="docutils literal notranslate"><span class="pre">Ex</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the original example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the perturbed example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;After changing ExterQual from Gd to Ex increased the prediction by: &quot;</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction on the original example:  [224795.63596803]
Prediction on the perturbed example:  [228991.30748049]
After changing ExterQual from Gd to Ex increased the prediction by:  [4195.67151247]
</pre></div>
</div>
</div>
</div>
<p>That’s exactly the learned coefficient for <code class="docutils literal notranslate"><span class="pre">ExterQual</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ExterQual&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient    4195.671512
Name: ExterQual, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>So our interpretation is correct!</p>
<ul class="simple">
<li><p>Increasing by one category of exterior quality (e.g. good -&gt; excellent) increases the predicted price by <span class="math notranslate nohighlight">\(\sim\$4195\)</span>.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="categorical-features">
<h3>Categorical features<a class="headerlink" href="#categorical-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What about the categorical features?</p></li>
<li><p>We have created a number of columns for each category with OHE and each category gets it’s own coefficient.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LotConfig&#39;, &#39;Alley&#39;, &#39;MiscFeature&#39;, &#39;LotShape&#39;, &#39;RoofStyle&#39;, &#39;Electrical&#39;, &#39;Foundation&#39;, &#39;RoofMatl&#39;, &#39;Exterior2nd&#39;, &#39;Exterior1st&#39;, &#39;LandContour&#39;, &#39;Utilities&#39;, &#39;MasVnrType&#39;, &#39;SaleCondition&#39;, &#39;CentralAir&#39;, &#39;MoSold&#39;, &#39;Condition2&#39;, &#39;BldgType&#39;, &#39;GarageType&#39;, &#39;GarageFinish&#39;, &#39;LandSlope&#39;, &#39;HouseStyle&#39;, &#39;MSZoning&#39;, &#39;Condition1&#39;, &#39;Neighborhood&#39;, &#39;MSSubClass&#39;, &#39;PavedDrive&#39;, &#39;Street&#39;, &#39;Heating&#39;, &#39;SaleType&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">=</span> <span class="n">lr_coefs</span><span class="p">[</span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">)]</span>
<span class="n">lr_coefs_landslope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>457.197456</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>7420.208381</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-7877.405837</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>We can talk about switching from one of these categories to another by picking a “reference” category:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs_landslope</span> <span class="o">-</span> <span class="n">lr_coefs_landslope</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;LandSlope_Gtl&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LandSlope_Gtl</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>LandSlope_Mod</th>
      <td>6963.010925</td>
    </tr>
    <tr>
      <th>LandSlope_Sev</th>
      <td>-8334.603292</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Mod</span></code> the prediction price goes up by <span class="math notranslate nohighlight">\(\sim\$6963\)</span></p></li>
<li><p>If you change the category from <code class="docutils literal notranslate"><span class="pre">LandSlope_Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">LandSlope_Sev</span></code> the prediction price goes down by <span class="math notranslate nohighlight">\(\sim\$8334\)</span></p></li>
</ul>
<p>Note that this might not make sense in the real world but this is what our model decided to learn given this small amount of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">one_example</span><span class="p">[[</span><span class="s1">&#39;LandSlope&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LandSlope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Gtl</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s perturb the example and change <code class="docutils literal notranslate"><span class="pre">LandSlope</span></code> to <code class="docutils literal notranslate"><span class="pre">Mod</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Mod&quot;</span>  <span class="c1"># Change Gd to Ex</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span><span class="p">[[</span><span class="s2">&quot;LandSlope&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LandSlope</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>Mod</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How does the prediction change after changing <code class="docutils literal notranslate"><span class="pre">LandSlope</span></code> from <code class="docutils literal notranslate"><span class="pre">Gtl</span></code> to <code class="docutils literal notranslate"><span class="pre">Mod</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the original example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on the perturbed example: &quot;</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;After changing ExterQual from Gd to Ex increased the prediction by: &quot;</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction on the original example:  [224795.63596803]
Prediction on the perturbed example:  [231758.64689313]
After changing ExterQual from Gd to Ex increased the prediction by:  [6963.0109251]
</pre></div>
</div>
</div>
</div>
<p>Our interpretation above is correct!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Coefficient&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191129.774314</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105552.840565</td>
    </tr>
    <tr>
      <th>Heating_OthW</th>
      <td>-27260.681308</td>
    </tr>
    <tr>
      <th>MSZoning_C (all)</th>
      <td>-21990.746193</td>
    </tr>
    <tr>
      <th>Exterior1st_ImStucc</th>
      <td>-19393.964621</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>PoolQC</th>
      <td>34217.656047</td>
    </tr>
    <tr>
      <th>RoofMatl_CompShg</th>
      <td>36525.980874</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37532.643270</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39993.978324</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83646.711008</td>
    </tr>
  </tbody>
</table>
<p>263 rows × 1 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>For example, the above coefficient says that “If the roof is made of clay or tile, the predicted price is \$191K less”?</p></li>
<li><p>Do we believe these interpretations??</p>
<ul>
<li><p>Do we believe this is how the predictions are being computed? Yes.</p></li>
<li><p>Do we believe that this is how the world works? No.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code> (we didn’t) then you already have a reference class, and all the values are with respect to that one. The interpretation depends on whether we did <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, hence the hassle.</p>
</div>
<p><br><br></p>
</section>
<section id="interpreting-coefficients-of-numeric-features">
<h3>Interpreting coefficients of numeric features<a class="headerlink" href="#interpreting-coefficients-of-numeric-features" title="Permalink to this heading">#</a></h3>
<p>Let’s look at coefficients of <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code>, <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>, <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;PoolArea&quot;</span><span class="p">,</span> <span class="s2">&quot;LotFrontage&quot;</span><span class="p">,</span> <span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PoolArea</th>
      <td>2822.370476</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>-1578.664421</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>5109.356718</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Intuition:</p>
<ul class="simple">
<li><p>Tricky because numeric features are <strong>scaled</strong>!</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> by 1 scaled unit <strong>increases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$2822\)</span>.</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by 1 scaled unit <strong>increases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$5109\)</span>.</p></li>
<li><p><strong>Increasing</strong> <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> by 1 scaled unit <strong>decreases</strong> the predicted price by <span class="math notranslate nohighlight">\(\sim\$1578\)</span>.</p></li>
</ul>
<p>Does that sound reasonable?</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">PoolArea</span></code> and <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>, yes.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code>, that’s surprising. Something positive would have made more sense?</p></li>
</ul>
<p>It might be the case that <code class="docutils literal notranslate"><span class="pre">LotFrontage</span></code> is correlated with some other variable, which might have a larger positive coefficient.</p>
<p>BTW, let’s make sure the predictions behave as expected:</p>
<section id="example-showing-how-can-we-interpret-coefficients-of-scaled-features">
<h4>Example showing how can we interpret coefficients of scaled features.<a class="headerlink" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What’s one scaled unit for <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>?</p></li>
<li><p>The scaler subtracted the mean and divided by the standard deviation.</p></li>
<li><p>The division actually changed the scale!</p></li>
<li><p>For the unit conversion, we don’t care about the subtraction, but only the scaling.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;pipeline-1&quot;</span><span class="p">][</span><span class="s2">&quot;standardscaler&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_scales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">var_</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">numeric_features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Scale&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">lr_scales</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BedroomAbvGr</th>
      <td>0.821040</td>
    </tr>
    <tr>
      <th>KitchenAbvGr</th>
      <td>0.218760</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>20.959139</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>8994.471032</td>
    </tr>
    <tr>
      <th>OverallQual</th>
      <td>1.392082</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>It seems like <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> was divided by 8994.471032 sqft.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_coefs</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LotArea</th>
      <td>5109.356718</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The coefficient tells us that if we increase the <strong>scaled</strong> <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one scaled unit the price would go up by <span class="math notranslate nohighlight">\(\approx\$5109\)</span>.</p></li>
<li><p>One scaled unit represents <span class="math notranslate nohighlight">\(\sim 8994\)</span> sqft in the original scale.</p></li>
</ul>
<p>Let’s examine whether this behaves as expected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_enc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">new_columns</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_ex_preprocessed</span> <span class="o">=</span> <span class="n">X_test_enc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">one_ex_preprocessed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Heating_Wall</th>
      <th>SaleType_COD</th>
      <th>SaleType_CWD</th>
      <th>SaleType_Con</th>
      <th>SaleType_ConLD</th>
      <th>SaleType_ConLI</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>-0.085415</td>
      <td>0.66368</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.792023</td>
      <td>0.438592</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 263 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orig_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_ex_preprocessed</span><span class="p">)</span>
<span class="n">orig_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/sklearn/base.py:443: UserWarning: X has feature names, but Ridge was fitted without feature names
  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224795.63596803])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_ex_preprocessed_perturbed</span> <span class="o">=</span> <span class="n">one_ex_preprocessed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_ex_preprocessed_perturbed</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># we are adding one to the scaled LotArea</span>
<span class="n">one_ex_preprocessed_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BedroomAbvGr</th>
      <th>KitchenAbvGr</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>OverallQual</th>
      <th>OverallCond</th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>MasVnrArea</th>
      <th>BsmtFinSF1</th>
      <th>...</th>
      <th>Heating_Wall</th>
      <th>SaleType_COD</th>
      <th>SaleType_CWD</th>
      <th>SaleType_Con</th>
      <th>SaleType_ConLD</th>
      <th>SaleType_ConLI</th>
      <th>SaleType_ConLw</th>
      <th>SaleType_New</th>
      <th>SaleType_Oth</th>
      <th>SaleType_WD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>0.154795</td>
      <td>-0.222647</td>
      <td>-0.025381</td>
      <td>0.914585</td>
      <td>0.66368</td>
      <td>-0.512408</td>
      <td>0.993969</td>
      <td>0.792023</td>
      <td>0.438592</td>
      <td>-0.961498</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 263 columns</p>
</div></div></div>
</div>
<p>We are expecting an increase of $5109.35671809 in the prediction compared to the original value of <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">perturbed_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_ex_preprocessed_perturbed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/sklearn/base.py:443: UserWarning: X has feature names, but Ridge was fitted without feature names
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">perturbed_pred</span> <span class="o">-</span> <span class="n">orig_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([5109.35671809])
</pre></div>
</div>
</div>
</div>
<p>Our interpretation is correct!</p>
<ul class="simple">
<li><p>Humans find it easier to think about features in their original scale.</p></li>
<li><p>How can we interpret this coefficient in the original scale?</p></li>
<li><p>If I increase original <code class="docutils literal notranslate"><span class="pre">LotArea</span></code> by one square foot then the predicted price would go up by this amount:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mf">5109.356718094072</span> <span class="o">/</span> <span class="mf">8994.471032</span> <span class="c1"># Coefficient learned on the scaled features / the scaling factor for this feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5680552752814816
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9505</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Let’s perturb the example and add 1 to the <code class="docutils literal notranslate"><span class="pre">LotArea</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span> <span class="o">=</span> <span class="n">one_example</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">one_example_perturbed</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>if we add 8994.471032 to the original LotArea, the housing price prediction should go up by the coefficient 5109.35671794.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_example_perturbed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Id</th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>...</th>
      <th>ScreenPorch</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>147</th>
      <td>148</td>
      <td>60</td>
      <td>RL</td>
      <td>NaN</td>
      <td>9506</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2010</td>
      <td>WD</td>
      <td>Normal</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 80 columns</p>
</div></div></div>
</div>
<p>Prediction on the original example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224795.63596803])
</pre></div>
</div>
</div>
</div>
<p>Prediction on the perturbed example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([224796.2040233])
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s the difference between predictions?</p></li>
<li><p>Does the difference make sense given the coefficient of the feature?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example_perturbed</span><span class="p">)</span> <span class="o">-</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.56805528])
</pre></div>
</div>
</div>
</div>
<p>Yes! Our interpretation is correct.</p>
<ul class="simple">
<li><p>That said don’t read too much into these coefficients without statistical training.</p></li>
</ul>
</section>
</section>
<section id="interim-summary">
<h3>Interim summary<a class="headerlink" href="#interim-summary" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Correlation among features might make coefficients completely uninterpretable.</p></li>
<li><p>Fairly straightforward to interpret coefficients of ordinal features.</p></li>
<li><p>In categorical features, it’s often helpful to consider one category as a reference point and think about relative importance.</p></li>
<li><p>For numeric features, relative importance is meaningful after scaling.</p></li>
<li><p>You have to be careful about the scale of the feature when interpreting the coefficients.</p></li>
<li><p>Remember that explaining the model <span class="math notranslate nohighlight">\(\neq\)</span> explaining the data or explaining how the world works.</p></li>
<li><p>The coefficients tell us only about the model and they might not accurately reflect the data.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="feature-selection-introduction-and-motivation">
<h2>Feature selection: Introduction and motivation<a class="headerlink" href="#feature-selection-introduction-and-motivation" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>With so many ways to add new features, we can increase dimensionality of the data.</p></li>
<li><p>More features means more complex models, which means increasing the chance of overfitting.</p></li>
</ul>
<section id="what-is-feature-selection">
<h3>What is feature selection?<a class="headerlink" href="#what-is-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Find the features	(columns) <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting	<span class="math notranslate nohighlight">\(y\)</span>, and remove the features that aren’t.</p></li>
<li><p>Given <span class="math notranslate nohighlight">\(X = \begin{bmatrix}\\  \\  \\  \end{bmatrix}\)</span> and <span class="math notranslate nohighlight">\(y = \begin{bmatrix}\\  \\  \\  \end{bmatrix}\)</span>, find the columns <span class="math notranslate nohighlight">\(1 \leq j \leq n\)</span> in <span class="math notranslate nohighlight">\(X\)</span> that are important for predicting <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
</ul>
</section>
<section id="why-feature-selection">
<h3>Why feature selection?<a class="headerlink" href="#why-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Interpretability: Models are more interpretable with fewer features. If you get the same performance with 10 features instead of 500 features, why not use the model with smaller number of features?</p></li>
<li><p>Computation: Models fit/predict faster with fewer columns.</p></li>
<li><p>Data collection: What type of new data should I collect? It may be cheaper to collect fewer columns.</p></li>
<li><p>Fundamental tradeoff: Can I reduce overfitting by removing useless features?</p></li>
</ul>
<p>Feature selection can often result in better performing (less overfit), easier to understand, and faster model.</p>
</section>
<section id="how-do-we-carry-out-feature-selection">
<h3>How do we carry out feature selection?<a class="headerlink" href="#how-do-we-carry-out-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There are a number of ways.</p></li>
<li><p>You could use domain knowledge to discard features.</p></li>
<li><p>We are briefly going to look at a few automatic feature selection methods.</p>
<ul>
<li><p>Model-based selection</p></li>
<li><p>Recursive feature elimination</p></li>
<li><p>Forward/Backward selection</p></li>
</ul>
</li>
<li><p>Very related to looking at feature importances.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s start with the dummy model.</p>
<p>We’ll be using the user-defined function <code class="docutils literal notranslate"><span class="pre">mean_std_cross_val_scores</span></code> to keep track of the results. You can find the code of the function in <code class="docutils literal notranslate"><span class="pre">code/utils.py</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">DummyRegressor</span><span class="p">(),</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> without any feature selection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_lr</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s try <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>.</p>
<p><em>We have not talked about this model yet. At this point it’s enough to know that it’s a tree-based model which is a good off-the-shelf model. We’ll be talking about it in Week 4.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.004 (+/- 0.006)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.855 (+/- 0.032)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we’ll try a number of feature selection methods and compare the results with the scores above.</p>
</section>
</section>
<section id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<p><br><br><br><br></p>
</section>
<section id="feature-selection-using-feature-importances">
<h2>Feature selection using feature importances<a class="headerlink" href="#feature-selection-using-feature-importances" title="Permalink to this heading">#</a></h2>
<section id="model-based-feature-selection">
<h3>Model-based feature selection<a class="headerlink" href="#model-based-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Use a supervised machine learning model to judge the importance of each feature.</p></li>
<li><p>Keep only the most important once.</p></li>
<li><p>Supervised machine learning model used for feature selection can be different that the one used as the final estimator.</p></li>
<li><p>Use a model which has some way to calculate feature importances.</p></li>
</ul>
<p>Let’s examine the least important features according to the model (features associated with coefficients with small magnitude).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;coefficient&quot;</span><span class="p">:</span> <span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
    <span class="s2">&quot;magnitude&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_columns</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;magnitude&quot;</span><span class="p">)</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coefficient</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BsmtFinType2</th>
      <td>-5.674533</td>
      <td>5.674533</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>109.408190</td>
      <td>109.408190</td>
    </tr>
    <tr>
      <th>HouseStyle_SFoyer</th>
      <td>110.057530</td>
      <td>110.057530</td>
    </tr>
    <tr>
      <th>MiscFeature_missing</th>
      <td>-144.483323</td>
      <td>144.483323</td>
    </tr>
    <tr>
      <th>SaleCondition_Alloca</th>
      <td>-147.260030</td>
      <td>147.260030</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37532.643270</td>
      <td>37532.643270</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39993.978324</td>
      <td>39993.978324</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83646.711008</td>
      <td>83646.711008</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105552.840565</td>
      <td>105552.840565</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191129.774314</td>
      <td>191129.774314</td>
    </tr>
  </tbody>
</table>
<p>263 rows × 2 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>Seems like there are a number of features with tiny coefficients compared to other features.</p></li>
<li><p>These features are not going to have a big impact on the prediction.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">new_columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;coef&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;coef != 0&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;coef&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">})</span>
<span class="p">)</span>
<span class="c1"># coefs.style.background_gradient(&#39;PuOr&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s examine the coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="n">coefs</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">pipe_lr</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; Coefficients&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;coef&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-415471b86d3e48c9b8aa0572b37c28f4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-415471b86d3e48c9b8aa0572b37c28f4") {
      outputDiv = document.getElementById("altair-viz-415471b86d3e48c9b8aa0572b37c28f4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-2ccf7a1ff8612ff7c1742e1475b810e5"}, "mark": "bar", "encoding": {"x": {"field": "coef", "type": "quantitative"}, "y": {"field": "variable", "sort": "x", "type": "nominal"}}, "title": "Ridge Coefficients", "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-2ccf7a1ff8612ff7c1742e1475b810e5": [{"variable": "RoofMatl_ClyTile", "coef": -191129.77431368953}, {"variable": "Condition2_PosN", "coef": -105552.8405648126}, {"variable": "Heating_OthW", "coef": -27260.68130752664}, {"variable": "MSZoning_C (all)", "coef": -21990.7461926393}, {"variable": "Exterior1st_ImStucc", "coef": -19393.96462091884}, {"variable": "LotShape_IR3", "coef": -19065.0555213917}, {"variable": "Condition1_RRAe", "coef": -18445.57326735516}, {"variable": "Neighborhood_Edwards", "coef": -17336.92336017793}, {"variable": "Utilities_NoSeWa", "coef": -15686.861940950686}, {"variable": "HouseStyle_2.5Fin", "coef": -15642.448452829669}, {"variable": "Foundation_Wood", "coef": -15464.918669932811}, {"variable": "Neighborhood_Gilbert", "coef": -15351.1340241096}, {"variable": "SaleType_COD", "coef": -14777.89914413766}, {"variable": "Neighborhood_Mitchel", "coef": -14619.791969717124}, {"variable": "LotConfig_FR3", "coef": -13930.588732745204}, {"variable": "Exterior2nd_Stucco", "coef": -13926.247166689185}, {"variable": "GarageType_2Types", "coef": -13080.561979838954}, {"variable": "MSSubClass_120", "coef": -13010.080529247007}, {"variable": "Neighborhood_NWAmes", "coef": -12654.683472140301}, {"variable": "BldgType_Twnhs", "coef": -12168.105066920478}, {"variable": "Street_Grvl", "coef": -12162.130444495138}, {"variable": "Neighborhood_Timber", "coef": -11417.117591756558}, {"variable": "SaleType_WD", "coef": -11414.803634716758}, {"variable": "MSSubClass_160", "coef": -11407.627902070652}, {"variable": "RoofStyle_Gable", "coef": -11315.558066580956}, {"variable": "Neighborhood_NAmes", "coef": -10908.532976751527}, {"variable": "Neighborhood_CollgCr", "coef": -10435.104729767227}, {"variable": "HouseStyle_2Story", "coef": -10265.510427818244}, {"variable": "SaleType_ConLw", "coef": -10214.526478126461}, {"variable": "MSSubClass_180", "coef": -9938.04146174891}, {"variable": "LandContour_Bnk", "coef": -9748.70057287814}, {"variable": "RoofStyle_Gambrel", "coef": -9404.621843455541}, {"variable": "Neighborhood_ClearCr", "coef": -9157.68487501466}, {"variable": "Condition2_RRAe", "coef": -9145.01989094232}, {"variable": "Exterior2nd_Other", "coef": -8781.466411888752}, {"variable": "MSSubClass_75", "coef": -8716.047785467694}, {"variable": "Neighborhood_MeadowV", "coef": -8643.942879438428}, {"variable": "Neighborhood_OldTown", "coef": -8548.2647447911}, {"variable": "MiscFeature_Gar2", "coef": -8425.089886818314}, {"variable": "HouseStyle_1.5Fin", "coef": -8068.942334014932}, {"variable": "LandSlope_Sev", "coef": -7877.405836505832}, {"variable": "Exterior1st_AsphShn", "coef": -7334.864285054637}, {"variable": "Exterior2nd_Wd Shng", "coef": -7288.142613996257}, {"variable": "BldgType_TwnhsE", "coef": -7108.909619531315}, {"variable": "RoofStyle_Hip", "coef": -7060.368505512561}, {"variable": "MSSubClass_190", "coef": -6990.610577445287}, {"variable": "Exterior2nd_Stone", "coef": -6778.292053882893}, {"variable": "MoSold_10", "coef": -6767.670166354465}, {"variable": "MasVnrType_BrkCmn", "coef": -6328.975105721782}, {"variable": "Electrical_SBrkr", "coef": -6094.820262014756}, {"variable": "Neighborhood_SWISU", "coef": -5976.583521089565}, {"variable": "SaleCondition_Partial", "coef": -5880.059188358924}, {"variable": "SaleCondition_Family", "coef": -5869.054226279883}, {"variable": "Neighborhood_IDOTRR", "coef": -5754.964287218723}, {"variable": "Neighborhood_Sawyer", "coef": -5013.314612952399}, {"variable": "Neighborhood_SawyerW", "coef": -4978.285139863985}, {"variable": "GarageFinish_RFn", "coef": -4844.371453869271}, {"variable": "LotConfig_FR2", "coef": -4791.1443445142995}, {"variable": "KitchenAbvGr", "coef": -4580.204576119464}, {"variable": "SaleType_Oth", "coef": -4166.52786340393}, {"variable": "BedroomAbvGr", "coef": -3723.741569667189}, {"variable": "Electrical_FuseF", "coef": -3609.179737072441}, {"variable": "MasVnrType_BrkFace", "coef": -3605.947318565222}, {"variable": "ExterCond", "coef": -3560.8562805306738}, {"variable": "Exterior1st_HdBoard", "coef": -3376.0431869128365}, {"variable": "Exterior2nd_MetalSd", "coef": -3376.01767052296}, {"variable": "MoSold_8", "coef": -3304.844500157658}, {"variable": "MoSold_2", "coef": -3239.2310322073768}, {"variable": "Condition1_RRNe", "coef": -3065.49127564965}, {"variable": "Condition1_Feedr", "coef": -2788.748850528467}, {"variable": "GarageType_BuiltIn", "coef": -2741.4913051809185}, {"variable": "LandContour_Low", "coef": -2740.5306991977986}, {"variable": "Exterior2nd_AsphShn", "coef": -2587.6667272427567}, {"variable": "Electrical_FuseA", "coef": -2455.706485016635}, {"variable": "Neighborhood_Blmngtn", "coef": -2313.156392995035}, {"variable": "Exterior1st_Wd Sdng", "coef": -2128.738151672917}, {"variable": "Exterior1st_VinylSd", "coef": -2060.8326848952975}, {"variable": "Condition1_PosN", "coef": -1886.994268348908}, {"variable": "Fence", "coef": -1855.2485565052327}, {"variable": "PavedDrive_P", "coef": -1758.1386077455024}, {"variable": "Condition1_Artery", "coef": -1753.2183352254688}, {"variable": "GarageFinish_Unf", "coef": -1752.0558328437126}, {"variable": "MoSold_12", "coef": -1723.966333987561}, {"variable": "Electrical_missing", "coef": -1626.3513229353173}, {"variable": "LotFrontage", "coef": -1578.6644209479682}, {"variable": "MiscFeature_TenC", "coef": -1576.4235111471478}, {"variable": "Alley_Grvl", "coef": -1552.2644446292138}, {"variable": "Foundation_BrkTil", "coef": -1508.0407533869645}, {"variable": "Exterior1st_Plywood", "coef": -1420.6851936345142}, {"variable": "Exterior2nd_BrkFace", "coef": -1349.6280849778293}, {"variable": "GarageType_Attchd", "coef": -1272.326616060133}, {"variable": "BsmtUnfSF", "coef": -1266.6146712364734}, {"variable": "Exterior1st_Stucco", "coef": -1131.114798568877}, {"variable": "RoofStyle_Mansard", "coef": -978.6049788086145}, {"variable": "Exterior2nd_Plywood", "coef": -939.8405860629033}, {"variable": "Neighborhood_Blueste", "coef": -872.9840767432902}, {"variable": "Exterior2nd_Brk Cmn", "coef": -844.3871783441227}, {"variable": "Alley_missing", "coef": -602.5431486824764}, {"variable": "GarageYrBlt", "coef": -534.6697107606251}, {"variable": "SaleCondition_Abnorml", "coef": -491.5153650033848}, {"variable": "LowQualFinSF", "coef": -448.4241315362853}, {"variable": "EnclosedPorch", "coef": -394.114528763194}, {"variable": "YrSold", "coef": -382.7464413555043}, {"variable": "Neighborhood_BrkSide", "coef": -326.0168400518606}, {"variable": "CentralAir_N", "coef": -296.0796540315137}, {"variable": "MSSubClass_40", "coef": -286.1409128730437}, {"variable": "SaleCondition_Alloca", "coef": -147.26003009891588}, {"variable": "MiscFeature_missing", "coef": -144.48332317651372}, {"variable": "BsmtFinType2", "coef": -5.67453308208961}, {"variable": "GarageArea", "coef": 109.40818990387451}, {"variable": "HouseStyle_SFoyer", "coef": 110.05753039409629}, {"variable": "OpenPorchSF", "coef": 206.51198651954007}, {"variable": "BsmtCond", "coef": 247.2523490109577}, {"variable": "MiscVal", "coef": 260.8423477893912}, {"variable": "Exterior1st_BrkComm", "coef": 275.365605909992}, {"variable": "CentralAir_Y", "coef": 296.0796540292933}, {"variable": "YearRemodAdd", "coef": 324.66471478881004}, {"variable": "MSSubClass_85", "coef": 370.944568499153}, {"variable": "LandSlope_Gtl", "coef": 457.1974557064176}, {"variable": "PavedDrive_N", "coef": 473.3379514785637}, {"variable": "GarageCond", "coef": 485.6279506412547}, {"variable": "BsmtHalfBath", "coef": 500.1691117296287}, {"variable": "MoSold_6", "coef": 500.5104446306698}, {"variable": "Exterior2nd_AsbShng", "coef": 507.6577048095222}, {"variable": "SaleType_ConLI", "coef": 536.4475876586085}, {"variable": "BsmtFinSF2", "coef": 583.1148800138676}, {"variable": "HeatingQC", "coef": 641.1270765000382}, {"variable": "MoSold_9", "coef": 680.2414679830383}, {"variable": "MiscFeature_Shed", "coef": 724.6341792005765}, {"variable": "FireplaceQu", "coef": 778.8826539066239}, {"variable": "GarageType_Detchd", "coef": 937.8405852581112}, {"variable": "MoSold_11", "coef": 1011.2649135378603}, {"variable": "BsmtFinType1", "coef": 1020.3083316343963}, {"variable": "WoodDeckSF", "coef": 1141.346235577398}, {"variable": "PavedDrive_Y", "coef": 1284.800656264549}, {"variable": "LandContour_Lvl", "coef": 1448.5915963347052}, {"variable": "GarageType_CarPort", "coef": 1502.9440101730195}, {"variable": "3SsnPorch", "coef": 1525.5917157000392}, {"variable": "Exterior2nd_HdBoard", "coef": 1547.683963741931}, {"variable": "MoSold_1", "coef": 1629.2865401734207}, {"variable": "GarageFinish_Fin", "coef": 1642.1488143422241}, {"variable": "HalfBath", "coef": 1749.3305600929937}, {"variable": "ScreenPorch", "coef": 1795.8677638849995}, {"variable": "MoSold_4", "coef": 1831.7634689029358}, {"variable": "MasVnrType_Stone", "coef": 1936.589015554407}, {"variable": "MSZoning_RM", "coef": 2016.784649397232}, {"variable": "MSSubClass_45", "coef": 2119.3310471368927}, {"variable": "Alley_Pave", "coef": 2154.807593312247}, {"variable": "Exterior1st_WdShing", "coef": 2170.0265953459148}, {"variable": "Heating_Floor", "coef": 2196.858870236961}, {"variable": "Fireplaces", "coef": 2280.783993912246}, {"variable": "BsmtFullBath", "coef": 2299.227266073073}, {"variable": "Exterior2nd_Wd Sdng", "coef": 2310.0372133747715}, {"variable": "HouseStyle_SLvl", "coef": 2365.051709772401}, {"variable": "MoSold_3", "coef": 2514.360498469391}, {"variable": "Exterior1st_Stone", "coef": 2677.5044007022584}, {"variable": "TotalBsmtSF", "coef": 2751.084018178517}, {"variable": "MasVnrType_None", "coef": 2770.333593882581}, {"variable": "PoolArea", "coef": 2822.3704762454395}, {"variable": "FullBath", "coef": 2831.811467356418}, {"variable": "LotConfig_Inside", "coef": 2892.7597789537094}, {"variable": "LotConfig_Corner", "coef": 3009.2360643768457}, {"variable": "MoSold_7", "coef": 3222.546876881216}, {"variable": "Foundation_CBlock", "coef": 3227.758509709171}, {"variable": "Exterior2nd_CBlock", "coef": 3284.080958432858}, {"variable": "Exterior1st_CBlock", "coef": 3284.0809584328695}, {"variable": "LotShape_IR1", "coef": 3389.0598397699473}, {"variable": "Neighborhood_Somerst", "coef": 3602.2058284904147}, {"variable": "Exterior1st_CemntBd", "coef": 3617.4263019888185}, {"variable": "MoSold_5", "coef": 3645.737822126995}, {"variable": "BsmtFinSF1", "coef": 3667.1728512128516}, {"variable": "Foundation_PConc", "coef": 3763.191544348472}, {"variable": "BldgType_1Fam", "coef": 3929.859900774791}, {"variable": "Condition1_RRNn", "coef": 4026.723818491699}, {"variable": "Exterior2nd_VinylSd", "coef": 4135.090468713209}, {"variable": "ExterQual", "coef": 4195.671512467869}, {"variable": "MSSubClass_80", "coef": 4216.7625838433705}, {"variable": "YearBuilt", "coef": 4226.6848417295205}, {"variable": "Electrical_Mix", "coef": 4322.7865962086}, {"variable": "Foundation_Stone", "coef": 4455.997076931356}, {"variable": "TotRmsAbvGrd", "coef": 4487.638540203077}, {"variable": "MSSubClass_90", "coef": 4557.055469548858}, {"variable": "BldgType_Duplex", "coef": 4557.055469549811}, {"variable": "GarageQual", "coef": 4644.500327876865}, {"variable": "HouseStyle_2.5Unf", "coef": 4653.775934395692}, {"variable": "SaleCondition_Normal", "coef": 4826.399537257637}, {"variable": "Heating_GasW", "coef": 4833.05054662127}, {"variable": "OverallCond", "coef": 4855.535333685491}, {"variable": "Functional", "coef": 4872.9237952031945}, {"variable": "GarageFinish_missing", "coef": 4954.278472445124}, {"variable": "GarageType_missing", "coef": 4954.278472445896}, {"variable": "LotArea", "coef": 5109.356718094045}, {"variable": "Exterior1st_AsbShng", "coef": 5120.293006393819}, {"variable": "Condition1_PosA", "coef": 5140.67553398829}, {"variable": "LotShape_Reg", "coef": 5158.479286776856}, {"variable": "Heating_Grav", "coef": 5190.291196089982}, {"variable": "MasVnrType_missing", "coef": 5227.999814893006}, {"variable": "MasVnrArea", "coef": 5251.325210470901}, {"variable": "Foundation_Slab", "coef": 5526.012292345925}, {"variable": "BsmtExposure", "coef": 5608.772879857661}, {"variable": "Neighborhood_Veenker", "coef": 5822.601229852839}, {"variable": "MSSubClass_20", "coef": 5941.847542383613}, {"variable": "MSZoning_RL", "coef": 6044.699640413513}, {"variable": "Heating_GasA", "coef": 6144.59203407}, {"variable": "MSSubClass_60", "coef": 6199.6521441808}, {"variable": "MSSubClass_30", "coef": 6514.212583022603}, {"variable": "KitchenQual", "coef": 6634.329709663406}, {"variable": "1stFlrSF", "coef": 6736.788904194048}, {"variable": "MSZoning_RH", "coef": 6914.725800370254}, {"variable": "BsmtQual", "coef": 6964.050754565423}, {"variable": "MSZoning_FV", "coef": 7014.536102472964}, {"variable": "Exterior1st_MetalSd", "coef": 7159.5781933800945}, {"variable": "GarageCars", "coef": 7313.309726115012}, {"variable": "LandSlope_Mod", "coef": 7420.208380808602}, {"variable": "RoofMatl_Tar&Grv", "coef": 7477.664156710008}, {"variable": "SaleCondition_AdjLand", "coef": 7561.489272460672}, {"variable": "SaleType_CWD", "coef": 7654.457154786557}, {"variable": "Neighborhood_Crawfor", "coef": 8523.610042315044}, {"variable": "MSSubClass_70", "coef": 8619.529814067288}, {"variable": "SaleType_Con", "coef": 8834.216524278472}, {"variable": "RoofMatl_Roll", "coef": 8868.96309152722}, {"variable": "Heating_Wall", "coef": 8895.888660505303}, {"variable": "Neighborhood_BrDale", "coef": 9121.211896034689}, {"variable": "Condition1_RRAn", "coef": 9185.929467540474}, {"variable": "MiscFeature_Othr", "coef": 9421.362541936696}, {"variable": "Electrical_FuseP", "coef": 9463.27121081932}, {"variable": "Condition1_Norm", "coef": 9586.697177125741}, {"variable": "GarageType_Basment", "coef": 9699.316833194478}, {"variable": "Exterior2nd_CmentBd", "coef": 9840.640389914533}, {"variable": "LotShape_IR2", "coef": 10517.516394855778}, {"variable": "Neighborhood_NPkVill", "coef": 10777.837182669959}, {"variable": "BldgType_2fmCon", "coef": 10790.09931612318}, {"variable": "LandContour_HLS", "coef": 11040.639675746968}, {"variable": "SaleType_ConLD", "coef": 11320.796976704596}, {"variable": "MSSubClass_50", "coef": 11809.213416189454}, {"variable": "Street_Pave", "coef": 12162.130444494325}, {"variable": "SaleType_New", "coef": 12227.838876959268}, {"variable": "OverallQual", "coef": 12487.561838964693}, {"variable": "Exterior1st_BrkFace", "coef": 12541.967859476115}, {"variable": "HouseStyle_1Story", "coef": 12815.120838815941}, {"variable": "LotConfig_CulDSac", "coef": 12819.737233944716}, {"variable": "Condition2_RRAn", "coef": 12980.559992091508}, {"variable": "RoofMatl_WdShake", "coef": 13284.15238948752}, {"variable": "2ndFlrSF", "coef": 13409.901083645735}, {"variable": "RoofStyle_Flat", "coef": 13656.470496702941}, {"variable": "HouseStyle_1.5Unf", "coef": 14032.895201252948}, {"variable": "Condition2_Norm", "coef": 14167.222981540375}, {"variable": "RoofStyle_Shed", "coef": 15102.682897629495}, {"variable": "Utilities_AllPub", "coef": 15686.861940950463}, {"variable": "GrLivArea", "coef": 15988.182407135957}, {"variable": "Condition2_RRNn", "coef": 16023.783252059744}, {"variable": "RoofMatl_Metal", "coef": 16788.51441359313}, {"variable": "Condition2_Feedr", "coef": 18263.753563797636}, {"variable": "Condition2_Artery", "coef": 21040.903496132654}, {"variable": "Exterior2nd_ImStucc", "coef": 24246.497794595303}, {"variable": "RoofMatl_Membran", "coef": 24537.78838124053}, {"variable": "Neighborhood_NoRidge", "coef": 28934.39772146274}, {"variable": "Condition2_PosA", "coef": 32221.637170132606}, {"variable": "PoolQC", "coef": 34217.65604678422}, {"variable": "RoofMatl_CompShg", "coef": 36525.98087352251}, {"variable": "Neighborhood_NridgHt", "coef": 37532.64326986323}, {"variable": "Neighborhood_StoneBr", "coef": 39993.97832393803}, {"variable": "RoofMatl_WdShngl", "coef": 83646.71100760273}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<ul class="simple">
<li><p>How about getting rid of some of these features?</p>
<ul>
<li><p>That’s the idea of Model-based feature selection.</p></li>
</ul>
</li>
<li><p>How do we use model-based selection?</p>
<ul>
<li><p>Decide a threshold.</p></li>
<li><p>Discard all features whose feature importances / coefficients are smaller than the threshold.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>To use model-based selection, we use <code class="docutils literal notranslate"><span class="pre">SelectFromModel</span></code> transformer.</p></li>
<li><p>It selects features which have the feature importances greater than the provided threshold.</p></li>
<li><p>Below I’m using <code class="docutils literal notranslate"><span class="pre">Ridge</span></code> for feature selection with threshold “median” of feature importances.</p></li>
<li><p>Approximately how many features will be selected?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectFromModel</span>

<span class="n">select_lr</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We can put the feature selection transformer in a pipeline.</p></li>
<li><p>Should we put it before preprocessing or after preprocessing?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">select_lr</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># Feature selection with Ridge and final estimator is RandomForestRegressor</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;model_based_fs + rf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_model_based</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.004 (+/- 0.006)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.855 (+/- 0.032)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.463 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.847 (+/- 0.038)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>How many features were passed to feature selection?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_in_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>263
</pre></div>
</div>
</div>
</div>
<p>What’s the threshold used for feature selection?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">threshold_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4855.535333685491
</pre></div>
</div>
</div>
</div>
<p>How many and which features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
    <span class="c1"># visualize the mask. yellow is True, blue is False</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature index&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(());</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_based_mask</span> <span class="o">=</span> <span class="n">pipe_rf_model_based</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;selectfrommodel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">model_based_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2601010ac77ed23d647d542bb7ba7fcdc5318458385bec7f1bffdcadfba2b0db.png" src="../_images/2601010ac77ed23d647d542bb7ba7fcdc5318458385bec7f1bffdcadfba2b0db.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mb_selected_feats</span> <span class="o">=</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">model_based_mask</span><span class="p">]</span>
<span class="n">mb_selected_feats</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(132,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coefficient</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>BsmtFinType2</th>
      <td>-5.674533</td>
      <td>5.674533</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>109.408190</td>
      <td>109.408190</td>
    </tr>
    <tr>
      <th>HouseStyle_SFoyer</th>
      <td>110.057530</td>
      <td>110.057530</td>
    </tr>
    <tr>
      <th>MiscFeature_missing</th>
      <td>-144.483323</td>
      <td>144.483323</td>
    </tr>
    <tr>
      <th>SaleCondition_Alloca</th>
      <td>-147.260030</td>
      <td>147.260030</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Neighborhood_NridgHt</th>
      <td>37532.643270</td>
      <td>37532.643270</td>
    </tr>
    <tr>
      <th>Neighborhood_StoneBr</th>
      <td>39993.978324</td>
      <td>39993.978324</td>
    </tr>
    <tr>
      <th>RoofMatl_WdShngl</th>
      <td>83646.711008</td>
      <td>83646.711008</td>
    </tr>
    <tr>
      <th>Condition2_PosN</th>
      <td>-105552.840565</td>
      <td>105552.840565</td>
    </tr>
    <tr>
      <th>RoofMatl_ClyTile</th>
      <td>-191129.774314</td>
      <td>191129.774314</td>
    </tr>
  </tbody>
</table>
<p>263 rows × 2 columns</p>
</div></div></div>
</div>
<p>BsmtFinType2 feature with a coefficient of smallest magnitude is not selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;BsmtFinType2&quot;</span> <span class="ow">in</span> <span class="n">mb_selected_feats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>About half of the features are selected because our threshold is median.</p></li>
<li><p>We are getting similar results using only half of the features, i.e., with 132 features instead of 263 features!!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.004 (+/- 0.006)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.855 (+/- 0.032)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.463 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.847 (+/- 0.038)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</section>
<section id="recursive-feature-elimination-rfe">
<h3>Recursive feature elimination (RFE)<a class="headerlink" href="#recursive-feature-elimination-rfe" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Similar to model-based selection,</p></li>
<li><p>Based on feature importances</p></li>
<li><p>But it’s different in the sense that it <strong>iteratively</strong> eliminates unimportant features.</p></li>
<li><p>It builds a series of models. At each iteration, discards the least important feature according to the model.</p></li>
<li><p>Computationally expensive</p></li>
</ul>
</section>
<section id="rfe-algorithm">
<h3>RFE algorithm<a class="headerlink" href="#rfe-algorithm" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Decide the number of features to select.</p></li>
<li><p><strong>Assign</strong> importances to features, e.g. by fitting a model and looking at <code class="docutils literal notranslate"><span class="pre">coef_</span></code> or <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code>.</p></li>
<li><p><strong>Remove</strong> the least important feature.</p></li>
<li><p><strong>Repeat</strong> steps 2-3 until only <span class="math notranslate nohighlight">\(k\)</span> features are remaining.</p></li>
</ol>
<p>Note that this is <strong>not</strong> the same as just removing all the less important features in one shot!</p>
<p>How do we use it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFE</span>

<span class="n">rfe</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>

<span class="n">pipe_rf_rfe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfe</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rfe + rfe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_rfe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.004 (+/- 0.006)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.855 (+/- 0.032)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.463 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.847 (+/- 0.038)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>rfe + rfe</th>
      <td>0.821 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.861 (+/- 0.038)</td>
      <td>0.980 (+/- 0.002)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Slightly better results with less features!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>How many features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>120
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What’s the ranking of the selected features?</p></li>
<li><p>Selected features have a rank of 1.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ranking_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 13,   5,  79,   1,   1,   1,   1, 133,   1,  39, 116,   1,   1,
         1,   1, 123,   1,  66, 122,  72,  86,  12,  59, 126,   1, 143,
        95, 139, 129,  81,  77,  53, 136, 131,   1,  52,   1, 138, 113,
         1, 110,  17, 115,   1,   1, 100, 144,   8,  83,  74,   1,   1,
         1,  73, 112,  51, 114,   1,   6, 107, 108, 141,   1,   1,   1,
         1,   1,   1,   1,   1, 109,   1,  55,  54,   1,  30,  45,  76,
        93,  38,  36,  37,  44,   1,   1,   1,   1,   1,   1,   1,   1,
         1, 132,  99, 102, 104,  48,   1,  90,   1,  15,   1, 103,   1,
         1,  47,  50,   1,  18,   1, 137,   1,  58,   7,  91,   1,  14,
        96,  71, 101,  98,  97,  11,   1,   1,   9,  75,   1,   1,   1,
         1,  78,  85,  46, 124,   1, 140,   1,  31,   1, 127, 135, 105,
         1,  80, 106,  68, 119,  67,   1, 118,   1, 117,  41,   1,   1,
         1,   1,   1,   1,   1,   1,  65,   2,  27,   1,   1,   1,  70,
         1,  57,  16, 111,   1,   1,  49,  87,   1, 120,   1,   1,  24,
         1,   1,   1,  34,   1, 142,  64,   1,   1,  20,  19,  84,  62,
        61,   1,   1,  63,   1,   1,  89,   4,  69,  92,   1, 134,   1,
         1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,   1,
        21,   1,   1,  60,   1,   1,  40,  28,  26, 125,  82,  23,  29,
        25,  35,  10, 130,  42,   1,   1,   1,   1, 128,  43,  88,   1,
         1,  94,  22,  32,  33,   1,   3,   1,   1,   1,   1, 121,   1,
         1,  56,   1])
</pre></div>
</div>
</div>
</div>
<p>What features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfe_mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">rfe_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/481b1b51ccc1251859b87d343d59a921017ba12e2a455af44bc4c5dfa6310495.png" src="../_images/481b1b51ccc1251859b87d343d59a921017ba12e2a455af44bc4c5dfa6310495.png" />
</div>
</div>
<ul class="simple">
<li><p>Let’s compare the selected features with features selected with model-based selection.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">model_based_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2601010ac77ed23d647d542bb7ba7fcdc5318458385bec7f1bffdcadfba2b0db.png" src="../_images/2601010ac77ed23d647d542bb7ba7fcdc5318458385bec7f1bffdcadfba2b0db.png" />
</div>
</div>
<p>It seems like there is some overlap between selected features between the two methods but they are not exactly the same.</p>
</section>
<section id="feature-selection-and-categorical-features">
<h3>Feature selection and categorical features<a class="headerlink" href="#feature-selection-and-categorical-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What about categorical features?</p></li>
<li><p>What if it removes one of the one-hot encoded feature and keeps other columns?</p></li>
<li><p>Does it make sense?</p></li>
<li><p>This seems to be unresolved in sklearn: https://github.com/scikit-learn/scikit-learn/issues/8480</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;BldgType&quot;</span><span class="p">)</span>
<span class="p">]</span>  <span class="c1"># All OHE features for the BldgType categorical feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;BldgType_1Fam&#39;,
 &#39;BldgType_2fmCon&#39;,
 &#39;BldgType_Duplex&#39;,
 &#39;BldgType_Twnhs&#39;,
 &#39;BldgType_TwnhsE&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">removed_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">X_train_enc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">rfe_mask</span><span class="p">]</span>
<span class="p">]</span>
<span class="p">[</span>
    <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">removed_columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;BldgType&quot;</span><span class="p">)</span>
<span class="p">]</span>  <span class="c1"># removed features for the BldgType categorical feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;BldgType_1Fam&#39;, &#39;BldgType_2fmCon&#39;, &#39;BldgType_Duplex&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="optional-feature-selection-and-ohe">
<h3>(Optional) Feature selection and OHE<a class="headerlink" href="#optional-feature-selection-and-ohe" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>If you are using OHE with <code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>, and then feature selection, the choice to drop the first is no longer arbitrary.</p>
<ul>
<li><p>Say you have categories A,B,C,D</p></li>
<li><p>you drop=’first’</p></li>
<li><p>so then you have B,C,D and 0,0,0 means A.</p></li>
<li><p>Then you feature select out D</p></li>
<li><p>Now you have B,C</p></li>
<li><p>but now 0,0 means A or D.</p></li>
<li><p>So now the feature removed by feature selection becomes mixed up with the “arbitrary” feature A.</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="rfe-with-cross-validation-rfecv">
<h3>RFE with cross-validation (RFECV)<a class="headerlink" href="#rfe-with-cross-validation-rfecv" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We arbitrarily picked 120 features before.</p></li>
<li><p>How do we know what value to pass to <code class="docutils literal notranslate"><span class="pre">n_features_to_select</span></code>?</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">RFECV</span></code> which uses cross-validation to select number of features.</p></li>
<li><p>Slow because there is cross validation within cross validation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFECV</span>

<span class="n">rfecv</span> <span class="o">=</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">Ridge</span><span class="p">())</span>

<span class="n">pipe_rf_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfecv</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;LandContour&#x27;, &#x27;Utilities&#x27;,
                                                   &#x27;MasVnrType&#x27;,
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;rfecv&#x27;, RFECV(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;LandContour&#x27;, &#x27;Utilities&#x27;,
                                                   &#x27;MasVnrType&#x27;,
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;rfecv&#x27;, RFECV(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;,
                                  &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;,
                                  &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;,
                                  &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                  &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;,
                                  &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;, &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;, &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;, &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;, &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;, &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;, &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse=False)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">rfecv: RFECV</label><div class="sk-toggleable__content"><pre>RFECV(estimator=Ridge())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfecv_fs</span> <span class="o">=</span> <span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span>
<span class="n">rfecv_fs</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>73
</pre></div>
</div>
</div>
</div>
<p>Let’s examine the difference between the features selected by RFECV vs RFE with 120 features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a5725237d9424140086b148e4b1e5a2edafd299be4837c26e90d540cecacd0b1.png" src="../_images/a5725237d9424140086b148e4b1e5a2edafd299be4837c26e90d540cecacd0b1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">pipe_rf_rfe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">support_</span>
<span class="n">show_selected_feature_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/481b1b51ccc1251859b87d343d59a921017ba12e2a455af44bc4c5dfa6310495.png" src="../_images/481b1b51ccc1251859b87d343d59a921017ba12e2a455af44bc4c5dfa6310495.png" />
</div>
</div>
<p>Are we improving the final scores with RFECV?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span> <span class="n">rfecv</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">results</span><span class="p">[</span><span class="s2">&quot;rf+rfecv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe_rf_rfecv</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>-0.005 (+/- 0.006)</td>
      <td>0.000 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>ridge</th>
      <td>0.022 (+/- 0.006)</td>
      <td>0.005 (+/- 0.001)</td>
      <td>0.774 (+/- 0.126)</td>
      <td>0.917 (+/- 0.003)</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>1.004 (+/- 0.006)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.855 (+/- 0.032)</td>
      <td>0.979 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>model_based_fs + rf</th>
      <td>0.463 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.847 (+/- 0.038)</td>
      <td>0.978 (+/- 0.001)</td>
    </tr>
    <tr>
      <th>rfe + rfe</th>
      <td>0.821 (+/- 0.042)</td>
      <td>0.010 (+/- 0.000)</td>
      <td>0.861 (+/- 0.038)</td>
      <td>0.980 (+/- 0.002)</td>
    </tr>
    <tr>
      <th>rf+rfecv</th>
      <td>3.047 (+/- 0.426)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.841 (+/- 0.069)</td>
      <td>0.950 (+/- 0.064)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many features are selected?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_rf_rfecv</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;rfecv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">n_features_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>73
</pre></div>
</div>
</div>
</div>
<p>Let’s examine number of features selected and corresponding cross-validation scores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_features_to_select</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Minimum number of features to consider</span>
<span class="n">pipe_rfecv</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">RFECV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_features_to_select</span><span class="o">=</span><span class="n">min_features_to_select</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">pipe_rfecv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">plot_cross_validated_rfe</span><span class="p">(</span><span class="n">pipe_rfecv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal number of features : 73
</pre></div>
</div>
<img alt="../_images/cf12f29d1f98868d30b4bd2a5e915c076446f0c27f9d0fafa6e2f87fff80bfe3.png" src="../_images/cf12f29d1f98868d30b4bd2a5e915c076446f0c27f9d0fafa6e2f87fff80bfe3.png" />
</div>
</div>
<ul class="simple">
<li><p>Our model is giving us the best results at number of features = 73.</p></li>
<li><p>But in our case when we pass these 73 selected features to <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code>, which is a non-linear model, the scores get worse compared to 120 features or model-based selection. That said, we have reduced the dimensionality a lot.</p></li>
<li><p>This is similar to using cross-validation to tune a hyperparameter.</p></li>
<li><p>Indeed, the number of selected features is a hyperparameter.</p></li>
</ul>
</section>
<section id="sklearn-feature-importances">
<h3><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code><a class="headerlink" href="#sklearn-feature-importances" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Do we have to use Ridge for feature selection?</p></li>
<li><p>Many <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> models have <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code> attribute.</p></li>
<li><p>For tree-based models it’s calculated based on impurity (gini index or information gain).</p></li>
<li><p>For example, you can use <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier</span></code> for feature selection. It will use <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code> attribute instead of coefficients.</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="search-and-score-methods">
<h2>Search and score methods<a class="headerlink" href="#search-and-score-methods" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Not based on feature importances.</p></li>
<li><p>Can work for models which do not have feature importances.</p></li>
<li><p>Define a <strong>scoring function</strong> <span class="math notranslate nohighlight">\(f(S)\)</span> that measures the quality of the set of features <span class="math notranslate nohighlight">\(S\)</span>.</p></li>
<li><p>Now <strong>search</strong> for the set of features <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
</ul>
<section id="general-idea-of-search-and-score-methods">
<h3>General idea of search and score methods<a class="headerlink" href="#general-idea-of-search-and-score-methods" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Example: Suppose you have three features: <span class="math notranslate nohighlight">\(A, B, C\)</span></p>
<ul>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S= \{B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{B,C\}\)</span></p></li>
<li><p>Compute <strong>score</strong> for <span class="math notranslate nohighlight">\(S = \{A,B,C\}\)</span></p></li>
</ul>
</li>
<li><p>Return <span class="math notranslate nohighlight">\(S\)</span> with the best score.</p></li>
<li><p>How many distinct combinations we have to try out?</p></li>
<li><p>This is intractable. So we go with greedy search methods such as forward or backward selection.</p></li>
</ul>
</section>
<section id="forward-or-backward-selection">
<h3>Forward or backward selection<a class="headerlink" href="#forward-or-backward-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Also called wrapper methods</p></li>
<li><p>Shrink or grow feature set by removing or adding one feature at a time</p></li>
<li><p>Makes the decision based on whether adding/removing the feature improves the CV score or not</p></li>
</ul>
<p>Given <span class="math notranslate nohighlight">\(X = \{x_1, x_2, \dots, x_n\}\)</span> and <span class="math notranslate nohighlight">\(y\)</span></p>
<ol class="arabic simple">
<li><p>Start with an empty set of features <span class="math notranslate nohighlight">\(S = \{\}\)</span></p></li>
<li><p>Initialize the score (e.g., score = <span class="math notranslate nohighlight">\(\infty\)</span>, if score is validation error)</p></li>
<li><p>For each possible feature <span class="math notranslate nohighlight">\(x_j, 1\leq j \leq n\)</span></p>
<ul class="simple">
<li><p>Compute the scores of features in <span class="math notranslate nohighlight">\(S\)</span> combined with <span class="math notranslate nohighlight">\(x_j\)</span></p></li>
</ul>
</li>
<li><p>If no <span class="math notranslate nohighlight">\(x_j\)</span> improves the score or desired number of selected features is reached, stop.</p></li>
<li><p>Otherwise add feature <span class="math notranslate nohighlight">\(x_j\)</span> to <span class="math notranslate nohighlight">\(S\)</span> which improves the score the most, update the score, and go back to step 2.</p></li>
</ol>
<p>How do we use these methods in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>

<span class="n">pipe_forward</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">),</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># results[&#39;rf_forward_fs&#39;] = mean_std_cross_val_scores(pipe_forward, X_train, y_train, return_train_score=True)</span>

<span class="n">pipe_forward</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;sequentialfeatureselector&#x27;,
                 SequentialFeatureSelector(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;SaleCondition&#x27;,
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;sequentialfeatureselector&#x27;,
                 SequentialFeatureSelector(estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;,
                                  &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;,
                                  &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;,
                                  &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                  &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;,
                                  &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;, &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;, &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;, &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;, &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;, &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;, &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox" ><label for="sk-estimator-id-35" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox" ><label for="sk-estimator-id-36" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse=False)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox" ><label for="sk-estimator-id-37" class="sk-toggleable__label sk-toggleable__label-arrow">sequentialfeatureselector: SequentialFeatureSelector</label><div class="sk-toggleable__content"><pre>SequentialFeatureSelector(estimator=Ridge())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" ><label for="sk-estimator-id-38" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" ><label for="sk-estimator-id-39" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox" ><label for="sk-estimator-id-40" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_forward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_forward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train score: 0.978
Test score: 0.905
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>VERY SLOW on this dataset and the scores did not improve.</p></li>
<li><p>By default it’s going to select <span class="math notranslate nohighlight">\(d/2\)</span> features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>

<span class="n">pipe_backward</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessor</span><span class="p">,</span>
    <span class="n">SequentialFeatureSelector</span><span class="p">(</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;backward&quot;</span><span class="p">),</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># results[&#39;rf_backward_fs&#39;] = mean_std_cross_val_scores(pipe_forward, X_train, y_train, return_train_score=True)</span>
<span class="n">pipe_backward</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;sequentialfeatureselector&#x27;,
                 SequentialFeatureSelector(direction=&#x27;backward&#x27;,
                                           estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox" ><label for="sk-estimator-id-41" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                                 (&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;BedroomAbvGr&#x27;,
                                                   &#x27;KitchenAbvGr&#x27;,
                                                   &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;,
                                                   &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                                   &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;,
                                                   &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;,
                                                   &#x27;Bs...
                                                   &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;,
                                                   &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                                   &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;,
                                                   &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;,
                                                   &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                                   &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;,
                                                   &#x27;PavedDrive&#x27;, &#x27;Street&#x27;,
                                                   &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])),
                (&#x27;sequentialfeatureselector&#x27;,
                 SequentialFeatureSelector(direction=&#x27;backward&#x27;,
                                           estimator=Ridge())),
                (&#x27;randomforestregressor&#x27;,
                 RandomForestRegressor(random_state=42))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox" ><label for="sk-estimator-id-42" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;drop&#x27;, &#x27;drop&#x27;, [&#x27;Id&#x27;]),
                                (&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;,
                                  &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;,
                                  &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;,
                                  &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;,
                                  &#x27;TotalBsmtSF&#x27;, &#x27;...
                                 [&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;,
                                  &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;,
                                  &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;,
                                  &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;,
                                  &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;,
                                  &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;,
                                  &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;,
                                  &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;,
                                  &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;,
                                  &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-43" type="checkbox" ><label for="sk-estimator-id-43" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;Id&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-44" type="checkbox" ><label for="sk-estimator-id-44" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-45" type="checkbox" ><label for="sk-estimator-id-45" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-1</label><div class="sk-toggleable__content"><pre>[&#x27;BedroomAbvGr&#x27;, &#x27;KitchenAbvGr&#x27;, &#x27;LotFrontage&#x27;, &#x27;LotArea&#x27;, &#x27;OverallQual&#x27;, &#x27;OverallCond&#x27;, &#x27;YearBuilt&#x27;, &#x27;YearRemodAdd&#x27;, &#x27;MasVnrArea&#x27;, &#x27;BsmtFinSF1&#x27;, &#x27;BsmtFinSF2&#x27;, &#x27;BsmtUnfSF&#x27;, &#x27;TotalBsmtSF&#x27;, &#x27;1stFlrSF&#x27;, &#x27;2ndFlrSF&#x27;, &#x27;LowQualFinSF&#x27;, &#x27;GrLivArea&#x27;, &#x27;BsmtFullBath&#x27;, &#x27;BsmtHalfBath&#x27;, &#x27;FullBath&#x27;, &#x27;HalfBath&#x27;, &#x27;TotRmsAbvGrd&#x27;, &#x27;Fireplaces&#x27;, &#x27;GarageYrBlt&#x27;, &#x27;GarageCars&#x27;, &#x27;GarageArea&#x27;, &#x27;WoodDeckSF&#x27;, &#x27;OpenPorchSF&#x27;, &#x27;EnclosedPorch&#x27;, &#x27;3SsnPorch&#x27;, &#x27;ScreenPorch&#x27;, &#x27;PoolArea&#x27;, &#x27;MiscVal&#x27;, &#x27;YrSold&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-46" type="checkbox" ><label for="sk-estimator-id-46" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-47" type="checkbox" ><label for="sk-estimator-id-47" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-48" type="checkbox" ><label for="sk-estimator-id-48" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-2</label><div class="sk-toggleable__content"><pre>[&#x27;ExterQual&#x27;, &#x27;ExterCond&#x27;, &#x27;BsmtQual&#x27;, &#x27;BsmtCond&#x27;, &#x27;HeatingQC&#x27;, &#x27;KitchenQual&#x27;, &#x27;FireplaceQu&#x27;, &#x27;GarageQual&#x27;, &#x27;GarageCond&#x27;, &#x27;PoolQC&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-49" type="checkbox" ><label for="sk-estimator-id-49" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-50" type="checkbox" ><label for="sk-estimator-id-50" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;],
                           [&#x27;Po&#x27;, &#x27;Fa&#x27;, &#x27;TA&#x27;, &#x27;Gd&#x27;, &#x27;Ex&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-51" type="checkbox" ><label for="sk-estimator-id-51" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-3</label><div class="sk-toggleable__content"><pre>[&#x27;BsmtExposure&#x27;, &#x27;BsmtFinType1&#x27;, &#x27;BsmtFinType2&#x27;, &#x27;Functional&#x27;, &#x27;Fence&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox" ><label for="sk-estimator-id-52" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox" ><label for="sk-estimator-id-53" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(categories=[[&#x27;NA&#x27;, &#x27;No&#x27;, &#x27;Mn&#x27;, &#x27;Av&#x27;, &#x27;Gd&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;NA&#x27;, &#x27;Unf&#x27;, &#x27;LwQ&#x27;, &#x27;Rec&#x27;, &#x27;BLQ&#x27;, &#x27;ALQ&#x27;, &#x27;GLQ&#x27;],
                           [&#x27;Sal&#x27;, &#x27;Sev&#x27;, &#x27;Maj2&#x27;, &#x27;Maj1&#x27;, &#x27;Mod&#x27;, &#x27;Min2&#x27;, &#x27;Min1&#x27;,
                            &#x27;Typ&#x27;],
                           [&#x27;NA&#x27;, &#x27;MnWw&#x27;, &#x27;GdWo&#x27;, &#x27;MnPrv&#x27;, &#x27;GdPrv&#x27;]])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox" ><label for="sk-estimator-id-54" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline-4</label><div class="sk-toggleable__content"><pre>[&#x27;LotConfig&#x27;, &#x27;Alley&#x27;, &#x27;MiscFeature&#x27;, &#x27;LotShape&#x27;, &#x27;RoofStyle&#x27;, &#x27;Electrical&#x27;, &#x27;Foundation&#x27;, &#x27;RoofMatl&#x27;, &#x27;Exterior2nd&#x27;, &#x27;Exterior1st&#x27;, &#x27;LandContour&#x27;, &#x27;Utilities&#x27;, &#x27;MasVnrType&#x27;, &#x27;SaleCondition&#x27;, &#x27;CentralAir&#x27;, &#x27;MoSold&#x27;, &#x27;Condition2&#x27;, &#x27;BldgType&#x27;, &#x27;GarageType&#x27;, &#x27;GarageFinish&#x27;, &#x27;LandSlope&#x27;, &#x27;HouseStyle&#x27;, &#x27;MSZoning&#x27;, &#x27;Condition1&#x27;, &#x27;Neighborhood&#x27;, &#x27;MSSubClass&#x27;, &#x27;PavedDrive&#x27;, &#x27;Street&#x27;, &#x27;Heating&#x27;, &#x27;SaleType&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox" ><label for="sk-estimator-id-55" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox" ><label for="sk-estimator-id-56" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;, sparse=False)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox" ><label for="sk-estimator-id-57" class="sk-toggleable__label sk-toggleable__label-arrow">sequentialfeatureselector: SequentialFeatureSelector</label><div class="sk-toggleable__content"><pre>SequentialFeatureSelector(direction=&#x27;backward&#x27;, estimator=Ridge())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox" ><label for="sk-estimator-id-58" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox" ><label for="sk-estimator-id-59" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox" ><label for="sk-estimator-id-60" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(random_state=42)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_backward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test score: </span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipe_backward</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train score: 0.978
Test score: 0.894
</pre></div>
</div>
</div>
</div>
</section>
<section id="other-ways-to-search">
<h3>Other ways to search<a class="headerlink" href="#other-ways-to-search" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Stochastic local search</p>
<ul>
<li><p>Inject randomness so that we can explore new parts of the search space</p></li>
<li><p>Simulated annealing</p></li>
<li><p>Genetic algorithms</p></li>
</ul>
</li>
</ul>
</section>
<section id="warnings-about-feature-selection">
<h3>Warnings about feature selection<a class="headerlink" href="#warnings-about-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A feature’s relevance is only defined in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>If features can be predicted from other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span> for the data you have.</p></li>
</ul>
</li>
</ul>
<section id="general-advice-on-finding-relevant-features">
<h4>General advice on finding relevant features<a class="headerlink" href="#general-advice-on-finding-relevant-features" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Try RFE, forward selection or other feature selection methods (e.g., simulated annealing, genetic algorithms)</p></li>
<li><p>Talk to domain experts; they probably have an idea why certain features are relevant.</p></li>
<li><p>Don’t be overconfident.</p>
<ul>
<li><p>The methods we have seen probably do not discover the ground truth and how the world really works.</p></li>
<li><p>They simply tell you which features help in predicting <span class="math notranslate nohighlight">\(y_i\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-4-1">
<h3>iClicker Exercise 4.1<a class="headerlink" href="#iclicker-exercise-4-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/C0P55</strong></p>
<p><strong>Select the below.</strong></p>
<ul class="simple">
<li><p>(A) Simple association-based feature selection approaches do not take into account the interaction between features.</p></li>
<li><p>(B) You can carry out feature selection using linear models by pruning the features which have very small weights (i.e., coefficients less than a threshold).</p></li>
<li><p>(C) Forward search is guaranteed to find the best feature set.</p></li>
<li><p>(D) RFE and backward selection are basically the same.</p></li>
<li><p>(E) The order of features removed given by <code class="docutils literal notranslate"><span class="pre">rfe.ranking_</span></code> is the same as the order of original feature importances given by the model.</p></li>
</ul>
<p><strong>V’s answers: A, B</strong></p>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>What did we learn today?</p>
<ul class="simple">
<li><p>Feature importances</p></li>
<li><p>Limitations of correlation based methods.</p></li>
<li><p>How to interpret coefficients of different types of features</p></li>
<li><p>Why do we need feature selection?</p></li>
<li><p>Model based feature selection</p></li>
<li><p>Recursive feature elimination</p></li>
<li><p>Forward/backward selection</p></li>
</ul>
<ul class="simple">
<li><p>We started with building a preliminary supervised machine learning pipeline in DSCI 571.</p></li>
<li><p>Now we are refining the pipeline by adding more components in it.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/ml-workflow.png"><img alt="../_images/ml-workflow.png" src="../_images/ml-workflow.png" style="width: 800px; height: 800px;" /></a>
<section id="coming-up">
<h3>Coming up<a class="headerlink" href="#coming-up" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Model selection with complexity penalty</p></li>
<li><p>Regularization</p></li>
</ul>
<p><br><br><br><br></p>
</section>
<section id="optional-problems-with-feature-selection">
<h3>(Optional) Problems with feature selection<a class="headerlink" href="#optional-problems-with-feature-selection" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The term ‘relevance’ is not clearly defined.</p></li>
<li><p>What all things can go wrong with feature selection?</p></li>
<li><p>Attribution: From CPSC 340.</p></li>
</ul>
<section id="example-is-relevance-clearly-defined">
<h4>Example: Is “Relevance” clearly defined?<a class="headerlink" href="#example-is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Consider a supervised classification task of predicting whether someone has particular genetic variation (SNP)</p></li>
</ul>
<!-- <img src='img/sex_mom_dad.png' width="600" height="600" /> -->
<p><img alt="" src="../_images/sex_mom_dad1.png" /></p>
<ul class="simple">
<li><p>True model: You almost have the same value as your biological mom.</p></li>
</ul>
</section>
<section id="is-relevance-clearly-defined">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#is-relevance-clearly-defined" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>True model: You almost have the same value for SNP as your biological mom.</p>
<ul>
<li><p>(SNP = biological mom) with very high probability</p></li>
<li><p>(SNP != biological mom) with very low probability</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/SNP.png' width="400" height="400"/> -->
<p><img alt="" src="../_images/SNP1.png" /></p>
</section>
<section id="id1">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if “mom” feature is repeated?</p></li>
<li><p>Should we pick both? Should we pick one of them because it predicts the other?</p></li>
<li><p>Dependence, collinearity for linear models</p>
<ul>
<li><p>If a feature can be predicted from the other, don’t know which one to pick.</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_mom_mom2_dad.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_mom_mom2_dad1.png" /></p>
</section>
<section id="id2">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we add (maternal) “grandma” feature?</p></li>
<li><p>Is it relevant?</p>
<ul>
<li><p>We can predict SNP accurately using this feature</p></li>
</ul>
</li>
<li><p>Conditional independence</p>
<ul>
<li><p>But grandma is irrelevant given biological mom feature</p></li>
<li><p>Relevant features may become irrelevant given other features</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_mom_dad_grandma.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_mom_dad_grandma1.png" /></p>
</section>
<section id="id3">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if we do not know biological mom feature and we just have grandma feature</p></li>
<li><p>It becomes relevant now.</p>
<ul>
<li><p>Without mom feature this is the best we can do.</p></li>
</ul>
</li>
<li><p>General problem (“taco Tuesday” problem)</p>
<ul>
<li><p>Features can become relevant due to missing information</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_grandma.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_grandma1.png" /></p>
</section>
<section id="id4">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Are there any relevant features now?</p></li>
<li><p>They may have some common maternal ancestor.</p></li>
<li><p>What if mom likes dad because they share SNP?</p></li>
<li><p>General problem (Confounding)</p>
<ul>
<li><p>Hidden features can make irrelevant features relevant.</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad1.png" /></p>
</section>
<section id="id5">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Now what if we have “sibling” feature?</p></li>
<li><p>The feature is relevant in predicting SNP but not the cause of SNP.</p></li>
<li><p>General problem (non causality)</p>
<ul>
<li><p>the relevant feature may not be causal</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_sibling.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_sibling1.png" /></p>
</section>
<section id="id6">
<h4>Is “Relevance” clearly defined?<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>What if you are given “baby” feature?</p></li>
<li><p>Now the sex feature becomes relevant.</p>
<ul>
<li><p>“baby” feature is relevant when sex == F</p></li>
</ul>
</li>
<li><p>General problem (context specific relevance)</p>
<ul>
<li><p>adding a feature can make an irrelevant feature relevant</p></li>
</ul>
</li>
</ul>
<!-- <img src='img/sex_dad_baby.png' width="600" height="600"/> -->
<p><img alt="" src="../_images/sex_dad_baby1.png" /></p>
</section>
<section id="id7">
<h4>Warnings about feature selection<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>A feature is only relevant in the context of other features.</p>
<ul>
<li><p>Adding/removing features can make features relevant/irrelevant.</p></li>
</ul>
</li>
<li><p>Confounding factors can make irrelevant features the most relevant.</p></li>
<li><p>If features can be predicted from other other features, you cannot know which one to pick.</p></li>
<li><p>Relevance for features does not have a causal relationship.</p></li>
<li><p>Is feature selection completely hopeless?</p>
<ul>
<li><p>It is messy but we still need to do it. So we try to do our best!</p></li>
</ul>
</li>
</ul>
</section>
<section id="relevant-resources">
<h4>Relevant resources<a class="headerlink" href="#relevant-resources" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Genome-wide_association_study">Genome-wide association study</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/feature_selection.html">sklearn feature selection</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=ioXKxulmwVQ">PyData: A Practical Guide to Dimensionality Reduction Techniques</a></p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "571"
        },
        kernelOptions: {
            name: "571",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '571'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="03_feature-engineering.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 3: Feature engineering</p>
      </div>
    </a>
    <a class="right-next"
       href="05_loss-functions-regularization_intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 5: Loss functions, intro to regularization</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-los">Imports and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-separate-x-and-y">Let’s separate <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-identify-feature-types">Let’s identify feature types</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplefeature-correlations">SimpleFeature correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances-in-linear-models">Feature importances in linear models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-features">Ordinal features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-features">Categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-coefficients-of-numeric-features">Interpreting coefficients of numeric features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-showing-how-can-we-interpret-coefficients-of-scaled-features">Example showing how can we interpret coefficients of scaled features.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-introduction-and-motivation">Feature selection: Introduction and motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-selection">What is feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-feature-selection">Why feature selection?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-carry-out-feature-selection">How do we carry out feature selection?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-using-feature-importances">Feature selection using feature importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-based-feature-selection">Model-based feature selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-feature-elimination-rfe">Recursive feature elimination (RFE)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-algorithm">RFE algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection-and-categorical-features">Feature selection and categorical features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-feature-selection-and-ohe">(Optional) Feature selection and OHE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rfe-with-cross-validation-rfecv">RFE with cross-validation (RFECV)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sklearn-feature-importances"><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> <code class="docutils literal notranslate"><span class="pre">feature_importances_</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#search-and-score-methods">Search and score methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-idea-of-search-and-score-methods">General idea of search and score methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-or-backward-selection">Forward or backward selection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-ways-to-search">Other ways to search</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#warnings-about-feature-selection">Warnings about feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-advice-on-finding-relevant-features">General advice on finding relevant features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-4-1">iClicker Exercise 4.1</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coming-up">Coming up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-problems-with-feature-selection">(Optional) Problems with feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-is-relevance-clearly-defined">Example: Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#is-relevance-clearly-defined">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Is “Relevance” clearly defined?</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Warnings about feature selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#relevant-resources">Relevant resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar and Joel Östblom
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>