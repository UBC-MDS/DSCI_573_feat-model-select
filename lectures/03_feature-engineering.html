

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 3: Feature engineering &#8212; DSCI 573 Feature and Model Selection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/03_feature-engineering';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 4: Feature importances and feature selection" href="04_feat-importances-selection.html" />
    <link rel="prev" title="Lecture 2: Regression metrics" href="02_regression-metrics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/mds-hex-sticker.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/mds-hex-sticker.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_classification-metrics.html">Lecture 1: Classification metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_regression-metrics.html">Lecture 2: Regression metrics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 3: Feature engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_feat-importances-selection.html">Lecture 4: Feature importances and feature selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_loss-functions-regularization_intro.html">Lecture 5: Loss functions, intro to regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_L2-L1-regularization.html">Lecture 6: L2- and L1-Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_ensembles.html">Lecture 7: Ensembles</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_model-transparency-conclusion.html">Lecture 8: Model transparency and conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/03_feature-engineering.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 3: Feature engineering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-lo">Imports and LO</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-motivation">Feature engineering: Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-3-1">iClicker Exercise 3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#garbage-in-garbage-out">Garbage in, garbage out.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activity-how-can-you-measure-quality-of-the-data-3-mins">Activity: How can you measure quality of the data? (~3 mins)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-engineering">What is feature engineering?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-quotes-on-feature-engineering">Some quotes on feature engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-features-usually-help-more-than-a-better-model">Better features usually help more than a better model.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-best-features-may-be-dependent-on-the-model-you-use">The best features may be dependent on the model you use.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#domain-specific-transformations">Domain-specific transformations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-feature-transformations-for-non-linear-regression">Polynomial feature transformations for non-linear regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-prediction-recap">Linear regression prediction (recap)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-vector-notation">Matrix vector notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-column-of-ones-notation">An example of column of ones notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations-of-linear-regression">Limitations of linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-transformations">Polynomial transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-quadratic-features">Adding quadratic features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-regression-in-sklearn">Polynomial regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomialfeatures-with-sklearn-pipelines"><code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code> with sklearn pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-setting-non-linearly-separable-data">Classification setting: Non-linearly separable data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-another-example-with-two-features">(Optional) Another example with two features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-interactions-and-feature-crosses">Feature interactions and feature crosses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-crosses-for-one-hot-encoded-features">Feature crosses for one-hot encoded features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-to-consider">Questions to consider</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-polynomial-basis">Problems with polynomial basis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-we-do-this-efficiently">How can we do this efficiently?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-recall-rbf-kernel">(Optional) Recall RBF Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbfs">RBFs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-rbfs">Example: RBFs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-radial-basis-functions-gaussian-rbfs">Gaussian Radial Basis Functions (Gaussian RBFs)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-rbfs-non-parametric-basis">Gaussian RBFs (non-parametric basis)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-gamma-in-svm-rbf">Interpretation of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> in SVM RBF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-gaussian-rbf-with-x-and-sigma">Constructing Gaussian RBF with <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-rbfs-prediction">Gaussian RBFs: Prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbf-with-regulariation-and-optimized-sigma-and-lambda">RBF with regulariation and optimized <span class="math notranslate nohighlight">\(sigma\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-rbf-with-least-squares-kernelridge-optional">Using RBF with least squares: KernelRidge (optional)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-3-2">iClicker Exercise 3.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-of-feature-engineering-with-numeric-features">Demo of feature engineering with numeric features</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-for-text-data">Feature engineering for text data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-classifier">Dummy classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bag-of-words-model">Bag-of-words model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-it-possible-to-further-improve-the-scores">Is it possible to further improve the scores?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spacy">spaCy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-from-a-project">An example from a project</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-feature-engineering-for-our-problem">Simple feature engineering for our problem.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-features-used-in-text-classification">Common features used in text classification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bag-of-words">Bag of words</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-label-personalized-important-e-mails">Example: Label “Personalized” Important E-mails:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-learning-behind-gmail-priority-inbox">The Learning Behind Gmail Priority Inbox</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-examples-automatically-identifying-good-conversations-online">Feature engineering examples: Automatically Identifying Good Conversations Online</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-term-weighing-tf-idf">(Optional) Term weighing (TF-IDF)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#n-grams">N-grams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aside-google-n-gram-viewer">ASIDE: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Aside: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Aside: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-features">Part-of-speech features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-pos-in-english">Part-of-speech (POS) in English</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-pos-features">Part-of-speech (POS) features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">An example from a project</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penn-treebank-part-of-speech-tags-bonus">Penn Treebank part-of-speech tags (bonus)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature engineering</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/573_banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-3-feature-engineering">
<h1>Lecture 3: Feature engineering<a class="headerlink" href="#lecture-3-feature-engineering" title="Permalink to this heading">#</a></h1>
<p>UBC Master of Data Science program, 2022-23</p>
<p>Instructor: Varada Kolhatkar</p>
<section id="imports-and-lo">
<h2>Imports and LO<a class="headerlink" href="#imports-and-lo" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code/.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">npr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">plotting_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">RidgeCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h3>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Explain the importance of the quality of data.</p></li>
<li><p>Explain the importance of feature engineering when building machine learning models.</p></li>
<li><p>Explain the “column of ones” trick.</p></li>
<li><p>Explain the concept of polynomial feature transformations.</p></li>
<li><p>Apply linear models to non-linear datasets using polynomial features.</p></li>
<li><p>Explain the idea of feature crosses.</p></li>
<li><p>Identify when is it appropriate to apply discretization to numeric features.</p></li>
<li><p>Carry out preliminary feature engineering on text data using <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> and <code class="docutils literal notranslate"><span class="pre">nltk</span></code>.</p></li>
</ul>
</section>
</section>
<section id="feature-engineering-motivation">
<h2>Feature engineering: Motivation<a class="headerlink" href="#feature-engineering-motivation" title="Permalink to this heading">#</a></h2>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<section id="iclicker-exercise-3-1">
<h3>iClicker Exercise 3.1<a class="headerlink" href="#iclicker-exercise-3-1" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/C0P55</strong></p>
<p><strong>Select the most accurate option below.</strong></p>
<p>Suppose you are working on a machine learning project. If you have to prioritize one of the following in your project which of the following would it be?</p>
<ul class="simple">
<li><p>(A) The quality and size of the data</p></li>
<li><p>(B) Most recent deep neural network model</p></li>
<li><p>(C) Most recent optimization algorithm</p></li>
</ul>
<p><strong>V’s answers: (A)</strong></p>
</section>
<section id="garbage-in-garbage-out">
<h3>Garbage in, garbage out.<a class="headerlink" href="#garbage-in-garbage-out" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Model building is interesting. But in your machine learning projects, you’ll be spending more than half of your time on data preparation, feature engineering, and transformations.</p></li>
<li><p>The <em>quality</em> of the data is important. Your model is only as good as your data.</p></li>
</ul>
</section>
<section id="activity-how-can-you-measure-quality-of-the-data-3-mins">
<h3>Activity: How can you measure quality of the data? (~3 mins)<a class="headerlink" href="#activity-how-can-you-measure-quality-of-the-data-3-mins" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Write some attributes of good- and bad-quality data in
<a class="reference external" href="https://docs.google.com/document/d/1nsOsdO-zRwvWWwM4-6h2t7eHgIhW8FCy3ebxoT7p0HY/edit#heading=h.z9l5ophupovf">this Google Document</a>.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="what-is-feature-engineering">
<h3>What is feature engineering?<a class="headerlink" href="#what-is-feature-engineering" title="Permalink to this heading">#</a></h3>
<blockquote>
<b>Feature engineering</b> is the process of determining which features might be useful in the model building and creating those features by transforming the given data or extracting them using alternative sources.  
<br> 
</blockquote>    <ul class="simple">
<li><p>In 571 we talked about hyperparameter tuning, which is one way to get better model performance.</p></li>
<li><p>Another way is by changing the input representation.</p></li>
<li><p>Better representation: more flexibility, higher score, we can get by with simple and more interpretable models.</p></li>
<li><p>If your features, i.e., representation is bad, whatever fancier model you build is not going to help.</p></li>
</ul>
</section>
<section id="some-quotes-on-feature-engineering">
<h3>Some quotes on feature engineering<a class="headerlink" href="#some-quotes-on-feature-engineering" title="Permalink to this heading">#</a></h3>
<p>A quote by Pedro Domingos <a class="reference external" href="https://homes.cs.washington.edu/~pedrod/papers/cacm12.pdf">A Few Useful Things to Know About Machine Learning</a></p>
<blockquote>
... At the end of the day, some machine learning projects succeed and some fail. What makes the difference? Easily the most important factor is the features used. 
</blockquote>
<p>A quote by Andrew Ng, <a class="reference external" href="https://ai.stanford.edu/~ang/slides/DeepLearning-Mar2013.pptx">Machine Learning and AI via Brain simulations</a></p>
<blockquote>
Coming up with features is difficult, time-consuming, requires expert knowledge. "Applied machine learning" is basically feature engineering.
</blockquote></section>
<section id="better-features-usually-help-more-than-a-better-model">
<h3>Better features usually help more than a better model.<a class="headerlink" href="#better-features-usually-help-more-than-a-better-model" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Good features would ideally:</p>
<ul>
<li><p>capture most important aspects of the problem</p></li>
<li><p>allow learning with few examples</p></li>
<li><p>generalize to new scenarios.</p></li>
</ul>
</li>
<li><p>There is a trade-off between simple and expressive features:</p>
<ul>
<li><p>With simple features overfitting risk is low, but scores might be low.</p></li>
<li><p>With complicated features scores can be high, but so is overfitting risk.</p></li>
</ul>
</li>
</ul>
</section>
<section id="the-best-features-may-be-dependent-on-the-model-you-use">
<h3>The best features may be dependent on the model you use.<a class="headerlink" href="#the-best-features-may-be-dependent-on-the-model-you-use" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Examples:</p>
<ul>
<li><p>For counting-based methods like decision trees separate relevant groups of variable values</p>
<ul>
<li><p>Discretization makes sense</p></li>
</ul>
</li>
<li><p>For distance-based methods like KNN, we want different class labels to be “far”.</p>
<ul>
<li><p>Standardization</p></li>
</ul>
</li>
<li><p>For regression-based methods like linear regression, we want targets to have a linear dependency on features.</p></li>
</ul>
</li>
</ul>
<section id="domain-specific-transformations">
<h4>Domain-specific transformations<a class="headerlink" href="#domain-specific-transformations" title="Permalink to this heading">#</a></h4>
<p>In some domains there are natural transformations to do:</p>
<ul class="simple">
<li><p>Spectrograms (sound data)</p></li>
<li><p>Wavelets (image data)</p></li>
<li><p>Convolutions</p></li>
</ul>
<!-- <center> -->
<p><img alt="" src="../_images/spectogram1.png" /></p>
<!-- <img src="img/spectogram.png" width="800" height="800"> -->
<!-- </center> -->
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Spectrogram">Source</a></p>
<p>In this lecture we’ll talk about the following:</p>
<ul class="simple">
<li><p>Polynomial features (change of basis)</p></li>
<li><p>Feature engineering demos</p>
<ul>
<li><p>numeric data</p></li>
<li><p>text data</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
</section>
<section id="polynomial-feature-transformations-for-non-linear-regression">
<h2>Polynomial feature transformations for non-linear regression<a class="headerlink" href="#polynomial-feature-transformations-for-non-linear-regression" title="Permalink to this heading">#</a></h2>
<section id="linear-regression-prediction-recap">
<h3>Linear regression prediction (recap)<a class="headerlink" href="#linear-regression-prediction-recap" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Interested in predicting a scalar valued target (e.g., housing price)</p></li>
<li><p>In DSCI 571, we talked about how to make predictions <span class="math notranslate nohighlight">\(\hat{y_i}\)</span>, which is the linear function of feature vector <span class="math notranslate nohighlight">\(x_i\)</span> and weight vector <span class="math notranslate nohighlight">\(w\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{y_i} = w_0 + x_{i1}w_1 + x_{i2}w_2 + \ldots + x_{id}w_d\]</div>
<div class="math notranslate nohighlight">
\[\hat{y_i} = w_0 + \sum_{j=1}^{d}x_{ij}w_j\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{y_i} \rightarrow\)</span> prediction for example <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w \rightarrow\)</span> weight vector</p></li>
<li><p><span class="math notranslate nohighlight">\(w_0 \rightarrow\)</span> bias term</p></li>
<li><p><span class="math notranslate nohighlight">\(x_{ij} \rightarrow\)</span> <span class="math notranslate nohighlight">\(j^{th}\)</span> component of the feature vector <span class="math notranslate nohighlight">\(x_i\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w_0, w_1, \ldots, w_d\)</span> together are the parameters</p></li>
</ul>
</section>
<section id="matrix-vector-notation">
<h3>Matrix vector notation<a class="headerlink" href="#matrix-vector-notation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The notation above is component-wise notation.</p></li>
<li><p>We also want to be able to write it as below so that we don’t have to write the summation all the time.</p></li>
<li><p>In matrix form, the expression for a linear model is:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\hat{y} = Xw\]</div>
<ul class="simple">
<li><p>Where</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\hat{y} \rightarrow\)</span> prediction vector for feature matrix <span class="math notranslate nohighlight">\(X\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w \rightarrow\)</span> weight vector</p></li>
</ul>
</li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split} \begin{bmatrix}\hat{y_1} \\ \hat{y_2} \\ \vdots \\ \hat{y_n}\end{bmatrix}_{n \times 1} = \begin{bmatrix} 1 &amp; x_{11} &amp; x_{12} &amp; \ldots &amp; x_{1d} \\  1 &amp; x_{21} &amp; x_{22} &amp; \ldots &amp; x_{2d}  \\ \vdots \\ 1 &amp; x_{n1} &amp; x_{n2} &amp; \ldots &amp; x_{nd}\end{bmatrix}_{n \times (d+1)} \begin{bmatrix}w_0 \\ w_1 \\ w_2 \\ \vdots \\ w_d\end{bmatrix}_{(d+1) \times 1} \end{split}\]</div>
<ul class="simple">
<li><p>This notation is matrix vector notation. What happened to the bias term?</p></li>
<li><p>For simplicity, we rename the bias term as <span class="math notranslate nohighlight">\(w_0\)</span> and introduce a dummy feature whose value is always 1.</p></li>
<li><p>So <span class="math notranslate nohighlight">\(w_0 + w_1x_{i1} + \dots + w_dx_{id}\)</span> becomes <span class="math notranslate nohighlight">\(w_0x_{i0} + w_1x_{i1} + \dots + w_nx_{id}\)</span>, where <span class="math notranslate nohighlight">\(x_{i0}\)</span> is always 1.</p></li>
<li><p>This is often referred to as “column of ones” trick.</p></li>
</ul>
</section>
<section id="an-example-of-column-of-ones-notation">
<h3>An example of column of ones notation<a class="headerlink" href="#an-example-of-column-of-ones-notation" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose <span class="math notranslate nohighlight">\(X\)</span> has only one feature:
$<span class="math notranslate nohighlight">\(X = \begin{bmatrix}0.86 \\ 0.02 \\ -0.42 \end{bmatrix}\)</span>$</p></li>
<li><p>Make a new matrix <span class="math notranslate nohighlight">\(Z\)</span> with an extra feature whose value is always 1.
$<span class="math notranslate nohighlight">\(Z = \begin{bmatrix}1 &amp; 0.86\\ 1 &amp; 0.02 \\ 1 &amp; -0.42\\ \end{bmatrix}\)</span>$</p></li>
</ul>
<ul class="simple">
<li><p>So far we assumed that we magically learned the parameters <span class="math notranslate nohighlight">\(w\)</span>.</p></li>
<li><p>The most common way to learn these parameters in linear regression is by minimizing the quadratic cost between <strong>the actual target <span class="math notranslate nohighlight">\(y\)</span> and the model predictions <span class="math notranslate nohighlight">\(\hat{y}\)</span></strong>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[J(w) = \sum_{i=1}^n (y_i - x_i^Tw)^2 = (y - Xw)^T(y-Xw)\]</div>
<ul class="simple">
<li><p>This is called <strong>ordinary least squares</strong>, the most commonly used <strong>loss function</strong> or <strong>cost function</strong> for linear regression.</p></li>
<li><p>More on this later.</p></li>
</ul>
</section>
<section id="limitations-of-linear-regression">
<h3>Limitations of linear regression<a class="headerlink" href="#limitations-of-linear-regression" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Linear models are fast and scalable.</p></li>
<li><p>But they might seem rather limited, especially in low-dimensional spaces because they only learn lines, planes, or hyperplanes.</p></li>
<li><p>What if the true relationship between the target and the features is non-linear?</p></li>
<li><p>Can we still use ordinary least squares to fit non-linear data?</p></li>
<li><p>One way to make linear models more flexible is using feature mappings or transformations!</p></li>
</ul>
<p><br><br></p>
</section>
<section id="polynomial-transformations">
<h3>Polynomial transformations<a class="headerlink" href="#polynomial-transformations" title="Permalink to this heading">#</a></h3>
<p>Let’s consider this synthetic toy data with only one feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">npr</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">X_toy</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">y_toy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feat1&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat1</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-3.000000</td>
      <td>10.331587</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-2.684211</td>
      <td>7.920265</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-2.368421</td>
      <td>4.064018</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.052632</td>
      <td>4.204913</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.736842</td>
      <td>3.637956</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.421053</td>
      <td>1.299305</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-1.105263</td>
      <td>1.487118</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.789474</td>
      <td>0.731817</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.473684</td>
      <td>0.228668</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.157895</td>
      <td>-0.149669</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.157895</td>
      <td>0.457957</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.473684</td>
      <td>1.427414</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.789474</td>
      <td>-0.341797</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1.105263</td>
      <td>2.249881</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1.421053</td>
      <td>2.248021</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.736842</td>
      <td>3.461758</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2.052632</td>
      <td>3.076694</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2.368421</td>
      <td>5.744555</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2.684211</td>
      <td>8.689523</td>
    </tr>
    <tr>
      <th>19</th>
      <td>3.000000</td>
      <td>7.920195</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s plot the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_toy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;feat1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f30faff9a672da6eeaf8416cd97fc2b903e584118b60308176d99ec7f651d028.png" src="../_images/f30faff9a672da6eeaf8416cd97fc2b903e584118b60308176d99ec7f651d028.png" />
</div>
</div>
<ul class="simple">
<li><p>Can simple linear regression fit this data?</p></li>
<li><p>Let’s try it out.</p>
<ul>
<li><p>Right now we are focussing on creating a better fit on the training data. So we are skipping splitting the data for the demonstration purpose.</p></li>
<li><p>Also, for simplicity, we are using <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code>, which doesn’t have any hyperparameter controlling the complexity of the model.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit a regression line.</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;feat1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e7d0204a645712ce79c3ef51dbc09a2f6952adea3559804ce41d059c03095c6e.png" src="../_images/e7d0204a645712ce79c3ef51dbc09a2f6952adea3559804ce41d059c03095c6e.png" />
</div>
</div>
<ul class="simple">
<li><p>As expected, the regression line is unable to capture the shape of the data.</p></li>
<li><p>The model is underfit.</p></li>
<li><p>The score on the training data is close to a dummy model.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0002572570295679144
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DummyRegressor</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="adding-quadratic-features">
<h3>Adding quadratic features<a class="headerlink" href="#adding-quadratic-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>It looks like a quadratic function would be more suitable for this dataset.</p></li>
<li><p>A linear model on its own cannot fit a quadratic function. But what if we <strong>augment the data with a new quadratic feature</strong>?</p></li>
<li><p>Let’s try it out.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add a squared feature</span>
<span class="n">X_sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">X_toy</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_sq</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feat1&quot;</span><span class="p">,</span> <span class="s2">&quot;feat1^2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat1</th>
      <th>feat1^2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-3.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-2.684211</td>
      <td>7.204986</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-2.368421</td>
      <td>5.609418</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.052632</td>
      <td>4.213296</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.736842</td>
      <td>3.016620</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.421053</td>
      <td>2.019391</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-1.105263</td>
      <td>1.221607</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.789474</td>
      <td>0.623269</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.473684</td>
      <td>0.224377</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.157895</td>
      <td>0.024931</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.157895</td>
      <td>0.024931</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.473684</td>
      <td>0.224377</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.789474</td>
      <td>0.623269</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1.105263</td>
      <td>1.221607</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1.421053</td>
      <td>2.019391</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.736842</td>
      <td>3.016620</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2.052632</td>
      <td>4.213296</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2.368421</td>
      <td>5.609418</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2.684211</td>
      <td>7.204986</td>
    </tr>
    <tr>
      <th>19</th>
      <td>3.000000</td>
      <td>9.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s plot our augmented data along with <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_3d_reg</span><span class="p">(</span><span class="n">X_sq</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># user-defined function from plotting_functions.py</span>
<span class="n">plot_3d_reg</span><span class="p">(</span><span class="n">X_sq</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bdef8ee453b35d3eb1a7fdb2dd80584a846bc235163be582a12d8eb5d0705d34.png" src="../_images/bdef8ee453b35d3eb1a7fdb2dd80584a846bc235163be582a12d8eb5d0705d34.png" />
<img alt="../_images/f09095511e3e3e737bdb42c7094289f057a72e3b3962520593d75347b9138cc7.png" src="../_images/f09095511e3e3e737bdb42c7094289f057a72e3b3962520593d75347b9138cc7.png" />
</div>
</div>
<ul class="simple">
<li><p>A linear model fits well on this augmented data now!!</p></li>
<li><p>This is a common way to make linear models more flexible by adding more degrees of freedom.</p></li>
<li><p>The model is still linear, i.e., it’s still learning the coefficients for each feature. But the feature space is augmented now.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sq</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>  <span class="c1"># Linear regression with augmented data</span>
<span class="n">lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_sq</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>  <span class="c1"># The scores are much better now</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9270602202765702
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feat1&quot;</span><span class="p">,</span> <span class="s2">&quot;feat1^2&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Feature coefficient&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>feat1</th>
      <td>-0.027196</td>
    </tr>
    <tr>
      <th>feat1^2</th>
      <td>1.006051</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>According to the model, our newly created feat1^2 feature is the most important feature for prediction; the coefficient of the squared feature has the biggest magnitude.</p></li>
<li><p>The idea of transforming features and creating new features is referred to as <strong>change of basis</strong>.</p></li>
</ul>
</section>
<section id="polynomial-regression-in-sklearn">
<h3>Polynomial regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code><a class="headerlink" href="#polynomial-regression-in-sklearn" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> we can add polynomial features using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html">sklearn’s PolynomialFeatures</a></p></li>
<li><p>Using this we can generate a new feature matrix consisting of all polynomial combinations of the features with degree less than or equal to a specified degree.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code> is a transformer.</p></li>
<li><p>For one-dimensional feature vector <code class="docutils literal notranslate"><span class="pre">[a]</span></code>, the augmented features with degree 2 polynomial would be: <span class="math notranslate nohighlight">\([1, a, a^2]\)</span>.</p></li>
<li><p>For two-dimensional feature vector <code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b]</span></code>, the augmented features with degree 2 polynomial would be: <span class="math notranslate nohighlight">\([1, a, b, a^2, ab, b^2]\)</span>.</p></li>
</ul>
<p>Let’s try polynomial features with degree 2 and visualize augmented features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="n">deg</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">poly_feats</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
<span class="n">X_enc</span> <span class="o">=</span> <span class="n">poly_feats</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_enc</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">poly_feats</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>x0</th>
      <th>x0^2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-3.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-2.684211</td>
      <td>7.204986</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-2.368421</td>
      <td>5.609418</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>-2.052632</td>
      <td>4.213296</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>-1.736842</td>
      <td>3.016620</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Let’s fit linear regression on the transformed data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_poly</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_poly</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_enc</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">lr_poly</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_enc</span><span class="p">)</span>
<span class="n">lr_poly</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_enc</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9270602202765702
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The model is not underfit anymore. The training score is pretty good!</p></li>
<li><p>Let’s examine the coefficients.</p></li>
</ul>
<p>We can also plot the prediction from the augmented 3-D space in the original 2-D space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_toy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5507e27137f719c17b3f6e8bdabddf6ec714af2d55f50e5acfa548d5243ebc8e.png" src="../_images/5507e27137f719c17b3f6e8bdabddf6ec714af2d55f50e5acfa548d5243ebc8e.png" />
</div>
</div>
<ul class="simple">
<li><p>Now the fit is much better compared to linear regression on the original data!</p></li>
<li><p>What’s happening here?</p></li>
<li><p>The actual linear regression model is fit in the augmented space and making the prediction in that augmented space.</p></li>
</ul>
<p>Let’s try degree=20 polynomial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deg</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">poly_feats</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">deg</span><span class="p">)</span>
<span class="n">X_enc</span> <span class="o">=</span> <span class="n">poly_feats</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_enc</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">poly_feats</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>x0</th>
      <th>x0^2</th>
      <th>x0^3</th>
      <th>x0^4</th>
      <th>x0^5</th>
      <th>x0^6</th>
      <th>x0^7</th>
      <th>x0^8</th>
      <th>x0^9</th>
      <th>...</th>
      <th>x0^11</th>
      <th>x0^12</th>
      <th>x0^13</th>
      <th>x0^14</th>
      <th>x0^15</th>
      <th>x0^16</th>
      <th>x0^17</th>
      <th>x0^18</th>
      <th>x0^19</th>
      <th>x0^20</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-3.000000</td>
      <td>9.000000</td>
      <td>-27.000000</td>
      <td>81.000000</td>
      <td>-243.000000</td>
      <td>729.000000</td>
      <td>-2187.000000</td>
      <td>6.561000e+03</td>
      <td>-1.968300e+04</td>
      <td>...</td>
      <td>-1.771470e+05</td>
      <td>5.314410e+05</td>
      <td>-1.594323e+06</td>
      <td>4.782969e+06</td>
      <td>-1.434891e+07</td>
      <td>4.304672e+07</td>
      <td>-1.291402e+08</td>
      <td>3.874205e+08</td>
      <td>-1.162261e+09</td>
      <td>3.486784e+09</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-2.684211</td>
      <td>7.204986</td>
      <td>-19.339700</td>
      <td>51.911825</td>
      <td>-139.342268</td>
      <td>374.023983</td>
      <td>-1003.959113</td>
      <td>2.694838e+03</td>
      <td>-7.233512e+03</td>
      <td>...</td>
      <td>-5.211735e+04</td>
      <td>1.398939e+05</td>
      <td>-3.755048e+05</td>
      <td>1.007934e+06</td>
      <td>-2.705507e+06</td>
      <td>7.262150e+06</td>
      <td>-1.949314e+07</td>
      <td>5.232369e+07</td>
      <td>-1.404478e+08</td>
      <td>3.769915e+08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-2.368421</td>
      <td>5.609418</td>
      <td>-13.285464</td>
      <td>31.465573</td>
      <td>-74.523727</td>
      <td>176.503563</td>
      <td>-418.034755</td>
      <td>9.900823e+02</td>
      <td>-2.344932e+03</td>
      <td>...</td>
      <td>-1.315370e+04</td>
      <td>3.115351e+04</td>
      <td>-7.378462e+04</td>
      <td>1.747531e+05</td>
      <td>-4.138888e+05</td>
      <td>9.802630e+05</td>
      <td>-2.321675e+06</td>
      <td>5.498705e+06</td>
      <td>-1.302325e+07</td>
      <td>3.084454e+07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>-2.052632</td>
      <td>4.213296</td>
      <td>-8.648345</td>
      <td>17.751867</td>
      <td>-36.438042</td>
      <td>74.793875</td>
      <td>-153.524271</td>
      <td>3.151288e+02</td>
      <td>-6.468433e+02</td>
      <td>...</td>
      <td>-2.725342e+03</td>
      <td>5.594124e+03</td>
      <td>-1.148268e+04</td>
      <td>2.356970e+04</td>
      <td>-4.837991e+04</td>
      <td>9.930614e+04</td>
      <td>-2.038389e+05</td>
      <td>4.184062e+05</td>
      <td>-8.588338e+05</td>
      <td>1.762869e+06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>-1.736842</td>
      <td>3.016620</td>
      <td>-5.239393</td>
      <td>9.099999</td>
      <td>-15.805262</td>
      <td>27.451244</td>
      <td>-47.678477</td>
      <td>8.280999e+01</td>
      <td>-1.438279e+02</td>
      <td>...</td>
      <td>-4.338741e+02</td>
      <td>7.535708e+02</td>
      <td>-1.308834e+03</td>
      <td>2.273237e+03</td>
      <td>-3.948254e+03</td>
      <td>6.857494e+03</td>
      <td>-1.191038e+04</td>
      <td>2.068646e+04</td>
      <td>-3.592911e+04</td>
      <td>6.240319e+04</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>-1.421053</td>
      <td>2.019391</td>
      <td>-2.869660</td>
      <td>4.077938</td>
      <td>-5.794965</td>
      <td>8.234950</td>
      <td>-11.702298</td>
      <td>1.662958e+01</td>
      <td>-2.363151e+01</td>
      <td>...</td>
      <td>-4.772125e+01</td>
      <td>6.781441e+01</td>
      <td>-9.636784e+01</td>
      <td>1.369438e+02</td>
      <td>-1.946043e+02</td>
      <td>2.765430e+02</td>
      <td>-3.929821e+02</td>
      <td>5.584483e+02</td>
      <td>-7.935844e+02</td>
      <td>1.127725e+03</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>-1.105263</td>
      <td>1.221607</td>
      <td>-1.350197</td>
      <td>1.492323</td>
      <td>-1.649409</td>
      <td>1.823031</td>
      <td>-2.014930</td>
      <td>2.227027e+00</td>
      <td>-2.461451e+00</td>
      <td>...</td>
      <td>-3.006925e+00</td>
      <td>3.323444e+00</td>
      <td>-3.673280e+00</td>
      <td>4.059941e+00</td>
      <td>-4.487303e+00</td>
      <td>4.959651e+00</td>
      <td>-5.481719e+00</td>
      <td>6.058742e+00</td>
      <td>-6.696505e+00</td>
      <td>7.401400e+00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>-0.789474</td>
      <td>0.623269</td>
      <td>-0.492054</td>
      <td>0.388464</td>
      <td>-0.306682</td>
      <td>0.242117</td>
      <td>-0.191145</td>
      <td>1.509042e-01</td>
      <td>-1.191349e-01</td>
      <td>...</td>
      <td>-7.425304e-02</td>
      <td>5.862082e-02</td>
      <td>-4.627960e-02</td>
      <td>3.653652e-02</td>
      <td>-2.884462e-02</td>
      <td>2.277207e-02</td>
      <td>-1.797795e-02</td>
      <td>1.419312e-02</td>
      <td>-1.120509e-02</td>
      <td>8.846127e-03</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>-0.473684</td>
      <td>0.224377</td>
      <td>-0.106284</td>
      <td>0.050345</td>
      <td>-0.023848</td>
      <td>0.011296</td>
      <td>-0.005351</td>
      <td>2.534611e-03</td>
      <td>-1.200605e-03</td>
      <td>...</td>
      <td>-2.693878e-04</td>
      <td>1.276048e-04</td>
      <td>-6.044436e-05</td>
      <td>2.863154e-05</td>
      <td>-1.356231e-05</td>
      <td>6.424252e-06</td>
      <td>-3.043067e-06</td>
      <td>1.441453e-06</td>
      <td>-6.827933e-07</td>
      <td>3.234284e-07</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>-0.157895</td>
      <td>0.024931</td>
      <td>-0.003936</td>
      <td>0.000622</td>
      <td>-0.000098</td>
      <td>0.000015</td>
      <td>-0.000002</td>
      <td>3.863147e-07</td>
      <td>-6.099706e-08</td>
      <td>...</td>
      <td>-1.520702e-09</td>
      <td>2.401109e-10</td>
      <td>-3.791224e-11</td>
      <td>5.986144e-12</td>
      <td>-9.451806e-13</td>
      <td>1.492390e-13</td>
      <td>-2.356406e-14</td>
      <td>3.720641e-15</td>
      <td>-5.874696e-16</td>
      <td>9.275836e-17</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_poly</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_poly</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_enc</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">lr_poly</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_enc</span><span class="p">)</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_toy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2ef9d7254b15c508ca63ec7aa3fdd1754f181d4141f5dbf0e0f503a502ac01c2.png" src="../_images/2ef9d7254b15c508ca63ec7aa3fdd1754f181d4141f5dbf0e0f503a502ac01c2.png" />
</div>
</div>
<ul class="simple">
<li><p>It seems like we are overfitting now.</p></li>
<li><p>The model is trying to go through every training point.</p></li>
<li><p>The model is likely to overfit on unseen data.</p></li>
<li><p>You can pick the degree of polynomial using hyperparameter optimization.</p></li>
</ul>
</section>
<section id="interim-summary">
<h3>Interim summary<a class="headerlink" href="#interim-summary" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We can make linear models more flexible by augmenting the feature space.</p></li>
<li><p>One way to do it is by applying polynomial transformations.</p></li>
<li><p>Example: Suppose <span class="math notranslate nohighlight">\(X\)</span> has only one feature, say <span class="math notranslate nohighlight">\(f_1\)</span>$</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}X = \begin{bmatrix}0.86 \\ 0.02 \\ -0.42 \end{bmatrix}\end{split}\]</div>
<ul class="simple">
<li><p>We can add a new feature <span class="math notranslate nohighlight">\(f_1^2\)</span>?</p></li>
</ul>
<ul class="simple">
<li><p>Our <span class="math notranslate nohighlight">\(Z\)</span> will have three features <span class="math notranslate nohighlight">\(f_0\)</span>, <span class="math notranslate nohighlight">\(f_1\)</span>, <span class="math notranslate nohighlight">\(f_1^2\)</span> with polynomial with degree 2.
$<span class="math notranslate nohighlight">\(Z = \begin{bmatrix}1 &amp; 0.86 &amp; 0.74\\ 1 &amp; 0.02 &amp; 0.0004\\ 1 &amp; -0.42 &amp; 0.18\\ \end{bmatrix}\)</span>$</p></li>
</ul>
<br> 
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Z\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> augmented dataset with quadratic features</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit</span></code>: We fit using <span class="math notranslate nohighlight">\(Z\)</span> and learn weights <span class="math notranslate nohighlight">\(v\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict</span></code>: When we predict, we need to apply the same transformations on the test example and add these features in the test example and predict using learned weights <span class="math notranslate nohighlight">\(v\)</span>.</p></li>
</ul>
<p><strong><span class="math notranslate nohighlight">\(\hat{y}\)</span> is still a linear function of <span class="math notranslate nohighlight">\(v\)</span> and <span class="math notranslate nohighlight">\(Z\)</span>.</strong></p>
</section>
<section id="polynomialfeatures-with-sklearn-pipelines">
<h3><code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code> with sklearn pipelines<a class="headerlink" href="#polynomialfeatures-with-sklearn-pipelines" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">degree</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">pipe_poly</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>

<span class="n">pipe_poly</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">pipe_poly</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_toy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2ef9d7254b15c508ca63ec7aa3fdd1754f181d4141f5dbf0e0f503a502ac01c2.png" src="../_images/2ef9d7254b15c508ca63ec7aa3fdd1754f181d4141f5dbf0e0f503a502ac01c2.png" />
</div>
</div>
<p>The model has learned coefficients for the transformed features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">pipe_poly</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;linearregression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pipe_poly</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;polynomialfeatures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Feature coefficients&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Feature coefficients&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>x0^7</th>
      <td>84.271533</td>
    </tr>
    <tr>
      <th>x0^11</th>
      <td>31.398818</td>
    </tr>
    <tr>
      <th>x0^6</th>
      <td>29.056499</td>
    </tr>
    <tr>
      <th>x0^12</th>
      <td>16.435514</td>
    </tr>
    <tr>
      <th>x0^2</th>
      <td>9.626527</td>
    </tr>
    <tr>
      <th>x0^8</th>
      <td>8.711761</td>
    </tr>
    <tr>
      <th>x0^3</th>
      <td>3.763840</td>
    </tr>
    <tr>
      <th>x0</th>
      <td>1.856515</td>
    </tr>
    <tr>
      <th>x0^15</th>
      <td>1.138977</td>
    </tr>
    <tr>
      <th>x0^16</th>
      <td>0.755986</td>
    </tr>
    <tr>
      <th>x0^19</th>
      <td>0.002640</td>
    </tr>
    <tr>
      <th>x0^20</th>
      <td>0.001922</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.000220</td>
    </tr>
    <tr>
      <th>x0^18</th>
      <td>-0.060286</td>
    </tr>
    <tr>
      <th>x0^17</th>
      <td>-0.085945</td>
    </tr>
    <tr>
      <th>x0^14</th>
      <td>-4.832276</td>
    </tr>
    <tr>
      <th>x0^13</th>
      <td>-7.941176</td>
    </tr>
    <tr>
      <th>x0^10</th>
      <td>-26.869921</td>
    </tr>
    <tr>
      <th>x0^4</th>
      <td>-31.828364</td>
    </tr>
    <tr>
      <th>x0^5</th>
      <td>-44.211552</td>
    </tr>
    <tr>
      <th>x0^9</th>
      <td>-70.499855</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">deg</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">pipe_poly</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="n">deg</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>
    <span class="n">pipe_poly</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">y_toy</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">pipe_poly</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_toy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_toy</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;degree=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ab244856d7c23541bb5d86ed290891ffb8491a7d8300a360ed2f340bddc20216.png" src="../_images/ab244856d7c23541bb5d86ed290891ffb8491a7d8300a360ed2f340bddc20216.png" />
</div>
</div>
<p><br><br></p>
</section>
<section id="classification-setting-non-linearly-separable-data">
<h3>Classification setting: Non-linearly separable data<a class="headerlink" href="#classification-setting-non-linearly-separable-data" title="Permalink to this heading">#</a></h3>
<p>Let’s consider this non-linearly separable 1-D data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Consider this one-dimensional classification dataset</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.4</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="c1"># plt.scatter(X[:, 0], np.zeros_like(X), c=y, s=50, edgecolors=(0, 0, 0));</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature0&quot;</span><span class="p">)</span>
<span class="c1"># plt.legend();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;Feature0&#39;)
</pre></div>
</div>
<img alt="../_images/12b1c665d7e25b5e950ee9c4a3833cee70dbabec513ed0f5da49217cf073c274.png" src="../_images/12b1c665d7e25b5e950ee9c4a3833cee70dbabec513ed0f5da49217cf073c274.png" />
</div>
</div>
<p>Can we use a linear classifier on this dataset?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear_svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">linear_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training accuracy&quot;</span><span class="p">,</span> <span class="n">linear_svm</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training accuracy 0.75
</pre></div>
</div>
</div>
</div>
<p>What if we augmented this data with polynomial with degree=2 feature?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.3315865 ],
       [ 0.71527897],
       [-1.54540029],
       [-0.00838385],
       [ 0.62133597]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span>
    <span class="mi">2</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>  <span class="c1"># Excluding the bias term for simplicity</span>
<span class="n">X_transformed</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_transformed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.33158650e+00,  1.77312262e+00],
       [ 7.15278974e-01,  5.11624011e-01],
       [-1.54540029e+00,  2.38826206e+00],
       [-8.38384993e-03,  7.02889396e-05],
       [ 6.21335974e-01,  3.86058392e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear_svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">linear_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training accuracy&quot;</span><span class="p">,</span> <span class="n">linear_svm</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">plot_orig_transformed_svc</span><span class="p">(</span><span class="n">linear_svm</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training accuracy 1.0
</pre></div>
</div>
<img alt="../_images/cb5a0bcaf1871f4f22e2f5b6c34e6e1a577a805aa0da41dddbcb9804cc027390.png" src="../_images/cb5a0bcaf1871f4f22e2f5b6c34e6e1a577a805aa0da41dddbcb9804cc027390.png" />
</div>
</div>
<p>The data is linearly separable in this new feature space!!</p>
</section>
<section id="optional-another-example-with-two-features">
<h3>(Optional) Another example with two features<a class="headerlink" href="#optional-another-example-with-two-features" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mglearn</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">centers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">2</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature 0&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/261561385f0d8ded0d1903053dd539011ef44a2b1adc8e4a6d82b6eb5be87bb2.png" src="../_images/261561385f0d8ded0d1903053dd539011ef44a2b1adc8e4a6d82b6eb5be87bb2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>

<span class="n">linear_svm</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_2d_separator</span><span class="p">(</span><span class="n">linear_svm</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">mglearn</span><span class="o">.</span><span class="n">discrete_scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature 0&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/sklearn/svm/_base.py:1225: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
</pre></div>
</div>
<img alt="../_images/bd92d05bdfe6dc534157c11ff8a9a4fad953c551cd19113ff86e44fa46c6f32d.png" src="../_images/bd92d05bdfe6dc534157c11ff8a9a4fad953c551cd19113ff86e44fa46c6f32d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add square of the second feature</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plot_mglearn_3d</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/928d57e27bcd7a45c1629075d8eb56f9451b611a53936ccba72532a0312dc0d6.png" src="../_images/928d57e27bcd7a45c1629075d8eb56f9451b611a53936ccba72532a0312dc0d6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear_svm_3d</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">XX</span><span class="p">,</span> <span class="n">YY</span> <span class="o">=</span> <span class="n">plot_svc_3d_decision_boundary</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linear_svm_3d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/sklearn/svm/_base.py:1225: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  warnings.warn(
</pre></div>
</div>
<img alt="../_images/5214681e99145076c4762171e8b40f2fcb5ff07abacd80bc76d9042e6a88f3da.png" src="../_images/5214681e99145076c4762171e8b40f2fcb5ff07abacd80bc76d9042e6a88f3da.png" />
</div>
</div>
<p>What does this linear boundary in <span class="math notranslate nohighlight">\(Z\)</span>-space correspond to <em>in the original (<span class="math notranslate nohighlight">\(X\)</span>) space</em>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plot_Z_space_boundary_in_X_space</span><span class="p">(</span><span class="n">linear_svm_3d</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2031c31e5c34d68c5b61389154f1347def09a20842a9cc0df9248e09fa4b01d3.png" src="../_images/2031c31e5c34d68c5b61389154f1347def09a20842a9cc0df9248e09fa4b01d3.png" />
</div>
</div>
<p>It’s a parabola!</p>
<p>Another example with non-linearly separable data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Paired</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/79c8a043cc6ea40b8ecbfc2faa8fb13d3f15ab3b0dc8275ca9336fc2cac1e8ea.png" src="../_images/79c8a043cc6ea40b8ecbfc2faa8fb13d3f15ab3b0dc8275ca9336fc2cac1e8ea.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_circ</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_circ</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00015933776258525434
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_circ_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>
<span class="n">lr_circ_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9669328201796121
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="feature-interactions-and-feature-crosses">
<h3>Feature interactions and feature crosses<a class="headerlink" href="#feature-interactions-and-feature-crosses" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A <strong>feature cross</strong> is a synthetic feature formed by multiplying or crossing two or more features.</p></li>
<li><p>Example:
Is the following dataset (XOR function) linearly separable?</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>$<span class="math notranslate nohighlight">\(x_1\)</span>$</p></th>
<th class="head"><p>$<span class="math notranslate nohighlight">\(x_2\)</span>$</p></th>
<th class="head"><p>target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>-1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>-1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>-1</p></td>
<td><p>-1</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>For XOR like problems, if we create a feature cross <span class="math notranslate nohighlight">\(x1x2\)</span>, the data becomes linearly separable.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>$<span class="math notranslate nohighlight">\(x_1\)</span>$</p></th>
<th class="head"><p>$<span class="math notranslate nohighlight">\(x_2\)</span>$</p></th>
<th class="head"><p>$<span class="math notranslate nohighlight">\(x_1x_2\)</span>$</p></th>
<th class="head"><p>target</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>-1</p></td>
<td><p>1</p></td>
<td><p>-1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>-1</p></td>
<td><p>-1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>-1</p></td>
<td><p>-1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
<p>Let’s look at an example with more data points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_xor</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">y_xor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_xor</span><span class="p">(</span><span class="n">X_xor</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">X_xor</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">X_xor</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_xor</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">y_xor</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Paired</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a413a4acec275e5548794f6fe8bc3dd3b07b963d4bb24e16a1f82dac625f88ba.png" src="../_images/a413a4acec275e5548794f6fe8bc3dd3b07b963d4bb24e16a1f82dac625f88ba.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LogisticRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_xor</span><span class="p">,</span> <span class="n">y_xor</span><span class="p">)</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_xor</span><span class="p">,</span> <span class="n">y_xor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.535
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe_xor</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">interaction_only</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">pipe_xor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_xor</span><span class="p">,</span> <span class="n">y_xor</span><span class="p">)</span>
<span class="n">pipe_xor</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_xor</span><span class="p">,</span> <span class="n">y_xor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.995
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pipe_xor</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;polynomialfeatures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">pipe_xor</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;logisticregression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Feature coefficient&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>-0.001828</td>
    </tr>
    <tr>
      <th>x0</th>
      <td>-0.028418</td>
    </tr>
    <tr>
      <th>x1</th>
      <td>0.130472</td>
    </tr>
    <tr>
      <th>x0 x1</th>
      <td>-5.085936</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The interaction feature has the biggest coefficient!</p>
</section>
<section id="feature-crosses-for-one-hot-encoded-features">
<h3>Feature crosses for one-hot encoded features<a class="headerlink" href="#feature-crosses-for-one-hot-encoded-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>You can think of feature crosses of one-hot-features as logical conjunctions</p></li>
<li><p>Suppose you want to predict whether you will find parking or not based on two features:</p>
<ul>
<li><p>area (possible categories: UBC campus and Rogers Arena)</p></li>
<li><p>time of the day (possible categories: 9am and 7pm)</p></li>
</ul>
</li>
<li><p>A feature cross in this case would create four new features:</p>
<ul>
<li><p>UBC campus and 9am</p></li>
<li><p>UBC campus and 7pm</p></li>
<li><p>Rogers Arena and 9am</p></li>
<li><p>Rogers Arena and 7pm.</p></li>
</ul>
</li>
<li><p>The features UBC campus and 9am on their own are not that informative but the newly created feature UBC campus and 9am or Rogers Arena and 7pm would be quite informative.</p></li>
</ul>
<ul class="simple">
<li><p>Coming up with the right combination of features requires some domain knowledge or careful examination of the data.</p></li>
<li><p>There is no easy way to support feature crosses in sklearn.</p></li>
</ul>
</section>
<section id="questions-to-consider">
<h3>Questions to consider<a class="headerlink" href="#questions-to-consider" title="Permalink to this heading">#</a></h3>
<p>How do we know what degree of polynomial to use?</p>
<ul class="simple">
<li><p>Can we plot data and see how does it look like so that we can pick polynomial with the appropriate degree?</p>
<ul>
<li><p>Plotting cannot take us much further</p></li>
<li><p>Not possible to visualize high dimensional data</p></li>
</ul>
</li>
<li><p>Can we consider one feature at a time?</p>
<ul>
<li><p>Hopeless when features interact with each other</p></li>
<li><p>There is a possibility to draw misleading conclusions when you are only looking at one feature at a time.</p></li>
</ul>
</li>
<li><p>Hyperparameter optimization</p>
<ul>
<li><p>Can be potentially very slow.</p></li>
</ul>
</li>
</ul>
</section>
<section id="problems-with-polynomial-basis">
<h3>Problems with polynomial basis<a class="headerlink" href="#problems-with-polynomial-basis" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Let <span class="math notranslate nohighlight">\(d\)</span> be the original number of features and <span class="math notranslate nohighlight">\(p\)</span> be the degree of polynomial.</p></li>
<li><p>In general, we have roughly <span class="math notranslate nohighlight">\(\mathcal{O}(d^p)\)</span> feature combinations.</p>
<ul>
<li><p>For example, for <span class="math notranslate nohighlight">\(d = 1000\)</span>, and <span class="math notranslate nohighlight">\(p = 3\)</span>, we would have around a billion new feature combinations!</p></li>
</ul>
</li>
<li><p>This is problematic!</p></li>
</ul>
</section>
<section id="how-can-we-do-this-efficiently">
<h3>How can we do this efficiently?<a class="headerlink" href="#how-can-we-do-this-efficiently" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Kernel trick</p>
<ul>
<li><p>Computationally efficient approach to map features</p></li>
<li><p>Calculate these relationships in higher dimensional space without actually carrying out the transformation.</p></li>
<li><p>Overall, saying something is a “kernel method” correspond to this idea of implicitly calculating relationships in data in higher dimensional space.</p></li>
<li><p>Then the different transformations have different names like “polynomial kernel” or “RBF kernel”</p></li>
<li><p>For details see <a class="reference external" href="https://www.youtube.com/watch?v=mba4xweShwI">this video</a> from CPSC 340.</p></li>
</ul>
</li>
<li><p>More on RBF kernel later.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="optional-recall-rbf-kernel">
<h2>(Optional) Recall RBF Kernel<a class="headerlink" href="#optional-recall-rbf-kernel" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Hard to visualize but you can think of this as a weighted nearest-neighbour.</p></li>
<li><p>During prediction, the closest examples have a lot of influence on how we classify the new example compared to the ones further away.</p></li>
<li><p>In general, for both regression/classification, you can think of RBF kernel as “smooth KNN”.</p></li>
<li><p>During test time, each training example gets to “vote” on the label of the test point and the amount of vote the <span class="math notranslate nohighlight">\(n^{th}\)</span> training example gets is proportional to the the distance between the test point and itself.</p></li>
</ul>
<section id="rbfs">
<h3>RBFs<a class="headerlink" href="#rbfs" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>What is a radial basis function (RBF)?</p>
<ul>
<li><p>A set of non-parametric bases that depend on distances to training points.</p></li>
<li><p>Non-parametric because size of basis (number of features) grows with <span class="math notranslate nohighlight">\(n\)</span>.</p></li>
</ul>
</li>
<li><p>Model gets more complicated as you get more data.</p></li>
</ul>
</section>
<section id="example-rbfs">
<h3>Example: RBFs<a class="headerlink" href="#example-rbfs" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Similar to polynomial basis, we transform <span class="math notranslate nohighlight">\(X\)</span> to <span class="math notranslate nohighlight">\(Z\)</span>.</p></li>
<li><p>Consider <span class="math notranslate nohighlight">\(X_{train}\)</span> with three examples: <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span>, and <span class="math notranslate nohighlight">\(x_3\)</span> and 2 features sand <span class="math notranslate nohighlight">\(X_{test}\)</span> with two examples: <span class="math notranslate nohighlight">\(\tilde{x_1}\)</span> and <span class="math notranslate nohighlight">\(\tilde{x_2}\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Transform } X_{train} = \begin{bmatrix} 1 &amp; 0\\ 2 &amp; 1\\ 1 &amp; 2\end{bmatrix} \text{ to } Z_{train} = \begin{bmatrix} g\lVert x_1 - x_1\rVert &amp; g\lVert x_1 - x_2\rVert &amp; g\lVert x_1 - x_3\rVert\\g\lVert x_2 - x_1\rVert &amp; g\lVert x_2 - x_2\rVert &amp; g\lVert x_2 - x_3\rVert\\g\lVert x_3 - x_1\rVert &amp; g\lVert x_3 - x_2\rVert &amp; g\lVert x_3 - x_3\rVert\end{bmatrix}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\text{Transform } X_{test} = \begin{bmatrix} 2 &amp; 1\\ 1 &amp; 1 \end{bmatrix} \text{ to } Z_{test} = \begin{bmatrix} g\lVert \tilde{x_1} - x_1\rVert &amp; g\lVert \tilde{x_1} - x_2\rVert &amp; g\lVert \tilde{x_1} - x_3\rVert\\g\lVert \tilde{x_2} - x_1\rVert &amp; g\lVert \tilde{x_2} - x_2\rVert &amp; g\lVert \tilde{x_2} - x_3\rVert\\\end{bmatrix}\end{split}\]</div>
<ul class="simple">
<li><p>We create <span class="math notranslate nohighlight">\(n\)</span> features.</p></li>
</ul>
</section>
<section id="gaussian-radial-basis-functions-gaussian-rbfs">
<h3>Gaussian Radial Basis Functions (Gaussian RBFs)<a class="headerlink" href="#gaussian-radial-basis-functions-gaussian-rbfs" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Most common <span class="math notranslate nohighlight">\(g\)</span> is Gaussian RBF: $<span class="math notranslate nohighlight">\(g(\varepsilon)=\exp\left(-\frac{\varepsilon^2}{2\sigma^2}\right)\)</span>$</p></li>
</ul>
<p><img alt="" src="../_images/RBF1.png" /></p>
<!-- <center> -->
<!-- <img src='img/RBF.png' width="700" height="700" />     -->
<!-- </center> -->
<p><a class="reference external" href="https://www.cs.ubc.ca/~schmidtm/Courses/340-F19/L13.pdf">Source</a></p>
<ul class="simple">
<li><p>So in our case:
$<span class="math notranslate nohighlight">\(g(x_i - x_j)=\exp\left(-\frac{\lVert x_i - x_j\rVert^2}{2\sigma^2}\right)\)</span>$</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma\)</span> is a hyperparameter that controls the width of the bumps.</p></li>
<li><p>We can fit least squares with different <span class="math notranslate nohighlight">\(\sigma\)</span> values</p></li>
</ul>
<section id="gaussian-rbfs-non-parametric-basis">
<h4>Gaussian RBFs (non-parametric basis)<a class="headerlink" href="#gaussian-rbfs-non-parametric-basis" title="Permalink to this heading">#</a></h4>
<p><img alt="" src="../_images/Gaussian_RBF1.png" /></p>
<!-- <img src='img/Gaussian_RBF.png' width="700" height="700" /> -->
<p><a class="reference external" href="https://www.cs.ubc.ca/~schmidtm/Courses/340-F19/L13.pdf">source</a></p>
<ul class="simple">
<li><p>How many bumps should we use?</p>
<ul>
<li><p>We use <span class="math notranslate nohighlight">\(n\)</span> bumps (non-parametric basis)</p></li>
</ul>
</li>
<li><p>Where should the bumps be centered?</p>
<ul>
<li><p>Each bump is centered on one training example <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
</ul>
</li>
<li><p>How high should the bumps go?</p>
<ul>
<li><p>Fitting regression weights <span class="math notranslate nohighlight">\(w\)</span> gives us the heights (and signs).</p></li>
</ul>
</li>
<li><p>How wide should the bumps be?</p>
<ul>
<li><p>The width is a hyper-parameter (narrow bumps = complicated model)</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/Gaussian_RBF1.png" /></p>
<!-- <center> -->
<!-- <img src='img/Gaussian_RBF.png' width="700" height="700" /> -->
<!-- </center> -->
<p><a class="reference external" href="https://www.cs.ubc.ca/~schmidtm/Courses/340-F19/L13.pdf">source</a></p>
<ul class="simple">
<li><p>Enough bumps can approximate any continuous function to arbitrary precision.</p></li>
<li><p>But with <span class="math notranslate nohighlight">\(n\)</span> data points RBFs have <span class="math notranslate nohighlight">\(n\)</span> features</p>
<ul>
<li><p>How do we avoid overfitting with this huge number of features?</p></li>
<li><p>We regularize <span class="math notranslate nohighlight">\(w\)</span> (coming up in two weeks) and use validation error to choose <span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="interpretation-of-gamma-in-svm-rbf">
<h3>Interpretation of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> in SVM RBF<a class="headerlink" href="#interpretation-of-gamma-in-svm-rbf" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gamma</span></code> controls the complexity (fundamental trade-off).</p>
<ul>
<li><p>larger <code class="docutils literal notranslate"><span class="pre">gamma</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> more complex</p></li>
<li><p>smaller <code class="docutils literal notranslate"><span class="pre">gamma</span></code> <span class="math notranslate nohighlight">\(\rightarrow\)</span> less complex</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">gamma</span></code> hyperparameter in SVC is related to <span class="math notranslate nohighlight">\(\sigma\)</span> in Gaussian RBF.</p></li>
<li><p>You can think of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> as the inverse width of the “bumps”</p>
<ul>
<li><p>Larger <code class="docutils literal notranslate"><span class="pre">gamma</span></code> means narrower peaks.</p></li>
<li><p>Narrower peaks means more complex model.</p></li>
</ul>
</li>
</ul>
<div class="math notranslate nohighlight">
\[g(x_i - x_j)=\exp\left(-\frac{\lVert x_i - x_j\rVert^2}{2\sigma^2}\right)\]</div>
</section>
<section id="constructing-gaussian-rbf-with-x-and-sigma">
<h3>Constructing Gaussian RBF with <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span><a class="headerlink" href="#constructing-gaussian-rbf-with-x-and-sigma" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span>
        <span class="n">Z</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">i2</span><span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gaussian-rbfs-prediction">
<h3>Gaussian RBFs: Prediction<a class="headerlink" href="#gaussian-rbfs-prediction" title="Permalink to this heading">#</a></h3>
<ul>
<li><p>Given a test example <span class="math notranslate nohighlight">\(\tilde{x_i}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\hat{y_i} = w_1 \exp\left(\frac{-\lVert \tilde{x_i} - x_1\rVert^2}{2\sigma^2}\right) +  w_2 \exp\left(\frac{-\lVert \tilde{x_i} - x_2\rVert^2}{2\sigma^2}\right) + \dots + w_n \exp\left(\frac{-\lVert \tilde{x_i} - x_n\rVert^2}{2\sigma^2}\right)
    = \sum_{j = 1}^n w_j \exp\left(\frac{-\lVert \tilde{x_i} - x_j\rVert^2}{2\sigma^2}\right) \]</div>
</li>
<li><p>Expensive at test time: needs distance to all training examples.</p></li>
</ul>
</section>
<section id="rbf-with-regulariation-and-optimized-sigma-and-lambda">
<h3>RBF with regulariation and optimized <span class="math notranslate nohighlight">\(sigma\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span><a class="headerlink" href="#rbf-with-regulariation-and-optimized-sigma-and-lambda" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A model that is hard to beat:</p>
<ul>
<li><p>RBF basis with L2-regularization and cross-validation to choose <span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
<li><p>Flexible non-parametric basis, magic of regularization, and tuning for test error</p></li>
</ul>
</li>
<li><p>For each value of <span class="math notranslate nohighlight">\(\lambda\)</span> and <span class="math notranslate nohighlight">\(sigma\)</span></p>
<ul>
<li><p>Compute <span class="math notranslate nohighlight">\(Z\)</span> on training data</p></li>
<li><p>Compute best weights <span class="math notranslate nohighlight">\(V\)</span> using least squares</p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(\tilde{Z}\)</span> on validation set (using train set distances)</p></li>
<li><p>Make predictions <span class="math notranslate nohighlight">\(\hat{y} = \tilde{Z}v\)</span></p></li>
<li><p>Compute validation error</p></li>
</ul>
</li>
</ul>
<section id="using-rbf-with-least-squares-kernelridge-optional">
<h4>Using RBF with least squares: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.kernel_ridge.KernelRidge.html">KernelRidge</a> (optional)<a class="headerlink" href="#using-rbf-with-least-squares-kernelridge-optional" title="Permalink to this heading">#</a></h4>
<blockquote>
<div><p>sklearn.kernel_ridge.KernelRidge(alpha=1, kernel=’linear’, gamma=None, degree=3, coef0=1, kernel_params=None)</p>
</div></blockquote>
<blockquote>
<div><p>Kernel ridge regression.
Kernel ridge regression (KRR) combines ridge regression (linear least squares with l2-norm regularization) with the kernel trick. It thus learns a linear function in the space induced by the respective kernel and the data. For non-linear kernels, this corresponds to a non-linear function in the original space.</p>
</div></blockquote>
<blockquote>
<div><p>The form of the model learned by KRR is identical to support vector regression (SVR). However, different loss functions are used: KRR uses squared error loss while support vector regression uses epsilon-insensitive loss, both combined with l2 regularization. In contrast to SVR, fitting a KRR model can be done in closed-form and is typically faster for medium-sized datasets. On the other hand, the learned model is non-sparse and thus slower than SVR, which learns a sparse model for epsilon &gt; 0, at prediction-time.</p>
</div></blockquote>
<p><br><br><br><br></p>
</section>
</section>
<section id="id1">
<h3>❓❓ Questions for you<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
</section>
<section id="iclicker-exercise-3-2">
<h3>iClicker Exercise 3.2<a class="headerlink" href="#iclicker-exercise-3-2" title="Permalink to this heading">#</a></h3>
<p><strong>iClicker cloud join link: https://join.iclicker.com/C0P55</strong></p>
<p><strong>Select all of the following statements which are TRUE.</strong></p>
<ul class="simple">
<li><p>(A) Suppose we add quadratic features to dataset <span class="math notranslate nohighlight">\(X\)</span> and the augmented dataset is <span class="math notranslate nohighlight">\(Z\)</span>. Fitting linear regression on <span class="math notranslate nohighlight">\(Z\)</span> would learn a linear function of <span class="math notranslate nohighlight">\(Z\)</span>.</p></li>
<li><p>(B) The least squares loss function shown below is independent of the bias term (the <span class="math notranslate nohighlight">\(y\)</span> intercept).</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ J(w) = \sum_{i=1}^{n}{(w^Tx_i - y_i)^2}\]</div>
<ul class="simple">
<li><p>(C) If you get the same validation error with polynomials of degrees <span class="math notranslate nohighlight">\(d\)</span> and <span class="math notranslate nohighlight">\(d+4\)</span>, it is a better to pick the polynomial of degree <span class="math notranslate nohighlight">\(d\)</span>.</p></li>
<li><p>(D) If you are given a large dataset with 1000 features, it’s a good idea to start simple and work with one or two features in order to verify your intuitions.</p></li>
<li><p>(E) Suppose you apply polynomial transformations with degree 3 polynomial during training. During prediction time on the test set, you must calculate degree three polynomial features of the given feature vector in order to get predictions.</p></li>
</ul>
<p><strong>V’s answers: (A), (C), (D), (E)</strong></p>
<p><br><br><br><br></p>
</section>
</section>
<section id="break-5-min">
<h2>Break (5 min)<a class="headerlink" href="#break-5-min" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="../_images/eva-coffee.png" /></p>
<p><br><br></p>
<section id="demo-of-feature-engineering-with-numeric-features">
<h3>Demo of feature engineering with numeric features<a class="headerlink" href="#demo-of-feature-engineering-with-numeric-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Remember the <a class="reference external" href="https://www.kaggle.com/datasets/camnugent/california-housing-prices">California housing dataset</a> we used in DSCI 571?</p></li>
<li><p>The prediction task is predicting <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code> for a given property.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/california_housing.csv&quot;</span><span class="p">)</span>
<span class="n">housing_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-122.23</td>
      <td>37.88</td>
      <td>41.0</td>
      <td>880.0</td>
      <td>129.0</td>
      <td>322.0</td>
      <td>126.0</td>
      <td>8.3252</td>
      <td>452600.0</td>
      <td>NEAR BAY</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-122.22</td>
      <td>37.86</td>
      <td>21.0</td>
      <td>7099.0</td>
      <td>1106.0</td>
      <td>2401.0</td>
      <td>1138.0</td>
      <td>8.3014</td>
      <td>358500.0</td>
      <td>NEAR BAY</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-122.24</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1467.0</td>
      <td>190.0</td>
      <td>496.0</td>
      <td>177.0</td>
      <td>7.2574</td>
      <td>352100.0</td>
      <td>NEAR BAY</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1274.0</td>
      <td>235.0</td>
      <td>558.0</td>
      <td>219.0</td>
      <td>5.6431</td>
      <td>341300.0</td>
      <td>NEAR BAY</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1627.0</td>
      <td>280.0</td>
      <td>565.0</td>
      <td>259.0</td>
      <td>3.8462</td>
      <td>342200.0</td>
      <td>NEAR BAY</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 20640 entries, 0 to 20639
Data columns (total 10 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           20640 non-null  float64
 1   latitude            20640 non-null  float64
 2   housing_median_age  20640 non-null  float64
 3   total_rooms         20640 non-null  float64
 4   total_bedrooms      20433 non-null  float64
 5   population          20640 non-null  float64
 6   households          20640 non-null  float64
 7   median_income       20640 non-null  float64
 8   median_house_value  20640 non-null  float64
 9   ocean_proximity     20640 non-null  object 
dtypes: float64(9), object(1)
memory usage: 1.6+ MB
</pre></div>
</div>
</div>
</div>
<p>Suppose we decide to train <code class="docutils literal notranslate"><span class="pre">ridge</span></code> model on this dataset.</p>
<ul class="simple">
<li><p>What would happen if you train a model without applying any transformation on the categorical features ocean_proximity?</p>
<ul>
<li><p>Error!! A linear model requires all features in a numeric form.</p></li>
</ul>
</li>
<li><p>What would happen if we apply OHE on <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> but we do not scale the features?</p>
<ul>
<li><p>No syntax error. But the model results are likely to be poor.</p></li>
</ul>
</li>
<li><p>Do we need to apply any other transformations on this data?</p></li>
</ul>
<p>In this section, we will look into some common ways to do feature engineering for numeric or categorical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">housing_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We have total rooms and the number of households in the neighbourhood. How about creating rooms_per_household feature using this information?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rooms_per_household</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9950</th>
      <td>-122.33</td>
      <td>38.38</td>
      <td>28.0</td>
      <td>1020.0</td>
      <td>169.0</td>
      <td>504.0</td>
      <td>164.0</td>
      <td>4.5694</td>
      <td>287500.0</td>
      <td>INLAND</td>
      <td>6.219512</td>
    </tr>
    <tr>
      <th>3547</th>
      <td>-118.60</td>
      <td>34.26</td>
      <td>18.0</td>
      <td>6154.0</td>
      <td>1070.0</td>
      <td>3010.0</td>
      <td>1034.0</td>
      <td>5.6392</td>
      <td>271500.0</td>
      <td>&lt;1H OCEAN</td>
      <td>5.951644</td>
    </tr>
    <tr>
      <th>4448</th>
      <td>-118.21</td>
      <td>34.07</td>
      <td>47.0</td>
      <td>1346.0</td>
      <td>383.0</td>
      <td>1452.0</td>
      <td>371.0</td>
      <td>1.7292</td>
      <td>191700.0</td>
      <td>&lt;1H OCEAN</td>
      <td>3.628032</td>
    </tr>
    <tr>
      <th>6984</th>
      <td>-118.02</td>
      <td>33.96</td>
      <td>36.0</td>
      <td>2071.0</td>
      <td>398.0</td>
      <td>988.0</td>
      <td>404.0</td>
      <td>4.6226</td>
      <td>219700.0</td>
      <td>&lt;1H OCEAN</td>
      <td>5.126238</td>
    </tr>
    <tr>
      <th>4432</th>
      <td>-118.20</td>
      <td>34.08</td>
      <td>49.0</td>
      <td>1320.0</td>
      <td>309.0</td>
      <td>1405.0</td>
      <td>328.0</td>
      <td>2.4375</td>
      <td>114000.0</td>
      <td>&lt;1H OCEAN</td>
      <td>4.024390</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7763</th>
      <td>-118.10</td>
      <td>33.91</td>
      <td>36.0</td>
      <td>726.0</td>
      <td>NaN</td>
      <td>490.0</td>
      <td>130.0</td>
      <td>3.6389</td>
      <td>167600.0</td>
      <td>&lt;1H OCEAN</td>
      <td>5.584615</td>
    </tr>
    <tr>
      <th>15377</th>
      <td>-117.24</td>
      <td>33.37</td>
      <td>14.0</td>
      <td>4687.0</td>
      <td>793.0</td>
      <td>2436.0</td>
      <td>779.0</td>
      <td>4.5391</td>
      <td>180900.0</td>
      <td>&lt;1H OCEAN</td>
      <td>6.016688</td>
    </tr>
    <tr>
      <th>17730</th>
      <td>-121.76</td>
      <td>37.33</td>
      <td>5.0</td>
      <td>4153.0</td>
      <td>719.0</td>
      <td>2435.0</td>
      <td>697.0</td>
      <td>5.6306</td>
      <td>286200.0</td>
      <td>&lt;1H OCEAN</td>
      <td>5.958393</td>
    </tr>
    <tr>
      <th>15725</th>
      <td>-122.44</td>
      <td>37.78</td>
      <td>44.0</td>
      <td>1545.0</td>
      <td>334.0</td>
      <td>561.0</td>
      <td>326.0</td>
      <td>3.8750</td>
      <td>412500.0</td>
      <td>NEAR BAY</td>
      <td>4.739264</td>
    </tr>
    <tr>
      <th>19966</th>
      <td>-119.08</td>
      <td>36.21</td>
      <td>20.0</td>
      <td>1911.0</td>
      <td>389.0</td>
      <td>1241.0</td>
      <td>348.0</td>
      <td>2.5156</td>
      <td>59300.0</td>
      <td>INLAND</td>
      <td>5.491379</td>
    </tr>
  </tbody>
</table>
<p>16512 rows × 11 columns</p>
</div></div></div>
</div>
<p>Let’s start simple. Imagine that we only three features: <code class="docutils literal notranslate"><span class="pre">longitude</span></code>, <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, and our newly created <code class="docutils literal notranslate"><span class="pre">rooms_per_household</span></code> feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_housing</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">]]</span>
<span class="n">y_train_housing</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>

<span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">]</span>

<span class="n">preprocessor1</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="n">numeric_feats</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_1</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor1</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_1</span><span class="p">,</span> <span class="n">X_train_housing</span><span class="p">,</span> <span class="n">y_train_housing</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.005102</td>
      <td>0.001189</td>
      <td>0.280028</td>
      <td>0.311769</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.002480</td>
      <td>0.000848</td>
      <td>0.325319</td>
      <td>0.300464</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.002208</td>
      <td>0.000880</td>
      <td>0.317277</td>
      <td>0.301952</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.002187</td>
      <td>0.000890</td>
      <td>0.316798</td>
      <td>0.303004</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.002228</td>
      <td>0.000933</td>
      <td>0.260258</td>
      <td>0.314840</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The scores are not great.</p></li>
<li><p>Let’s look at the distribution of the longitude and latitude features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of latitude feature&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b4abc1ca508ec63e5d22e07976da474831add072dd931148aac061fba10b16e7.png" src="../_images/b4abc1ca508ec63e5d22e07976da474831add072dd931148aac061fba10b16e7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of latitude feature&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2246440d70486a1cdfd22b1a547626f112737bb396a4336c021dd683a41ee431.png" src="../_images/2246440d70486a1cdfd22b1a547626f112737bb396a4336c021dd683a41ee431.png" />
</div>
</div>
<ul class="simple">
<li><p>Suppose you are planning to build a linear model for housing price prediction.</p></li>
<li><p>If we think longitude is a good feature for prediction, does it makes sense to use the floating point representation of this feature that’s given to us?</p></li>
<li><p>Remember that linear models can capture only linear relationships.</p></li>
</ul>
<ul class="simple">
<li><p>How about discretizing latitude and longitude features and putting them into buckets?</p></li>
<li><p>This process of transforming numeric features into categorical features is called bucketing or binning.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> you can do this using <code class="docutils literal notranslate"><span class="pre">KBinsDiscretizer</span></code> transformer.</p></li>
<li><p>Let’s examine whether we get better results with binning.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>

<span class="n">discretization_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
<span class="n">numeric_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rooms_per_household&quot;</span><span class="p">]</span>

<span class="n">preprocessor2</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s2">&quot;onehot&quot;</span><span class="p">),</span> <span class="n">discretization_feats</span><span class="p">),</span>
    <span class="p">(</span><span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(),</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="n">numeric_feats</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_2</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor2</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_2</span><span class="p">,</span> <span class="n">X_train_housing</span><span class="p">,</span> <span class="n">y_train_housing</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.015637</td>
      <td>0.002666</td>
      <td>0.441442</td>
      <td>0.456418</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.010789</td>
      <td>0.002345</td>
      <td>0.469554</td>
      <td>0.446215</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.010230</td>
      <td>0.002478</td>
      <td>0.479166</td>
      <td>0.446868</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.009855</td>
      <td>0.002336</td>
      <td>0.450818</td>
      <td>0.453366</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.009889</td>
      <td>0.002189</td>
      <td>0.388175</td>
      <td>0.467627</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The results are better with binned features. Let’s examine how do these binned features look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_housing</span><span class="p">,</span> <span class="n">y_train_housing</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                                  KBinsDiscretizer(n_bins=20),
                                                  [&#x27;latitude&#x27;, &#x27;longitude&#x27;]),
                                                 (&#x27;pipeline&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;rooms_per_household&#x27;])])),
                (&#x27;ridge&#x27;, Ridge())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                                  KBinsDiscretizer(n_bins=20),
                                                  [&#x27;latitude&#x27;, &#x27;longitude&#x27;]),
                                                 (&#x27;pipeline&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;rooms_per_household&#x27;])])),
                (&#x27;ridge&#x27;, Ridge())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                 KBinsDiscretizer(n_bins=20),
                                 [&#x27;latitude&#x27;, &#x27;longitude&#x27;]),
                                (&#x27;pipeline&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer()),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;rooms_per_household&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">kbinsdiscretizer</label><div class="sk-toggleable__content"><pre>[&#x27;latitude&#x27;, &#x27;longitude&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">KBinsDiscretizer</label><div class="sk-toggleable__content"><pre>KBinsDiscretizer(n_bins=20)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">pipeline</label><div class="sk-toggleable__content"><pre>[&#x27;rooms_per_household&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">preprocessor2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_housing</span><span class="p">)</span><span class="o">.</span><span class="n">todense</span><span class="p">(),</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">preprocessor2</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kbinsdiscretizer__latitude_0.0</th>
      <th>kbinsdiscretizer__latitude_1.0</th>
      <th>kbinsdiscretizer__latitude_2.0</th>
      <th>kbinsdiscretizer__latitude_3.0</th>
      <th>kbinsdiscretizer__latitude_4.0</th>
      <th>kbinsdiscretizer__latitude_5.0</th>
      <th>kbinsdiscretizer__latitude_6.0</th>
      <th>kbinsdiscretizer__latitude_7.0</th>
      <th>kbinsdiscretizer__latitude_8.0</th>
      <th>kbinsdiscretizer__latitude_9.0</th>
      <th>...</th>
      <th>kbinsdiscretizer__longitude_11.0</th>
      <th>kbinsdiscretizer__longitude_12.0</th>
      <th>kbinsdiscretizer__longitude_13.0</th>
      <th>kbinsdiscretizer__longitude_14.0</th>
      <th>kbinsdiscretizer__longitude_15.0</th>
      <th>kbinsdiscretizer__longitude_16.0</th>
      <th>kbinsdiscretizer__longitude_17.0</th>
      <th>kbinsdiscretizer__longitude_18.0</th>
      <th>kbinsdiscretizer__longitude_19.0</th>
      <th>pipeline__rooms_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.316164</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.209903</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.711852</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.117528</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.554621</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16507</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.064307</td>
    </tr>
    <tr>
      <th>16508</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.235706</td>
    </tr>
    <tr>
      <th>16509</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.212581</td>
    </tr>
    <tr>
      <th>16510</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.271037</td>
    </tr>
    <tr>
      <th>16511</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.027321</td>
    </tr>
  </tbody>
</table>
<p>16512 rows × 41 columns</p>
</div></div></div>
</div>
<p>How about discretizing all three features?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>

<span class="n">discretization_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">]</span>

<span class="n">preprocessor3</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s2">&quot;onehot&quot;</span><span class="p">),</span> <span class="n">discretization_feats</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_3</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor3</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">cross_validate</span><span class="p">(</span><span class="n">lr_3</span><span class="p">,</span> <span class="n">X_train_housing</span><span class="p">,</span> <span class="n">y_train_housing</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.010873</td>
      <td>0.002158</td>
      <td>0.590610</td>
      <td>0.571969</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.010465</td>
      <td>0.002116</td>
      <td>0.575886</td>
      <td>0.570473</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.011467</td>
      <td>0.002253</td>
      <td>0.579108</td>
      <td>0.573541</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.010105</td>
      <td>0.001971</td>
      <td>0.571495</td>
      <td>0.574259</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.010333</td>
      <td>0.002268</td>
      <td>0.541501</td>
      <td>0.581687</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>The results have improved further!!</p></li>
<li><p>Let’s examine the coefficients</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_housing</span><span class="p">,</span> <span class="n">y_train_housing</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;background-color: white;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                                  KBinsDiscretizer(n_bins=20),
                                                  [&#x27;latitude&#x27;, &#x27;longitude&#x27;,
                                                   &#x27;rooms_per_household&#x27;])])),
                (&#x27;ridge&#x27;, Ridge())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                                  KBinsDiscretizer(n_bins=20),
                                                  [&#x27;latitude&#x27;, &#x27;longitude&#x27;,
                                                   &#x27;rooms_per_household&#x27;])])),
                (&#x27;ridge&#x27;, Ridge())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;kbinsdiscretizer&#x27;,
                                 KBinsDiscretizer(n_bins=20),
                                 [&#x27;latitude&#x27;, &#x27;longitude&#x27;,
                                  &#x27;rooms_per_household&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">kbinsdiscretizer</label><div class="sk-toggleable__content"><pre>[&#x27;latitude&#x27;, &#x27;longitude&#x27;, &#x27;rooms_per_household&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">KBinsDiscretizer</label><div class="sk-toggleable__content"><pre>KBinsDiscretizer(n_bins=20)</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_names</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">lr_3</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;columntransformer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;kbinsdiscretizer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_3</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(60,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">lr_3</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;ridge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;coefficient&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;coefficient&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">coefs_df</span><span class="o">.</span><span class="n">head</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;bound method NDFrame.head of                             coefficient
longitude_1.0             211264.741526
latitude_1.0              205072.700578
latitude_0.0              201872.963204
longitude_0.0             190382.307281
longitude_2.0             160226.705422
longitude_3.0             157170.570627
latitude_2.0              154016.104655
rooms_per_household_19.0  138446.914059
latitude_8.0              135312.891136
longitude_4.0             132299.492558
latitude_7.0              124997.893455
latitude_3.0              118555.428435
longitude_5.0             116178.110119
rooms_per_household_18.0  102055.752443
longitude_6.0              96570.932606
latitude_4.0               92839.285885
latitude_6.0               90957.852350
latitude_9.0               71151.812511
rooms_per_household_17.0   70487.600832
latitude_5.0               69460.010604
longitude_10.0             52387.931534
rooms_per_household_16.0   44318.361075
rooms_per_household_15.0   31461.590554
longitude_7.0              25695.177065
latitude_10.0              20272.013164
rooms_per_household_14.0   16466.784005
rooms_per_household_13.0    9355.137662
longitude_8.0               6379.905443
rooms_per_household_12.0    1851.911387
rooms_per_household_11.0  -12173.744559
longitude_9.0             -14485.569105
rooms_per_household_10.0  -16630.179605
rooms_per_household_9.0   -19582.738886
longitude_11.0            -22826.368243
rooms_per_household_8.0   -26908.900187
rooms_per_household_7.0   -30572.917476
rooms_per_household_6.0   -32727.412466
rooms_per_household_4.0   -40703.331515
rooms_per_household_3.0   -42079.021099
rooms_per_household_5.0   -43463.598682
rooms_per_household_2.0   -47601.049038
rooms_per_household_0.0   -50857.281189
rooms_per_household_1.0   -51143.877316
latitude_13.0             -57455.320993
longitude_14.0            -70996.211314
longitude_13.0            -89279.126781
longitude_12.0            -90638.927965
latitude_11.0            -100372.149421
longitude_15.0           -105073.921333
latitude_12.0            -111471.133870
latitude_14.0            -114773.573743
latitude_15.0            -116412.142564
longitude_16.0           -119542.396969
latitude_16.0            -140126.669111
longitude_17.0           -174828.915100
latitude_18.0            -185916.174811
latitude_17.0            -195559.834276
longitude_18.0           -205153.346778
longitude_19.0           -255731.090593
latitude_19.0            -262421.957186&gt;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Does it make sense to take feature crosses in this context?</p></li>
<li><p>What information would they encode?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="feature-engineering-for-text-data">
<h2>Feature engineering for text data<a class="headerlink" href="#feature-engineering-for-text-data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Feature engineering is very relevant in the context of “structured” data such as text data or image data.</p></li>
<li><p>We can extract important information using human knowledge and incorporate it into our models.</p></li>
<li><p>So it’s hard to talk about general methods for feature engineering.</p></li>
<li><p>In the lab you’ll be carrying out feature engineering on text data.</p></li>
<li><p>Let’s look at an example of feature engineering for text data.</p></li>
</ul>
<p>We will be using <a class="reference external" href="https://www.kaggle.com/code/kerneler/starter-covid-19-nlp-text-d3a3baa6-e/data">Covid tweets</a> dataset for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/Corona_NLP_test.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Sentiment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Negative              1041
Positive               947
Neutral                619
Extremely Positive     599
Extremely Negative     592
Name: Sentiment, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>UserName</th>
      <th>ScreenName</th>
      <th>Location</th>
      <th>TweetAt</th>
      <th>OriginalTweet</th>
      <th>Sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1927</th>
      <td>1928</td>
      <td>46880</td>
      <td>Seattle, WA</td>
      <td>13-03-2020</td>
      <td>While I don't like all of Amazon's choices, to...</td>
      <td>Positive</td>
    </tr>
    <tr>
      <th>1068</th>
      <td>1069</td>
      <td>46021</td>
      <td>NaN</td>
      <td>13-03-2020</td>
      <td>Me: shit buckets, its time to do the weekly s...</td>
      <td>Negative</td>
    </tr>
    <tr>
      <th>803</th>
      <td>804</td>
      <td>45756</td>
      <td>The Outer Limits</td>
      <td>12-03-2020</td>
      <td>@SecPompeo @realDonaldTrump You mean the plan ...</td>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>2846</th>
      <td>2847</td>
      <td>47799</td>
      <td>Flagstaff, AZ</td>
      <td>15-03-2020</td>
      <td>@lauvagrande People who are sick arent panic ...</td>
      <td>Extremely Negative</td>
    </tr>
    <tr>
      <th>3768</th>
      <td>3769</td>
      <td>48721</td>
      <td>Montreal, Canada</td>
      <td>16-03-2020</td>
      <td>Coronavirus Panic: Toilet Paper Is the People...</td>
      <td>Negative</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>1123</td>
      <td>46075</td>
      <td>NaN</td>
      <td>13-03-2020</td>
      <td>Photos of our local grocery store shelveswher...</td>
      <td>Extremely Positive</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>1347</td>
      <td>46299</td>
      <td>Toronto</td>
      <td>13-03-2020</td>
      <td>Just went to the the grocery store (Highland F...</td>
      <td>Positive</td>
    </tr>
    <tr>
      <th>3454</th>
      <td>3455</td>
      <td>48407</td>
      <td>Houston, TX</td>
      <td>16-03-2020</td>
      <td>Real talk though. Am I the only one spending h...</td>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>3437</th>
      <td>3438</td>
      <td>48390</td>
      <td>Washington, DC</td>
      <td>16-03-2020</td>
      <td>The supermarket business is booming! #COVID2019</td>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>3582</th>
      <td>3583</td>
      <td>48535</td>
      <td>St James' Park, Newcastle</td>
      <td>16-03-2020</td>
      <td>Evening All Here s the story on the and the im...</td>
      <td>Positive</td>
    </tr>
  </tbody>
</table>
<p>3038 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;UserName&#39;, &#39;ScreenName&#39;, &#39;Location&#39;, &#39;TweetAt&#39;, &#39;OriginalTweet&#39;,
       &#39;Sentiment&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>United States                     63
London, England                   37
Los Angeles, CA                   30
New York, NY                      29
Washington, DC                    29
                                  ..
Suburb of Chicago                  1
philippines                        1
Dont ask for freedom, take it.     1
Windsor Heights, IA                1
St James&#39; Park, Newcastle          1
Name: Location, Length: 1441, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]],</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;Sentiment&quot;</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]],</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;Sentiment&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Negative              852
Positive              743
Neutral               501
Extremely Negative    472
Extremely Positive    470
Name: Sentiment, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scoring_metrics</span> <span class="o">=</span> <span class="s2">&quot;accuracy&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_std_cross_val_scores</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns mean and std of cross validation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model :</span>
<span class="sd">        scikit-learn model</span>
<span class="sd">    X_train : numpy array or pandas DataFrame</span>
<span class="sd">        X in the training data</span>
<span class="sd">    y_train :</span>
<span class="sd">        y in the training data</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">        pandas Series with mean scores from cross_validation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">mean_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">std_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">out_col</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_scores</span><span class="p">)):</span>
        <span class="n">out_col</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;%0.3f (+/- %0.3f)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean_scores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">std_scores</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">out_col</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mean_scores</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="dummy-classifier">
<h3>Dummy classifier<a class="headerlink" href="#dummy-classifier" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>

<span class="n">dummy</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;dummy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metrics</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.280 (+/- 0.001)</td>
      <td>0.280 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="bag-of-words-model">
<h3>Bag-of-words model<a class="headerlink" href="#bag-of-words-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">),</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;logistic regression&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">],</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metrics</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.280 (+/- 0.001)</td>
      <td>0.280 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.477 (+/- 0.024)</td>
      <td>0.007 (+/- 0.000)</td>
      <td>0.413 (+/- 0.011)</td>
      <td>0.999 (+/- 0.000)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="is-it-possible-to-further-improve-the-scores">
<h3>Is it possible to further improve the scores?<a class="headerlink" href="#is-it-possible-to-further-improve-the-scores" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>How about adding new features based on our intuitions? Let’s extract our own features that might be useful for this prediction task. In other words, let’s carry out <strong>feature engineering</strong>.</p></li>
<li><p>The code below adds some very basic length-related and sentiment features. We will be using a popular library called <code class="docutils literal notranslate"><span class="pre">nltk</span></code> for this exercise. If you have successfully created the course <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment on your machine, you should already have this package in the environment.</p></li>
</ul>
<ul class="simple">
<li><p>How do we extract interesting information from text?</p></li>
<li><p>We use <strong>pre-trained models</strong>!</p></li>
</ul>
<ul class="simple">
<li><p>A couple of popular libraries which include such pre-trained models.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nltk</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">anaconda</span> <span class="n">nltk</span> 
</pre></div>
</div>
<ul class="simple">
<li><p>spaCy</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">spacy</span>
</pre></div>
</div>
<p>For emoji support:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">spacymoji</span>
</pre></div>
</div>
<ul class="simple">
<li><p>You also need to download the language model which contains all the pre-trained models. For that run the following in your course <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment or here.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>

<span class="c1"># !python -m spacy download en_core_web_md</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>

<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;punkt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package punkt to /Users/kvarada/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;vader_lexicon&quot;</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;punkt&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltk.sentiment.vader</span> <span class="kn">import</span> <span class="n">SentimentIntensityAnalyzer</span>

<span class="n">sid</span> <span class="o">=</span> <span class="n">SentimentIntensityAnalyzer</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[nltk_data] Downloading package vader_lexicon to
[nltk_data]     /Users/kvarada/nltk_data...
[nltk_data]   Package vader_lexicon is already up-to-date!
[nltk_data] Downloading package punkt to /Users/kvarada/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;MDS students are smart, sweet, and funny.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;neg&#39;: 0.0, &#39;neu&#39;: 0.317, &#39;pos&#39;: 0.683, &#39;compound&#39;: 0.8225}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;MDS students are tired because of all the hard work they have been doing.&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;neg&#39;: 0.264, &#39;neu&#39;: 0.736, &#39;pos&#39;: 0.0, &#39;compound&#39;: -0.5106}
</pre></div>
</div>
</div>
</div>
</section>
<section id="spacy">
<h3><a class="reference external" href="https://spacy.io/">spaCy</a><a class="headerlink" href="#spacy" title="Permalink to this heading">#</a></h3>
<p>A useful package for text processing and feature extraction</p>
<ul class="simple">
<li><p>Active development: https://github.com/explosion/spaCy</p></li>
<li><p>Interactive lessons by Ines Montani: https://course.spacy.io/en/</p></li>
<li><p>Good documentation, easy to use, and customizable.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">en_core_web_md</span>  <span class="c1"># pre-trained model</span>
<span class="kn">import</span> <span class="nn">spacy</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">en_core_web_md</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Dolly Parton is a gift to us all. </span>
<span class="s2">From writing all-time great songs like “Jolene” and “I Will Always Love You”, </span>
<span class="s2">to great performances in films like 9 to 5, to helping fund a COVID-19 vaccine, </span>
<span class="s2">she’s given us so much. Now, Netflix bring us Dolly Parton’s Christmas on the Square, </span>
<span class="s2">an original musical that stars Christine Baranski as a Scrooge-like landowner </span>
<span class="s2">who threatens to evict an entire town on Christmas Eve to make room for a new mall. </span>
<span class="s2">Directed and choreographed by the legendary Debbie Allen and counting Jennifer Lewis </span>
<span class="s2">and Parton herself amongst its cast, Christmas on the Square seems like the perfect movie</span>
<span class="s2">to save Christmas 2020. 😻 👍🏿&quot;&quot;&quot;</span>

<span class="c1"># [Adapted from here.](https://thepopbreak.com/2020/11/22/dolly-partons-christmas-on-the-square-review-not-quite-a-christmas-miracle/)</span>
</pre></div>
</div>
</div>
</div>
<p>Spacy extracts all interesting information from text with this call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at part-of-speech tags.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([(</span><span class="n">token</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span><span class="p">)</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">][:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(Dolly, &#39;PROPN&#39;), (Parton, &#39;PROPN&#39;), (is, &#39;AUX&#39;), (a, &#39;DET&#39;), (gift, &#39;NOUN&#39;), (to, &#39;ADP&#39;), (us, &#39;PRON&#39;), (all, &#39;PRON&#39;), (., &#39;PUNCT&#39;), (
, &#39;SPACE&#39;), (From, &#39;ADP&#39;), (writing, &#39;VERB&#39;), (all, &#39;DET&#39;), (-, &#39;PUNCT&#39;), (time, &#39;NOUN&#39;), (great, &#39;ADJ&#39;), (songs, &#39;NOUN&#39;), (like, &#39;ADP&#39;), (“, &#39;PUNCT&#39;), (Jolene, &#39;PROPN&#39;)]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Often we want to know who did what to whom.</p></li>
<li><p><strong>Named entities</strong> give you this information.</p></li>
<li><p>What are named entities in the text?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Named entities:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ORG means: &quot;</span><span class="p">,</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;ORG&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">PERSON means: &quot;</span><span class="p">,</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;PERSON&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DATE means: &quot;</span><span class="p">,</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s2">&quot;DATE&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Named entities:
 [(&#39;Dolly Parton&#39;, &#39;PERSON&#39;), (&#39;Jolene&#39;, &#39;WORK_OF_ART&#39;), (&#39;I Will Always Love You&#39;, &#39;WORK_OF_ART&#39;), (&#39;9&#39;, &#39;CARDINAL&#39;), (&#39;Netflix&#39;, &#39;ORG&#39;), (&#39;Dolly Parton’s&#39;, &#39;PERSON&#39;), (&#39;Christmas&#39;, &#39;DATE&#39;), (&#39;Square&#39;, &#39;FAC&#39;), (&#39;Christine Baranski&#39;, &#39;PERSON&#39;), (&#39;Christmas Eve&#39;, &#39;DATE&#39;), (&#39;Debbie Allen&#39;, &#39;PERSON&#39;), (&#39;Jennifer Lewis&#39;, &#39;PERSON&#39;), (&#39;Parton&#39;, &#39;PERSON&#39;), (&#39;Christmas&#39;, &#39;DATE&#39;), (&#39;Square&#39;, &#39;FAC&#39;), (&#39;Christmas 2020&#39;, &#39;DATE&#39;), (&#39;😻&#39;, &#39;GPE&#39;)]

ORG means:  Companies, agencies, institutions, etc.

PERSON means:  People, including fictional

DATE means:  Absolute or relative dates or periods
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>

<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Dolly Parton
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 is a gift to us all. </br>From writing all-time great songs like “
<mark class="entity" style="background: #f0d0ff; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Jolene
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">WORK_OF_ART</span>
</mark>
” and “
<mark class="entity" style="background: #f0d0ff; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    I Will Always Love You
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">WORK_OF_ART</span>
</mark>
”, </br>to great performances in films like 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    9
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">CARDINAL</span>
</mark>
 to 5, to helping fund a COVID-19 vaccine, </br>she’s given us so much. Now, 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Netflix
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 bring us 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Dolly Parton’s
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Christmas
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 on the 
<mark class="entity" style="background: #9cc9cc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Square
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">FAC</span>
</mark>
, </br>an original musical that stars 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Christine Baranski
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 as a Scrooge-like landowner </br>who threatens to evict an entire town on 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Christmas Eve
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 to make room for a new mall. </br>Directed and choreographed by the legendary 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Debbie Allen
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 and counting 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Jennifer Lewis
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 </br>and 
<mark class="entity" style="background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Parton
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PERSON</span>
</mark>
 herself amongst its cast, 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Christmas
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 on the 
<mark class="entity" style="background: #9cc9cc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Square
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">FAC</span>
</mark>
 seems like the perfect movie</br>to save 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Christmas 2020
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
. 
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    😻
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
 👍🏿</div></span></div></div>
</div>
</section>
<section id="an-example-from-a-project">
<h3>An example from a project<a class="headerlink" href="#an-example-from-a-project" title="Permalink to this heading">#</a></h3>
<p>Goal: Extract and visualize inter-corporate relationships from disclosed annual 10-K reports of public companies.</p>
<p><a class="reference external" href="https://www.bbc.com/news/business-39875417">Source for the text below.</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Heavy hitters, including Microsoft and Google, &quot;</span>
    <span class="s2">&quot;are competing for customers in cloud services with the likes of IBM and Salesforce.&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Named entities:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">Heavy hitters, including 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Microsoft
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 and 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Google
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
, are competing for customers in cloud services with the likes of 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    IBM
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 and 
<mark class="entity" style="background: #bfeeb7; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Salesforce
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">PRODUCT</span>
</mark>
.</div></span></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Named entities:
 [(&#39;Microsoft&#39;, &#39;ORG&#39;), (&#39;Google&#39;, &#39;ORG&#39;), (&#39;IBM&#39;, &#39;ORG&#39;), (&#39;Salesforce&#39;, &#39;PRODUCT&#39;)]
</pre></div>
</div>
</div>
</div>
<p>If you want emoji identification support install <a class="reference external" href="https://pypi.org/project/spacymoji/"><code class="docutils literal notranslate"><span class="pre">spacymoji</span></code></a> in the course environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">spacymoji</span>
</pre></div>
</div>
<p>After installing <code class="docutils literal notranslate"><span class="pre">spacymoji</span></code>, if it’s still complaining about module not found, my guess is that you do not have <code class="docutils literal notranslate"><span class="pre">pip</span></code> installed in your <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment. Go to your course <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment install <code class="docutils literal notranslate"><span class="pre">pip</span></code> and install the <code class="docutils literal notranslate"><span class="pre">spacymoji</span></code> package in the environment using the <code class="docutils literal notranslate"><span class="pre">pip</span></code> you just installed in the current environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">pip</span>
<span class="n">YOUR_MINICONDA_PATH</span><span class="o">/</span><span class="n">miniconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">cpsc330</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">pip</span> <span class="n">install</span> <span class="n">spacymoji</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacymoji</span> <span class="kn">import</span> <span class="n">Emoji</span>

<span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;emoji&quot;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Does the text have any emojis? If yes, extract the description.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
<span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">emoji</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;😻&#39;, 138, &#39;smiling cat face with heart-eyes&#39;),
 (&#39;👍🏿&#39;, 139, &#39;thumbs up dark skin tone&#39;)]
</pre></div>
</div>
</div>
</div>
<p><br><br><br><br></p>
</section>
<section id="simple-feature-engineering-for-our-problem">
<h3>Simple feature engineering for our problem.<a class="headerlink" href="#simple-feature-engineering-for-our-problem" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_relative_length</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">TWITTER_ALLOWED_CHARS</span><span class="o">=</span><span class="mf">280.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the relative length of text.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ------</span>
<span class="sd">    text: (str)</span>
<span class="sd">    the input text</span>

<span class="sd">    Keyword arguments:</span>
<span class="sd">    ------</span>
<span class="sd">    TWITTER_ALLOWED_CHARS: (float)</span>
<span class="sd">    the denominator for finding relative length</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    relative length of text: (float)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">/</span> <span class="n">TWITTER_ALLOWED_CHARS</span>


<span class="k">def</span> <span class="nf">get_length_in_words</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the length of the text in words.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ------</span>
<span class="sd">    text: (str)</span>
<span class="sd">    the input text</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    length of tokenized text: (int)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_sentiment</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the compound score representing the sentiment: -1 (most extreme negative) and +1 (most extreme positive)</span>
<span class="sd">    The compound score is a normalized score calculated by summing the valence scores of each word in the lexicon.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ------</span>
<span class="sd">    text: (str)</span>
<span class="sd">    the input text</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    sentiment of the text: (str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">sid</span><span class="o">.</span><span class="n">polarity_scores</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;compound&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_words</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_length_in_words</span><span class="p">))</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">vader_sentiment</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_sentiment</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rel_char_len</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_relative_length</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_words</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_length_in_words</span><span class="p">))</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">vader_sentiment</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_sentiment</span><span class="p">))</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">rel_char_len</span><span class="o">=</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;OriginalTweet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_relative_length</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3038, 9)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OriginalTweet</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1927</th>
      <td>While I don't like all of Amazon's choices, to...</td>
    </tr>
    <tr>
      <th>1068</th>
      <td>Me: shit buckets, its time to do the weekly s...</td>
    </tr>
    <tr>
      <th>803</th>
      <td>@SecPompeo @realDonaldTrump You mean the plan ...</td>
    </tr>
    <tr>
      <th>2846</th>
      <td>@lauvagrande People who are sick arent panic ...</td>
    </tr>
    <tr>
      <th>3768</th>
      <td>Coronavirus Panic: Toilet Paper Is the People...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>Photos of our local grocery store shelveswher...</td>
    </tr>
    <tr>
      <th>1346</th>
      <td>Just went to the the grocery store (Highland F...</td>
    </tr>
    <tr>
      <th>3454</th>
      <td>Real talk though. Am I the only one spending h...</td>
    </tr>
    <tr>
      <th>3437</th>
      <td>The supermarket business is booming! #COVID2019</td>
    </tr>
    <tr>
      <th>3582</th>
      <td>Evening All Here s the story on the and the im...</td>
    </tr>
  </tbody>
</table>
<p>3038 rows × 1 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sentiment&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vader_sentiment&quot;</span><span class="p">,</span> <span class="s2">&quot;rel_char_len&quot;</span><span class="p">,</span> <span class="s2">&quot;n_words&quot;</span><span class="p">]</span>
<span class="n">text_feature</span> <span class="o">=</span> <span class="s2">&quot;OriginalTweet&quot;</span>
<span class="n">drop_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;UserName&quot;</span><span class="p">,</span> <span class="s2">&quot;ScreenName&quot;</span><span class="p">,</span> <span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="s2">&quot;TweetAt&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(</span><span class="n">stop_words</span><span class="o">=</span><span class="s2">&quot;english&quot;</span><span class="p">),</span> <span class="n">text_feature</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">drop_features</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;LR (more feats)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_std_cross_val_scores</span><span class="p">(</span>
    <span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring_metrics</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>dummy</th>
      <td>0.001 (+/- 0.000)</td>
      <td>0.000 (+/- 0.000)</td>
      <td>0.280 (+/- 0.001)</td>
      <td>0.280 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>logistic regression</th>
      <td>0.477 (+/- 0.024)</td>
      <td>0.007 (+/- 0.000)</td>
      <td>0.413 (+/- 0.011)</td>
      <td>0.999 (+/- 0.000)</td>
    </tr>
    <tr>
      <th>LR (more feats)</th>
      <td>0.608 (+/- 0.069)</td>
      <td>0.010 (+/- 0.001)</td>
      <td>0.689 (+/- 0.006)</td>
      <td>0.998 (+/- 0.001)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-4 {color: black;background-color: white;}#sk-container-id-4 pre{padding: 0;}#sk-container-id-4 div.sk-toggleable {background-color: white;}#sk-container-id-4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-4 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-4 div.sk-item {position: relative;z-index: 1;}#sk-container-id-4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-4 div.sk-item::before, #sk-container-id-4 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-4 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-4 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-4 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-4 div.sk-label-container {text-align: center;}#sk-container-id-4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;vader_sentiment&#x27;,
                                                   &#x27;rel_char_len&#x27;, &#x27;n_words&#x27;]),
                                                 (&#x27;countvectorizer&#x27;,
                                                  CountVectorizer(stop_words=&#x27;english&#x27;),
                                                  &#x27;OriginalTweet&#x27;),
                                                 (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                                  [&#x27;UserName&#x27;, &#x27;ScreenName&#x27;,
                                                   &#x27;Location&#x27;, &#x27;TweetAt&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression(max_iter=1000))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;,
                                                  StandardScaler(),
                                                  [&#x27;vader_sentiment&#x27;,
                                                   &#x27;rel_char_len&#x27;, &#x27;n_words&#x27;]),
                                                 (&#x27;countvectorizer&#x27;,
                                                  CountVectorizer(stop_words=&#x27;english&#x27;),
                                                  &#x27;OriginalTweet&#x27;),
                                                 (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                                  [&#x27;UserName&#x27;, &#x27;ScreenName&#x27;,
                                                   &#x27;Location&#x27;, &#x27;TweetAt&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression(max_iter=1000))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;standardscaler&#x27;, StandardScaler(),
                                 [&#x27;vader_sentiment&#x27;, &#x27;rel_char_len&#x27;,
                                  &#x27;n_words&#x27;]),
                                (&#x27;countvectorizer&#x27;,
                                 CountVectorizer(stop_words=&#x27;english&#x27;),
                                 &#x27;OriginalTweet&#x27;),
                                (&#x27;drop&#x27;, &#x27;drop&#x27;,
                                 [&#x27;UserName&#x27;, &#x27;ScreenName&#x27;, &#x27;Location&#x27;,
                                  &#x27;TweetAt&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">standardscaler</label><div class="sk-toggleable__content"><pre>[&#x27;vader_sentiment&#x27;, &#x27;rel_char_len&#x27;, &#x27;n_words&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">countvectorizer</label><div class="sk-toggleable__content"><pre>OriginalTweet</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">CountVectorizer</label><div class="sk-toggleable__content"><pre>CountVectorizer(stop_words=&#x27;english&#x27;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>[&#x27;UserName&#x27;, &#x27;ScreenName&#x27;, &#x27;Location&#x27;, &#x27;TweetAt&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">LogisticRegression</label><div class="sk-toggleable__content"><pre>LogisticRegression(max_iter=1000)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_feats</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;columntransformer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;countvectorizer&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_names</span> <span class="o">=</span> <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">cv_feats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coefs</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;logisticregression&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">feat_names</span><span class="p">,</span>
        <span class="s2">&quot;coefficients&quot;</span><span class="p">:</span> <span class="n">coefs</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;coefficients&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>features</th>
      <th>coefficients</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>vader_sentiment</td>
      <td>-6.156919</td>
    </tr>
    <tr>
      <th>11329</th>
      <td>won</td>
      <td>-1.386911</td>
    </tr>
    <tr>
      <th>2549</th>
      <td>coronapocalypse</td>
      <td>-0.818268</td>
    </tr>
    <tr>
      <th>2212</th>
      <td>closed</td>
      <td>-0.751250</td>
    </tr>
    <tr>
      <th>8659</th>
      <td>retail</td>
      <td>-0.730537</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3297</th>
      <td>don</td>
      <td>1.146414</td>
    </tr>
    <tr>
      <th>9860</th>
      <td>stupid</td>
      <td>1.159503</td>
    </tr>
    <tr>
      <th>4877</th>
      <td>hell</td>
      <td>1.295756</td>
    </tr>
    <tr>
      <th>3127</th>
      <td>die</td>
      <td>1.364247</td>
    </tr>
    <tr>
      <th>7502</th>
      <td>panic</td>
      <td>1.507011</td>
    </tr>
  </tbody>
</table>
<p>11662 rows × 2 columns</p>
</div></div></div>
</div>
<p>We get some improvements with our engineered features!</p>
<p><br><br><br><br></p>
</section>
<section id="common-features-used-in-text-classification">
<h3>Common features used in text classification<a class="headerlink" href="#common-features-used-in-text-classification" title="Permalink to this heading">#</a></h3>
</section>
<section id="bag-of-words">
<h3>Bag of words<a class="headerlink" href="#bag-of-words" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>So far for text data we have been using bag of word features.</p></li>
<li><p>They are good enough for many tasks. But …</p></li>
<li><p>This encoding throws out a lot of things we know about language</p></li>
<li><p>It assumes that word order is not that important.</p></li>
<li><p>So if you want to improve the scores further on text classification tasks you carry out <strong>feature engineering</strong>.</p></li>
</ul>
<p>Let’s look at some examples from research papers.</p>
</section>
<section id="example-label-personalized-important-e-mails">
<h3>Example: Label “Personalized” Important E-mails:<a class="headerlink" href="#example-label-personalized-important-e-mails" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36955.pdf">The Learning Behind Gmail Priority Inbox</a></p></li>
<li><p>Features: bag of words, trigrams, regular expressions, and so on.</p></li>
<li><p>There might be some “globally” important messages:</p>
<ul>
<li><p>“This is your mother, something terrible happened, give me a call ASAP.”</p></li>
</ul>
</li>
<li><p>But your “important” message may be unimportant to others.</p>
<ul>
<li><p>Similar for spam: “spam” for one user could be “not spam” for another.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Social features (e.g., percentage of sender emails that is read by the recipient)</p></li>
<li><p>Content features (e.g., recent terms the user has been using in emails)</p></li>
<li><p>Thread features (e.g., whether the user has started the thread)</p></li>
<li><p>…</p></li>
</ul>
</section>
<section id="the-learning-behind-gmail-priority-inbox">
<h3><a class="reference external" href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36955.pdf">The Learning Behind Gmail Priority Inbox</a><a class="headerlink" href="#the-learning-behind-gmail-priority-inbox" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="../_images/gmail_priority_inbox.png" /></p>
<!-- <img src="img/gmail_priority_inbox.png" width="1000" height="1000"> --><section id="feature-engineering-examples-automatically-identifying-good-conversations-online">
<h4>Feature engineering examples: <a class="reference external" href="http://www.courtneynapoles.com/res/icwsm17-automatically.pdf">Automatically Identifying Good Conversations Online</a><a class="headerlink" href="#feature-engineering-examples-automatically-identifying-good-conversations-online" title="Permalink to this heading">#</a></h4>
<p><img alt="" src="../_images/classifying_good_conversations_online.png" /></p>
<!-- <img src="img/classifying_good_conversations_online.png" width="800" height="800"> -->
</section>
</section>
<section id="optional-term-weighing-tf-idf">
<h3>(Optional) Term weighing (TF-IDF)<a class="headerlink" href="#optional-term-weighing-tf-idf" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A measure of relatedness between words and documents</p></li>
<li><p>Intuition: Meaningful words may occur repeatedly in related documents, but functional words (e.g., <em>make</em>, <em>the</em>) may be distributed evenly over all documents</p></li>
</ul>
<div class="math notranslate nohighlight">
\[tf.idf(w_i,d_j) = (1+log(tf_{ij})) log\frac{D}{df_i}\]</div>
<p>where,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(tf_{ij}\)</span> → number of occurrences of the term <span class="math notranslate nohighlight">\(w_i\)</span> in document <span class="math notranslate nohighlight">\(d_j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(D\)</span> → number of documents</p></li>
<li><p><span class="math notranslate nohighlight">\(df_i\)</span> → number of documents in which <span class="math notranslate nohighlight">\(w_i\)</span> occurs</p></li>
</ul>
<p>Check <code class="docutils literal notranslate"><span class="pre">TfidfVectorizer</span></code> from <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p>
</section>
<section id="n-grams">
<h3>N-grams<a class="headerlink" href="#n-grams" title="Permalink to this heading">#</a></h3>
<ul>
<li><p>Incorporating more context</p></li>
<li><p>A contiguous sequence of <em>n</em> items (characters, tokens) in text.</p>
  <blockquote>
      MDS students are hard-working .
  </blockquote>    
</li>
<li><p>2-grams (bigrams): a contiguous sequence of two words</p>
<ul class="simple">
<li><p>MDS students, students are, are hard-working, hard-working ._</p></li>
</ul>
</li>
<li><p>3-grams (trigrams): a contiguous sequence of three words</p>
<ul class="simple">
<li><p><em>MDS students are, students are hard-working, are hard-working .</em></p></li>
</ul>
</li>
</ul>
<p>You can extract ngram features using <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> by passing <code class="docutils literal notranslate"><span class="pre">ngram_range</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;URGENT!! As a valued network customer you have been selected to receive a $900 prize reward!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Lol you are always so convincing.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;URGENT!! Call right away!!&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">vec</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/sklearn/utils/deprecation.py:87: FutureWarning: Function get_feature_names is deprecated; get_feature_names is deprecated in 1.0 and will be removed in 1.2. Please use get_feature_names_out instead.
  warnings.warn(msg, category=FutureWarning)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>900</th>
      <th>900 prize</th>
      <th>900 prize reward</th>
      <th>always</th>
      <th>always so</th>
      <th>always so convincing</th>
      <th>are</th>
      <th>are always</th>
      <th>are always so</th>
      <th>as</th>
      <th>...</th>
      <th>urgent call</th>
      <th>urgent call right</th>
      <th>valued</th>
      <th>valued network</th>
      <th>valued network customer</th>
      <th>you</th>
      <th>you are</th>
      <th>you are always</th>
      <th>you have</th>
      <th>you have been</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a $900 prize reward!</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT!! Call right away!!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 61 columns</p>
</div></div></div>
</div>
</section>
<section id="aside-google-n-gram-viewer">
<h3>ASIDE: <a class="reference external" href="https://books.google.com/ngrams">Google n-gram viewer</a><a class="headerlink" href="#aside-google-n-gram-viewer" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>All Our N-gram are Belong to You</p>
<ul>
<li><p>https://ai.googleblog.com/2006/08/all-our-n-gram-are-belong-toyou.html</p></li>
</ul>
</li>
</ul>
<blockquote>
Here at Google Research we have been using word n-gram models for a variety
of R&D projects, such as statistical machine translation, speech recognition,
spelling correction, entity detection, information extraction, and others.
That's why we decided to share this enormous dataset with everyone. We
processed 1,024,908,267,229 words of running text and are publishing the
counts for all 1,176,470,663 five-word sequences that appear at least 40
times. There are 13,588,391 unique words, after discarding words that appear
less than 200 times.”
</blockquote><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://books.google.com/ngrams/&quot;</span>
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;iframe src=</span><span class="si">%s</span><span class="s2"> width=1000 height=800&gt;&lt;/iframe&gt;&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/kvarada/opt/miniconda3/envs/573/lib/python3.10/site-packages/IPython/core/display.py:431: UserWarning: Consider using IPython.display.IFrame instead
  warnings.warn(&quot;Consider using IPython.display.IFrame instead&quot;)
</pre></div>
</div>
<div class="output text_html"><iframe src=https://books.google.com/ngrams/ width=1000 height=800></iframe></div></div>
</div>
</section>
<section id="id2">
<h3>Aside: <a class="reference external" href="https://books.google.com/ngrams">Google n-gram viewer</a><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Count the occurrences of the bigram <em>smart women</em> in the corpus from 1800 to 2000</p></li>
</ul>
<p><img alt="" src="../_images/ngram_viewer_smart_woman1.png" /></p>
<!-- <img src="img/ngram_viewer_smart_woman.png" width="800" height="800"> --></section>
<section id="id3">
<h3>Aside: <a class="reference external" href="https://books.google.com/ngrams">Google n-gram viewer</a><a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Trends in the word <em>challenge</em> used as a noun vs. verb</p></li>
</ul>
<p><img alt="" src="../_images/ngram_viewer_challenge_NN_VB1.png" /></p>
<!-- <img src="img/ngram_viewer_challenge_NN_VB.png" width="800" height="800"> --></section>
<section id="part-of-speech-features">
<h3>Part-of-speech features<a class="headerlink" href="#part-of-speech-features" title="Permalink to this heading">#</a></h3>
<section id="part-of-speech-pos-in-english">
<h4>Part-of-speech (POS) in English<a class="headerlink" href="#part-of-speech-pos-in-english" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Part-of-speech: A kind of syntactic category that tells you some of the grammatical properties of a word.</p>
<ul>
<li><p>Noun → water, sun, cat</p></li>
<li><p>Verb → run, eat, teach</p></li>
</ul>
</li>
</ul>
<blockquote>
The ____ was running. 
</blockquote>    
<ul class="simple">
<li><p>Only a noun fits here.</p></li>
</ul>
</section>
</section>
<section id="part-of-speech-pos-features">
<h3>Part-of-speech (POS) features<a class="headerlink" href="#part-of-speech-pos-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>POS features use POS information for the words in text.</p></li>
</ul>
<blockquote>
    CPSC330/<span style="color:green">PROPER_NOUN</span> students/<span style="color:green">NOUN</span> are/<span style="color:green">VERB</span> hard-working/<span style="color:green">ADJECTIVE</span>
</blockquote>    
</section>
<section id="id4">
<h3>An example from a project<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Data: a bunch of documents</p></li>
<li><p>Task: identify texts with <em>permissions</em> and identify who is giving permission to whom.</p></li>
</ul>
<blockquote>
<b>You</b> may <b>disclose</b> Google confidential information when compelled to do so by law if <b>you</b> provide <b>us</b> reasonable prior notice, unless a court orders that <b>we</b> not receive notice.
</blockquote>
<ul class="simple">
<li><p>A very simple solution</p>
<ul>
<li><p>Look for pronouns and verbs.</p></li>
<li><p>Add POS tags as features in your model.</p></li>
<li><p>Maybe look up words similar to <strong>disclose</strong>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="penn-treebank-part-of-speech-tags-bonus">
<h3>Penn Treebank part-of-speech tags (bonus)<a class="headerlink" href="#penn-treebank-part-of-speech-tags-bonus" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="../_images/PTB_POS1.png" /></p>
<!-- <img src="img/PTB_POS.png" width="900" height="900"/> --><ul class="simple">
<li><p>You also need to download the language model which contains all the pre-trained models. For that run the following in your course <code class="docutils literal notranslate"><span class="pre">conda</span></code> environment.</p></li>
</ul>
</section>
<section id="id5">
<h3>Interim summary<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In the context of text data, if we want to go beyond bag-of-words and incorporate human knowledge in models, we carry out feature engineering.</p></li>
<li><p>Some common features include:</p>
<ul>
<li><p>ngram features</p></li>
<li><p>part-of-speech features</p></li>
<li><p>named entity features</p></li>
<li><p>emoticons in text</p></li>
</ul>
</li>
<li><p>These are usually extracted from pre-trained models using libraries such as <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>.</p></li>
<li><p>Now a lot of this has moved to deep learning.</p></li>
<li><p>But many industries still rely on manual feature engineering.</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>What did we learn today?</p>
<ul class="simple">
<li><p>Feature engineering is finding the useful representation of the data that can help us effectively solve our problem.</p></li>
<li><p>Non-linear regression (change of basis)</p></li>
<li><p>Radial basis functions</p></li>
<li><p>Importance of feature engineering in text data and audio data.</p></li>
</ul>
<section id="feature-engineering">
<h3>Feature engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The best features are application-dependent.</p></li>
<li><p>It’s hard to give general advice. But here are some guidelines.</p>
<ul>
<li><p>Ask the domain experts.</p></li>
<li><p>Go through academic papers in the discipline.</p></li>
<li><p>Often have idea of right discretization/standardization/transformation.</p></li>
<li><p>If no domain expert, cross-validation will help.</p></li>
</ul>
</li>
<li><p>If you have lots of data, use deep learning methods.</p></li>
</ul>
<blockquote>
    The algorithms we used are very standard for Kagglers ... We spent most of our efforts in feature engineering... <br>
- Xavier Conort, on winning the Flight Quest challenge on Kaggle    
</blockquote>    </section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "571"
        },
        kernelOptions: {
            name: "571",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '571'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="02_regression-metrics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 2: Regression metrics</p>
      </div>
    </a>
    <a class="right-next"
       href="04_feat-importances-selection.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 4: Feature importances and feature selection</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-lo">Imports and LO</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-motivation">Feature engineering: Motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-3-1">iClicker Exercise 3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#garbage-in-garbage-out">Garbage in, garbage out.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#activity-how-can-you-measure-quality-of-the-data-3-mins">Activity: How can you measure quality of the data? (~3 mins)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-feature-engineering">What is feature engineering?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-quotes-on-feature-engineering">Some quotes on feature engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-features-usually-help-more-than-a-better-model">Better features usually help more than a better model.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-best-features-may-be-dependent-on-the-model-you-use">The best features may be dependent on the model you use.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#domain-specific-transformations">Domain-specific transformations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-feature-transformations-for-non-linear-regression">Polynomial feature transformations for non-linear regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-prediction-recap">Linear regression prediction (recap)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-vector-notation">Matrix vector notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-of-column-of-ones-notation">An example of column of ones notation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations-of-linear-regression">Limitations of linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-transformations">Polynomial transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-quadratic-features">Adding quadratic features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomial-regression-in-sklearn">Polynomial regression in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interim-summary">Interim summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polynomialfeatures-with-sklearn-pipelines"><code class="docutils literal notranslate"><span class="pre">PolynomialFeatures</span></code> with sklearn pipelines</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-setting-non-linearly-separable-data">Classification setting: Non-linearly separable data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-another-example-with-two-features">(Optional) Another example with two features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-interactions-and-feature-crosses">Feature interactions and feature crosses</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-crosses-for-one-hot-encoded-features">Feature crosses for one-hot encoded features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-to-consider">Questions to consider</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-polynomial-basis">Problems with polynomial basis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-can-we-do-this-efficiently">How can we do this efficiently?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-recall-rbf-kernel">(Optional) Recall RBF Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbfs">RBFs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-rbfs">Example: RBFs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-radial-basis-functions-gaussian-rbfs">Gaussian Radial Basis Functions (Gaussian RBFs)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-rbfs-non-parametric-basis">Gaussian RBFs (non-parametric basis)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-gamma-in-svm-rbf">Interpretation of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> in SVM RBF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-gaussian-rbf-with-x-and-sigma">Constructing Gaussian RBF with <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gaussian-rbfs-prediction">Gaussian RBFs: Prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbf-with-regulariation-and-optimized-sigma-and-lambda">RBF with regulariation and optimized <span class="math notranslate nohighlight">\(sigma\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-rbf-with-least-squares-kernelridge-optional">Using RBF with least squares: KernelRidge (optional)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">❓❓ Questions for you</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iclicker-exercise-3-2">iClicker Exercise 3.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#break-5-min">Break (5 min)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-of-feature-engineering-with-numeric-features">Demo of feature engineering with numeric features</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-for-text-data">Feature engineering for text data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-classifier">Dummy classifier</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bag-of-words-model">Bag-of-words model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#is-it-possible-to-further-improve-the-scores">Is it possible to further improve the scores?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spacy">spaCy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-from-a-project">An example from a project</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-feature-engineering-for-our-problem">Simple feature engineering for our problem.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-features-used-in-text-classification">Common features used in text classification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bag-of-words">Bag of words</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-label-personalized-important-e-mails">Example: Label “Personalized” Important E-mails:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-learning-behind-gmail-priority-inbox">The Learning Behind Gmail Priority Inbox</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering-examples-automatically-identifying-good-conversations-online">Feature engineering examples: Automatically Identifying Good Conversations Online</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-term-weighing-tf-idf">(Optional) Term weighing (TF-IDF)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#n-grams">N-grams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aside-google-n-gram-viewer">ASIDE: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Aside: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Aside: Google n-gram viewer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-features">Part-of-speech features</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-pos-in-english">Part-of-speech (POS) in English</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-of-speech-pos-features">Part-of-speech (POS) features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">An example from a project</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penn-treebank-part-of-speech-tags-bonus">Penn Treebank part-of-speech tags (bonus)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Interim summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">Feature engineering</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar and Joel Östblom
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>